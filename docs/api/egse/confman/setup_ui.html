<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>egse.confman.setup_ui API documentation</title>
<meta name="description" content="" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>egse.confman.setup_ui</code></h1>
</header>
<section id="section-intro">
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">import logging
from pathlib import Path

import sys
from PyQt5.QtCore import Qt
from PyQt5.QtGui import QIcon
from PyQt5.QtGui import QPixmap
from PyQt5.QtWidgets import QAction, QListWidget
from PyQt5.QtWidgets import QApplication
from PyQt5.QtWidgets import QFrame
from PyQt5.QtWidgets import QGroupBox
from PyQt5.QtWidgets import QHBoxLayout
from PyQt5.QtWidgets import QLineEdit
from PyQt5.QtWidgets import QMainWindow
from PyQt5.QtWidgets import QPushButton
from PyQt5.QtWidgets import QSplitter
from PyQt5.QtWidgets import QTabWidget
from PyQt5.QtWidgets import QTextBrowser
from PyQt5.QtWidgets import QVBoxLayout
from rich.console import Console

from egse.config import find_file
from egse.config import get_common_egse_root
from egse.confman import ConfigurationManagerProxy
from egse.control import Failure
from egse.gui import show_warning_message, VLine, show_info_message
from egse.settings import Settings
from egse.system import replace_environment_variable

logging.basicConfig(level=logging.INFO, format=Settings.LOG_FORMAT_FULL)

LOGGER = logging.getLogger(__name__)

SITE = Settings.load(&#34;SITE&#34;)[&#34;ID&#34;]


class SetupUIView(QMainWindow):

    def __init__(self):
        &#34;&#34;&#34; Initialisation of the GUI to inspect the available setups.

        The components are placed in the window:
            - on the left-hand side: filtering of the setups + list with the setups that meet the conditions from the
              filter;
            - right-hand side: tabs with setup that were opened for visual inspection.
        &#34;&#34;&#34;

        super().__init__()

        self.setGeometry(300, 300, 1200, 1000)

        cm_ctrl_settings = Settings.load(&#34;Configuration Manager Control Server&#34;)
        location = replace_environment_variable(cm_ctrl_settings.FILE_STORAGE_LOCATION)
        self._data_conf_location = Path(location) if location else get_common_egse_root()

        self.setWindowTitle(f&#34;Available Setups ({self._data_conf_location})&#34;)

        # Build up the GUI

        self.toolbar = self.addToolBar(&#34;MainToolbar&#34;)

        self.filter = QLineEdit()
        self.filter_list = QListWidget()
        self.tabbed_widget = QTabWidget()

        self.init_ui()

        # Keep track of which setups have been opened in a tab

        self.open_tabs = []

    def resizeEvent(self, event):
        &#34;&#34;&#34; Re-sizing of the main window.

        Args:
            - event: Re-size event.
        &#34;&#34;&#34;

        QMainWindow.resizeEvent(self, event)
        self.filter_list.setMinimumSize(self.width() / 2 - 50, self.height() - 200)

    def init_ui(self):
        &#34;&#34;&#34; Put the components in the GUI window.

        The GUI comprises the following components:
            - on the left-hand side: filtering of the setups + list with the setups that meet the conditions from the
              filter;
            - right-hand side: tabs with setup that were opened for visual inspection.
        &#34;&#34;&#34;

        # Creating the content

        app_frame = QFrame()
        app_frame.setObjectName(&#34;AppFrame&#34;)

        self.create_toolbar()
        self.create_statusbar()

        # Left-hand side: filtering + drop-down menu

        lhs_layout = QVBoxLayout()
        lhs_frame = QFrame()

        filter_widget = self.make_filter_widget()
        self.update_list()

        lhs_layout.addWidget(filter_widget)
        lhs_layout.addWidget(self.filter_list)

        lhs_layout.addStretch()
        lhs_frame.setLayout(lhs_layout)

        # Right-hand side: tabs

        self.make_tabbed_widget()

        # Put everything together

        layout = QHBoxLayout()
        splitter = QSplitter(Qt.Horizontal)

        splitter.addWidget(lhs_frame)
        splitter.addWidget(self.tabbed_widget)
        splitter.setSizes([500, 1000])

        layout.addWidget(splitter)
        app_frame.setLayout(layout)

        self.setCentralWidget(app_frame)

    def create_toolbar(self):
        &#34;&#34;&#34; Configure the toolbar.

        The toolbar comprises a single button that allows you to load the setup that is shown in the active tab.
        &#34;&#34;&#34;

        load_setup_pix = QPixmap(str(find_file(&#34;load.png&#34;, in_dir=&#34;images&#34;)))
        load_setup_icon = QIcon()
        load_setup_icon.addPixmap(load_setup_pix, QIcon.Normal, QIcon.On)

        load_setup_action = QAction(load_setup_icon, &#34;Load the current setup&#34;, self)
        load_setup_action.setStatusTip(&#34;Load setup shown in the active tab.&#34;)
        load_setup_action.setCheckable(False)
        load_setup_action.triggered.connect(self.load_setup)

        self.toolbar.addAction(load_setup_action)

        return self.toolbar

    def create_statusbar(self):
        &#34;&#34;&#34; Create a status bar.

        Returns: Status bar.
        &#34;&#34;&#34;

        self.statusBar().setStyleSheet(&#34;border: 0; background-color: #FFF8DC;&#34;)
        self.statusBar().setStyleSheet(&#34;QStatusBar::item {border: none;}&#34;)
        self.statusBar().addPermanentWidget(VLine())

    def load_setup(self):
        &#34;&#34;&#34;Load the setup that is shown in the active tab. &#34;&#34;&#34;

        current_widget = self.tabbed_widget.currentWidget()

        if current_widget is None:

            description = &#34;No setup selected.&#34;
            info_text = &#34;You can view setup files by selecting them in the list.  They will be opened in &#34; \
                        + &#34;individual tabs on the right-hand side.  \n\nTo be able to load a specific setup, bring &#34; \
                        + &#34;the corresponding tab into focus.&#34;

            show_warning_message(description, info_text=info_text)

        else:

            site, setup_id = current_widget.accessibleName().split(&#34; &#34;)

            if site == SITE:

                try:

                    with ConfigurationManagerProxy() as cm:

                        load_result = cm.load_setup(int(setup_id))

                        if isinstance(load_result, Failure):

                            description = f&#34;Setup {setup_id} could not be loaded for {site}&#34;
                            info_text = load_result.message

                            show_warning_message(description, info_text=info_text)

                        else:

                            description = f&#34;Loaded setup {setup_id} for {site}&#34;
                            show_info_message(description)

                except ConnectionError:

                    description = &#34;Connection with Configuration Manager was lost.&#34;
                    info_text = &#34;Check the status of the core services (and re-start when necessary)&#34;
                    show_warning_message(description, info_text=info_text)

            else:

                description = &#34;Wrong site ID.&#34;
                info_text = f&#34;The site ID mentioned in the setup file ({site}) does not match the site you are at &#34; \
                            + &#34;f({SITE}), according to the settings file.  Therefore, loading this setup was prevented.&#34;
                show_warning_message(description, info_text=info_text)

    def make_filter_widget(self):
        &#34;&#34;&#34; Make widget where the available setups can be filtered:

        This widgets consists of the following elements:
            - text field in which the filter can be specified: when the return key is pressed, the filter is applied
              (i.e. all tabs are closed and the drop-down menu is updated);
            - search button: when this is pressed, the filter is applied (i.e. all tabs are closed and the list is
              updated);
            - clear button: when this is pressed, the filter is cleared (i.e. all tabs are closed and the list is
              updated).
        &#34;&#34;&#34;

        layout = QHBoxLayout()

        widget = QGroupBox(&#34;Filter&#34;, self)

        # Text field for the filter

        self.filter.returnPressed.connect(self.apply_filter)
        self.filter.setStatusTip(&#34;Filtering of available setups, e.g. &#34; +
                                 &#34;site_id=\&#34;CSL\&#34;, gse.hexapod.ID=2, camera.model=\&#34;STM\&#34;.&#34;)
        layout.addWidget(self.filter)

        # Search button

        search_icon = QIcon(str(find_file(&#34;search.png&#34;, in_dir=&#34;images&#34;)))
        search_button = QPushButton()
        search_button.setIcon(search_icon)
        search_button.setStatusTip(&#34;Apply filter (alternatively hit return key in the text field).&#34;)
        search_button.clicked.connect(self.apply_filter)

        layout.addWidget(search_button)

        # Clear button

        clear_icon = QIcon(str(find_file(&#34;cross.svg&#34;, in_dir=&#34;images&#34;)))
        clear_button = QPushButton()
        clear_button.setIcon(clear_icon)
        clear_button.setStatusTip(&#34;Clear filter.&#34;)
        clear_button.clicked.connect(self.clear_filter)

        layout.addWidget(clear_button)

        widget.setLayout(layout)

        # Make the drop-down menu listen to selections

        self.filter_list.currentTextChanged.connect(self.view_setup)
        self.filter_list.setStatusTip(f&#34;All available setups in {self._data_conf_location} &#34;
                                      f&#34;that meet the filter condition(s).&#34;)

        return widget

    def make_tabbed_widget(self):

        self.tabbed_widget.setTabsClosable(True)
        self.tabbed_widget.tabCloseRequested.connect(self.close_tab)
        self.tabbed_widget.setMovable(False)
        self.tabbed_widget.setDocumentMode(True)
        self.tabbed_widget.setElideMode(Qt.ElideRight)
        self.tabbed_widget.setUsesScrollButtons(True)

        # Make sure it is clear which tab is currently selected

        self.tabbed_widget.setStyleSheet(
            &#34;&#34;&#34;QTabBar::tab:selected{background: gray}&#34;&#34;&#34;)

    def close_tab(self, current_index):
        &#34;&#34;&#34; Close the tab with the given index. &#34;&#34;&#34;

        current_widget = self.tabbed_widget.widget(current_index)

        # Remember that the tab has been closed

        self.open_tabs.remove(current_widget.accessibleName())

        current_widget.deleteLater()
        self.tabbed_widget.removeTab(current_index)

    def clear_filter(self):
        &#34;&#34;&#34; Clear the filter.

        The following actions are taken:
            - the text field with the filter is cleared;
            - the list needs to be updated (it should show all available setups again);
            - the tabs are cleared.
        &#34;&#34;&#34;

        # Clear filter

        self.filter.setText(&#34;&#34;)
        self.filter.repaint()

        # Clear + re-build combobox

        self.filter_list.clear()
        self.update_list()
        self.filter_list.repaint()

        # Clear tabs

        self.clear_tabs()

    def clear_tabs(self):
        &#34;&#34;&#34; Clear the tabs.

        Clear the tabs on the right-hand side and clear the list of setups for which a tab was opened already.
        &#34;&#34;&#34;

        self.tabbed_widget.clear()

        # Remember that all tabs were closed

        self.open_tabs.clear()

    def apply_filter(self):
        &#34;&#34;&#34; Apply the filter.

        The following actions are taken:
            - the list needs to be updated (it should only contain the setups that pass the filtering);
            - the tabs are closed.
        &#34;&#34;&#34;

        # Clear + re-build combobox

        self.filter_list.clear()
        self.update_list()

        # Clear tabs

        self.clear_tabs()

    def update_list(self):

        self.filter_list.addItem(None)

        try:

            filter_dict = self.get_filter_dict()

            try:

                with ConfigurationManagerProxy() as cm:

                    setup_overview = cm.list_setups(**filter_dict)

                    for setup_id, setup_site, description, cam_id in setup_overview:
                        self.filter_list.addItem(f&#34;{setup_site} {setup_id} {cam_id} – {description}&#34;)

            except ConnectionError:

                description = &#34;Connection with Configuration Manager was lost.&#34;
                info_text = &#34;Check the status of the core services (and re-start when necessary)&#34;
                show_warning_message(description, info_text=info_text)

        except ValueError:

            description = &#34;Invalid filter text&#34;

            into_text = (
                &#34;When using multiple filtering conditions, they should be comma-separated. \n&#34;
                &#34;Individual filtering conditions should follow the pattern key = value, where `key` should &#34;
                &#34;match the dot notation from the setup file (e.g. gse.hexapod.ID = 2).&#34;
            )

            show_warning_message(description, into_text)

    def get_filter_dict(self):
        &#34;&#34;&#34; Convert the content of the filter text field to a dictionary.
        &#34;&#34;&#34;

        filter_text = self.filter.text()
        filter_text = &#39;&#39;.join(filter_text.split())  # Get rid of any blanks

        # No filter was applied
        # Return an empty dictionary

        if filter_text == &#34;&#34;:

            return {}

        else:

            # Split by search term (comma-separated)

            filter_dict = dict(e.split(&#39;=&#39;) for e in filter_text.split(&#39;, &#39;))

            for key, value in filter_dict.items():

                try:

                    # Integer should be integers (not strings)

                    filter_dict[key] = int(value)

                except ValueError:

                    # Get rid of the quotes

                    filter_dict[key] = value[1:-1]

                # Allow for dot-navigation

                key.replace(&#34;.&#34;, &#34;__&#34;)

            return filter_dict

    def view_setup(self, value: str):
        &#34;&#34;&#34; Show the setup that was selected in the drop-down menu, in a tab.

        Args:
            - value: Selected value from the drop-down menu, which contains the site and setup identifier.
        &#34;&#34;&#34;

        if value != &#34;&#34;:

            site, setup_id, _ = value.split(&#34; &#34;, 2)

            # Tab already open

            if (site + &#34; &#34; + setup_id) in self.open_tabs:

                return
            
            self.open_setup_tab(setup_id, site)

    def open_setup_tab(self, setup_id, setup_site):
        &#34;&#34;&#34; Show the setup file with the given filename in a tab.

        Args:
            - filename: Filename of the setup to show in a tab.
        &#34;&#34;&#34;

        setup_tab = QGroupBox()
        layout = QVBoxLayout()
        setup_tab.setLayout(layout)

        # Setup

        setup_text = QTextBrowser()

        with ConfigurationManagerProxy() as cm:
            setup = cm.get_setup(setup_id=int(setup_id))

        console = Console(width=120, force_terminal=False, force_jupyter=False)
        with console.capture() as capture:
            console.print(setup)
        text = capture.get()
        setup_text.setText(text)

        # setup_text.setHorizontalScrollBarPolicy(Qt.ScrollBarAlwaysOn)
        # setup_text.setVerticalScrollBarPolicy(Qt.ScrollBarAlwaysOn)

        layout.addWidget(setup_text)

        tab_name = setup_site + &#34; &#34; + setup_id
        setup_tab.setAccessibleName(tab_name)
        # setup_tab.setStatusTip(f&#34;Setup for {filename}.&#34;)
        self.tabbed_widget.addTab(setup_tab, tab_name)

        # Bring the new tab into focus

        self.tabbed_widget.setCurrentIndex(self.tabbed_widget.count() - 1)

        # Remember that a tab was opened for this setup

        self.open_tabs.append(tab_name)


# class SetupUIModel:
#
#     def __init__(self):
#         &#34;&#34;&#34; Initialisation of the Process Manager UI model.&#34;&#34;&#34;
#
#         try:
#
#             self.configuration_manager = ConfigurationManagerProxy()
#
#         except ConnectionError:
#
#             self.configuration_manager = None
#
#     def is_connected(self):
#         &#34;&#34;&#34; Checks whether the Process Manager Control Server is active.
#
#         Checks whether a connection to the Process Manager Control Server has been established.
#
#         Returns:
#             - True if a connection to the Process Manager Control Server has been established; False otherwise.
#         &#34;&#34;&#34;
#
#         return self.configuration_manager.ping() and self.configuration_manager.is_cs_connected()
#
#
# class SetupUIController:
#
#     def __init__(self, model: SetupUIModel,
#                  view: SetupUIView):
#         &#34;&#34;&#34; Initialisation of the Controller for the Process Manager GUI.
#         Args:
#             - model: Process Manager UI model.
#             - view: Process Manager UI view.
#         &#34;&#34;&#34;
#
#         self.model = model
#         self.view = view
#
#
#
#     def update(self, changed_object):
#         &#34;&#34;&#34; Define button press actions for the toolbar.
#         Define which actions should be taken when which button (in the toolbar)
#         is pressed in the Process Manager GUI.  The following button are
#         available:
#             - starting all device Control Servers in the current setup;
#             - shutting down all device Control Servers in the current setup;
#             - showing pop-up window with an explanation about the process
#               status.
#         &#34;&#34;&#34;
#
#         pass
#
#     def do(self):
#         pass
#

def main():
    &#34;&#34;&#34; Main method to launch the Process Manager GUI.&#34;&#34;&#34;

    app = QApplication(sys.argv)

    # Check whether the Process Manager CS is running
    # (show a warning in a pop-up window if it&#39;s not)

    view = SetupUIView()

    view.show()

    return app.exec_()


if __name__ == &#39;__main__&#39;:
    sys.exit(main())</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="egse.confman.setup_ui.main"><code class="name flex">
<span>def <span class="ident">main</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"><p>Main method to launch the Process Manager GUI.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def main():
    &#34;&#34;&#34; Main method to launch the Process Manager GUI.&#34;&#34;&#34;

    app = QApplication(sys.argv)

    # Check whether the Process Manager CS is running
    # (show a warning in a pop-up window if it&#39;s not)

    view = SetupUIView()

    view.show()

    return app.exec_()</code></pre>
</details>
</dd>
</dl>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="egse.confman.setup_ui.SetupUIView"><code class="flex name class">
<span>class <span class="ident">SetupUIView</span></span>
</code></dt>
<dd>
<div class="desc"><p>QMainWindow(parent: QWidget = None, flags: Union[Qt.WindowFlags, Qt.WindowType] = Qt.WindowFlags())</p>
<p>Initialisation of the GUI to inspect the available setups.</p>
<p>The components are placed in the window:
- on the left-hand side: filtering of the setups + list with the setups that meet the conditions from the
filter;
- right-hand side: tabs with setup that were opened for visual inspection.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class SetupUIView(QMainWindow):

    def __init__(self):
        &#34;&#34;&#34; Initialisation of the GUI to inspect the available setups.

        The components are placed in the window:
            - on the left-hand side: filtering of the setups + list with the setups that meet the conditions from the
              filter;
            - right-hand side: tabs with setup that were opened for visual inspection.
        &#34;&#34;&#34;

        super().__init__()

        self.setGeometry(300, 300, 1200, 1000)

        cm_ctrl_settings = Settings.load(&#34;Configuration Manager Control Server&#34;)
        location = replace_environment_variable(cm_ctrl_settings.FILE_STORAGE_LOCATION)
        self._data_conf_location = Path(location) if location else get_common_egse_root()

        self.setWindowTitle(f&#34;Available Setups ({self._data_conf_location})&#34;)

        # Build up the GUI

        self.toolbar = self.addToolBar(&#34;MainToolbar&#34;)

        self.filter = QLineEdit()
        self.filter_list = QListWidget()
        self.tabbed_widget = QTabWidget()

        self.init_ui()

        # Keep track of which setups have been opened in a tab

        self.open_tabs = []

    def resizeEvent(self, event):
        &#34;&#34;&#34; Re-sizing of the main window.

        Args:
            - event: Re-size event.
        &#34;&#34;&#34;

        QMainWindow.resizeEvent(self, event)
        self.filter_list.setMinimumSize(self.width() / 2 - 50, self.height() - 200)

    def init_ui(self):
        &#34;&#34;&#34; Put the components in the GUI window.

        The GUI comprises the following components:
            - on the left-hand side: filtering of the setups + list with the setups that meet the conditions from the
              filter;
            - right-hand side: tabs with setup that were opened for visual inspection.
        &#34;&#34;&#34;

        # Creating the content

        app_frame = QFrame()
        app_frame.setObjectName(&#34;AppFrame&#34;)

        self.create_toolbar()
        self.create_statusbar()

        # Left-hand side: filtering + drop-down menu

        lhs_layout = QVBoxLayout()
        lhs_frame = QFrame()

        filter_widget = self.make_filter_widget()
        self.update_list()

        lhs_layout.addWidget(filter_widget)
        lhs_layout.addWidget(self.filter_list)

        lhs_layout.addStretch()
        lhs_frame.setLayout(lhs_layout)

        # Right-hand side: tabs

        self.make_tabbed_widget()

        # Put everything together

        layout = QHBoxLayout()
        splitter = QSplitter(Qt.Horizontal)

        splitter.addWidget(lhs_frame)
        splitter.addWidget(self.tabbed_widget)
        splitter.setSizes([500, 1000])

        layout.addWidget(splitter)
        app_frame.setLayout(layout)

        self.setCentralWidget(app_frame)

    def create_toolbar(self):
        &#34;&#34;&#34; Configure the toolbar.

        The toolbar comprises a single button that allows you to load the setup that is shown in the active tab.
        &#34;&#34;&#34;

        load_setup_pix = QPixmap(str(find_file(&#34;load.png&#34;, in_dir=&#34;images&#34;)))
        load_setup_icon = QIcon()
        load_setup_icon.addPixmap(load_setup_pix, QIcon.Normal, QIcon.On)

        load_setup_action = QAction(load_setup_icon, &#34;Load the current setup&#34;, self)
        load_setup_action.setStatusTip(&#34;Load setup shown in the active tab.&#34;)
        load_setup_action.setCheckable(False)
        load_setup_action.triggered.connect(self.load_setup)

        self.toolbar.addAction(load_setup_action)

        return self.toolbar

    def create_statusbar(self):
        &#34;&#34;&#34; Create a status bar.

        Returns: Status bar.
        &#34;&#34;&#34;

        self.statusBar().setStyleSheet(&#34;border: 0; background-color: #FFF8DC;&#34;)
        self.statusBar().setStyleSheet(&#34;QStatusBar::item {border: none;}&#34;)
        self.statusBar().addPermanentWidget(VLine())

    def load_setup(self):
        &#34;&#34;&#34;Load the setup that is shown in the active tab. &#34;&#34;&#34;

        current_widget = self.tabbed_widget.currentWidget()

        if current_widget is None:

            description = &#34;No setup selected.&#34;
            info_text = &#34;You can view setup files by selecting them in the list.  They will be opened in &#34; \
                        + &#34;individual tabs on the right-hand side.  \n\nTo be able to load a specific setup, bring &#34; \
                        + &#34;the corresponding tab into focus.&#34;

            show_warning_message(description, info_text=info_text)

        else:

            site, setup_id = current_widget.accessibleName().split(&#34; &#34;)

            if site == SITE:

                try:

                    with ConfigurationManagerProxy() as cm:

                        load_result = cm.load_setup(int(setup_id))

                        if isinstance(load_result, Failure):

                            description = f&#34;Setup {setup_id} could not be loaded for {site}&#34;
                            info_text = load_result.message

                            show_warning_message(description, info_text=info_text)

                        else:

                            description = f&#34;Loaded setup {setup_id} for {site}&#34;
                            show_info_message(description)

                except ConnectionError:

                    description = &#34;Connection with Configuration Manager was lost.&#34;
                    info_text = &#34;Check the status of the core services (and re-start when necessary)&#34;
                    show_warning_message(description, info_text=info_text)

            else:

                description = &#34;Wrong site ID.&#34;
                info_text = f&#34;The site ID mentioned in the setup file ({site}) does not match the site you are at &#34; \
                            + &#34;f({SITE}), according to the settings file.  Therefore, loading this setup was prevented.&#34;
                show_warning_message(description, info_text=info_text)

    def make_filter_widget(self):
        &#34;&#34;&#34; Make widget where the available setups can be filtered:

        This widgets consists of the following elements:
            - text field in which the filter can be specified: when the return key is pressed, the filter is applied
              (i.e. all tabs are closed and the drop-down menu is updated);
            - search button: when this is pressed, the filter is applied (i.e. all tabs are closed and the list is
              updated);
            - clear button: when this is pressed, the filter is cleared (i.e. all tabs are closed and the list is
              updated).
        &#34;&#34;&#34;

        layout = QHBoxLayout()

        widget = QGroupBox(&#34;Filter&#34;, self)

        # Text field for the filter

        self.filter.returnPressed.connect(self.apply_filter)
        self.filter.setStatusTip(&#34;Filtering of available setups, e.g. &#34; +
                                 &#34;site_id=\&#34;CSL\&#34;, gse.hexapod.ID=2, camera.model=\&#34;STM\&#34;.&#34;)
        layout.addWidget(self.filter)

        # Search button

        search_icon = QIcon(str(find_file(&#34;search.png&#34;, in_dir=&#34;images&#34;)))
        search_button = QPushButton()
        search_button.setIcon(search_icon)
        search_button.setStatusTip(&#34;Apply filter (alternatively hit return key in the text field).&#34;)
        search_button.clicked.connect(self.apply_filter)

        layout.addWidget(search_button)

        # Clear button

        clear_icon = QIcon(str(find_file(&#34;cross.svg&#34;, in_dir=&#34;images&#34;)))
        clear_button = QPushButton()
        clear_button.setIcon(clear_icon)
        clear_button.setStatusTip(&#34;Clear filter.&#34;)
        clear_button.clicked.connect(self.clear_filter)

        layout.addWidget(clear_button)

        widget.setLayout(layout)

        # Make the drop-down menu listen to selections

        self.filter_list.currentTextChanged.connect(self.view_setup)
        self.filter_list.setStatusTip(f&#34;All available setups in {self._data_conf_location} &#34;
                                      f&#34;that meet the filter condition(s).&#34;)

        return widget

    def make_tabbed_widget(self):

        self.tabbed_widget.setTabsClosable(True)
        self.tabbed_widget.tabCloseRequested.connect(self.close_tab)
        self.tabbed_widget.setMovable(False)
        self.tabbed_widget.setDocumentMode(True)
        self.tabbed_widget.setElideMode(Qt.ElideRight)
        self.tabbed_widget.setUsesScrollButtons(True)

        # Make sure it is clear which tab is currently selected

        self.tabbed_widget.setStyleSheet(
            &#34;&#34;&#34;QTabBar::tab:selected{background: gray}&#34;&#34;&#34;)

    def close_tab(self, current_index):
        &#34;&#34;&#34; Close the tab with the given index. &#34;&#34;&#34;

        current_widget = self.tabbed_widget.widget(current_index)

        # Remember that the tab has been closed

        self.open_tabs.remove(current_widget.accessibleName())

        current_widget.deleteLater()
        self.tabbed_widget.removeTab(current_index)

    def clear_filter(self):
        &#34;&#34;&#34; Clear the filter.

        The following actions are taken:
            - the text field with the filter is cleared;
            - the list needs to be updated (it should show all available setups again);
            - the tabs are cleared.
        &#34;&#34;&#34;

        # Clear filter

        self.filter.setText(&#34;&#34;)
        self.filter.repaint()

        # Clear + re-build combobox

        self.filter_list.clear()
        self.update_list()
        self.filter_list.repaint()

        # Clear tabs

        self.clear_tabs()

    def clear_tabs(self):
        &#34;&#34;&#34; Clear the tabs.

        Clear the tabs on the right-hand side and clear the list of setups for which a tab was opened already.
        &#34;&#34;&#34;

        self.tabbed_widget.clear()

        # Remember that all tabs were closed

        self.open_tabs.clear()

    def apply_filter(self):
        &#34;&#34;&#34; Apply the filter.

        The following actions are taken:
            - the list needs to be updated (it should only contain the setups that pass the filtering);
            - the tabs are closed.
        &#34;&#34;&#34;

        # Clear + re-build combobox

        self.filter_list.clear()
        self.update_list()

        # Clear tabs

        self.clear_tabs()

    def update_list(self):

        self.filter_list.addItem(None)

        try:

            filter_dict = self.get_filter_dict()

            try:

                with ConfigurationManagerProxy() as cm:

                    setup_overview = cm.list_setups(**filter_dict)

                    for setup_id, setup_site, description, cam_id in setup_overview:
                        self.filter_list.addItem(f&#34;{setup_site} {setup_id} {cam_id} – {description}&#34;)

            except ConnectionError:

                description = &#34;Connection with Configuration Manager was lost.&#34;
                info_text = &#34;Check the status of the core services (and re-start when necessary)&#34;
                show_warning_message(description, info_text=info_text)

        except ValueError:

            description = &#34;Invalid filter text&#34;

            into_text = (
                &#34;When using multiple filtering conditions, they should be comma-separated. \n&#34;
                &#34;Individual filtering conditions should follow the pattern key = value, where `key` should &#34;
                &#34;match the dot notation from the setup file (e.g. gse.hexapod.ID = 2).&#34;
            )

            show_warning_message(description, into_text)

    def get_filter_dict(self):
        &#34;&#34;&#34; Convert the content of the filter text field to a dictionary.
        &#34;&#34;&#34;

        filter_text = self.filter.text()
        filter_text = &#39;&#39;.join(filter_text.split())  # Get rid of any blanks

        # No filter was applied
        # Return an empty dictionary

        if filter_text == &#34;&#34;:

            return {}

        else:

            # Split by search term (comma-separated)

            filter_dict = dict(e.split(&#39;=&#39;) for e in filter_text.split(&#39;, &#39;))

            for key, value in filter_dict.items():

                try:

                    # Integer should be integers (not strings)

                    filter_dict[key] = int(value)

                except ValueError:

                    # Get rid of the quotes

                    filter_dict[key] = value[1:-1]

                # Allow for dot-navigation

                key.replace(&#34;.&#34;, &#34;__&#34;)

            return filter_dict

    def view_setup(self, value: str):
        &#34;&#34;&#34; Show the setup that was selected in the drop-down menu, in a tab.

        Args:
            - value: Selected value from the drop-down menu, which contains the site and setup identifier.
        &#34;&#34;&#34;

        if value != &#34;&#34;:

            site, setup_id, _ = value.split(&#34; &#34;, 2)

            # Tab already open

            if (site + &#34; &#34; + setup_id) in self.open_tabs:

                return
            
            self.open_setup_tab(setup_id, site)

    def open_setup_tab(self, setup_id, setup_site):
        &#34;&#34;&#34; Show the setup file with the given filename in a tab.

        Args:
            - filename: Filename of the setup to show in a tab.
        &#34;&#34;&#34;

        setup_tab = QGroupBox()
        layout = QVBoxLayout()
        setup_tab.setLayout(layout)

        # Setup

        setup_text = QTextBrowser()

        with ConfigurationManagerProxy() as cm:
            setup = cm.get_setup(setup_id=int(setup_id))

        console = Console(width=120, force_terminal=False, force_jupyter=False)
        with console.capture() as capture:
            console.print(setup)
        text = capture.get()
        setup_text.setText(text)

        # setup_text.setHorizontalScrollBarPolicy(Qt.ScrollBarAlwaysOn)
        # setup_text.setVerticalScrollBarPolicy(Qt.ScrollBarAlwaysOn)

        layout.addWidget(setup_text)

        tab_name = setup_site + &#34; &#34; + setup_id
        setup_tab.setAccessibleName(tab_name)
        # setup_tab.setStatusTip(f&#34;Setup for {filename}.&#34;)
        self.tabbed_widget.addTab(setup_tab, tab_name)

        # Bring the new tab into focus

        self.tabbed_widget.setCurrentIndex(self.tabbed_widget.count() - 1)

        # Remember that a tab was opened for this setup

        self.open_tabs.append(tab_name)</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>PyQt5.QtWidgets.QMainWindow</li>
<li>PyQt5.QtWidgets.QWidget</li>
<li>PyQt5.QtCore.QObject</li>
<li>sip.wrapper</li>
<li>PyQt5.QtGui.QPaintDevice</li>
<li>sip.simplewrapper</li>
</ul>
<h3>Methods</h3>
<dl>
<dt id="egse.confman.setup_ui.SetupUIView.apply_filter"><code class="name flex">
<span>def <span class="ident">apply_filter</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Apply the filter.</p>
<p>The following actions are taken:
- the list needs to be updated (it should only contain the setups that pass the filtering);
- the tabs are closed.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def apply_filter(self):
    &#34;&#34;&#34; Apply the filter.

    The following actions are taken:
        - the list needs to be updated (it should only contain the setups that pass the filtering);
        - the tabs are closed.
    &#34;&#34;&#34;

    # Clear + re-build combobox

    self.filter_list.clear()
    self.update_list()

    # Clear tabs

    self.clear_tabs()</code></pre>
</details>
</dd>
<dt id="egse.confman.setup_ui.SetupUIView.clear_filter"><code class="name flex">
<span>def <span class="ident">clear_filter</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Clear the filter.</p>
<p>The following actions are taken:
- the text field with the filter is cleared;
- the list needs to be updated (it should show all available setups again);
- the tabs are cleared.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def clear_filter(self):
    &#34;&#34;&#34; Clear the filter.

    The following actions are taken:
        - the text field with the filter is cleared;
        - the list needs to be updated (it should show all available setups again);
        - the tabs are cleared.
    &#34;&#34;&#34;

    # Clear filter

    self.filter.setText(&#34;&#34;)
    self.filter.repaint()

    # Clear + re-build combobox

    self.filter_list.clear()
    self.update_list()
    self.filter_list.repaint()

    # Clear tabs

    self.clear_tabs()</code></pre>
</details>
</dd>
<dt id="egse.confman.setup_ui.SetupUIView.clear_tabs"><code class="name flex">
<span>def <span class="ident">clear_tabs</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Clear the tabs.</p>
<p>Clear the tabs on the right-hand side and clear the list of setups for which a tab was opened already.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def clear_tabs(self):
    &#34;&#34;&#34; Clear the tabs.

    Clear the tabs on the right-hand side and clear the list of setups for which a tab was opened already.
    &#34;&#34;&#34;

    self.tabbed_widget.clear()

    # Remember that all tabs were closed

    self.open_tabs.clear()</code></pre>
</details>
</dd>
<dt id="egse.confman.setup_ui.SetupUIView.close_tab"><code class="name flex">
<span>def <span class="ident">close_tab</span></span>(<span>self, current_index)</span>
</code></dt>
<dd>
<div class="desc"><p>Close the tab with the given index.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def close_tab(self, current_index):
    &#34;&#34;&#34; Close the tab with the given index. &#34;&#34;&#34;

    current_widget = self.tabbed_widget.widget(current_index)

    # Remember that the tab has been closed

    self.open_tabs.remove(current_widget.accessibleName())

    current_widget.deleteLater()
    self.tabbed_widget.removeTab(current_index)</code></pre>
</details>
</dd>
<dt id="egse.confman.setup_ui.SetupUIView.create_statusbar"><code class="name flex">
<span>def <span class="ident">create_statusbar</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Create a status bar.</p>
<p>Returns: Status bar.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def create_statusbar(self):
    &#34;&#34;&#34; Create a status bar.

    Returns: Status bar.
    &#34;&#34;&#34;

    self.statusBar().setStyleSheet(&#34;border: 0; background-color: #FFF8DC;&#34;)
    self.statusBar().setStyleSheet(&#34;QStatusBar::item {border: none;}&#34;)
    self.statusBar().addPermanentWidget(VLine())</code></pre>
</details>
</dd>
<dt id="egse.confman.setup_ui.SetupUIView.create_toolbar"><code class="name flex">
<span>def <span class="ident">create_toolbar</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Configure the toolbar.</p>
<p>The toolbar comprises a single button that allows you to load the setup that is shown in the active tab.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def create_toolbar(self):
    &#34;&#34;&#34; Configure the toolbar.

    The toolbar comprises a single button that allows you to load the setup that is shown in the active tab.
    &#34;&#34;&#34;

    load_setup_pix = QPixmap(str(find_file(&#34;load.png&#34;, in_dir=&#34;images&#34;)))
    load_setup_icon = QIcon()
    load_setup_icon.addPixmap(load_setup_pix, QIcon.Normal, QIcon.On)

    load_setup_action = QAction(load_setup_icon, &#34;Load the current setup&#34;, self)
    load_setup_action.setStatusTip(&#34;Load setup shown in the active tab.&#34;)
    load_setup_action.setCheckable(False)
    load_setup_action.triggered.connect(self.load_setup)

    self.toolbar.addAction(load_setup_action)

    return self.toolbar</code></pre>
</details>
</dd>
<dt id="egse.confman.setup_ui.SetupUIView.get_filter_dict"><code class="name flex">
<span>def <span class="ident">get_filter_dict</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Convert the content of the filter text field to a dictionary.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_filter_dict(self):
    &#34;&#34;&#34; Convert the content of the filter text field to a dictionary.
    &#34;&#34;&#34;

    filter_text = self.filter.text()
    filter_text = &#39;&#39;.join(filter_text.split())  # Get rid of any blanks

    # No filter was applied
    # Return an empty dictionary

    if filter_text == &#34;&#34;:

        return {}

    else:

        # Split by search term (comma-separated)

        filter_dict = dict(e.split(&#39;=&#39;) for e in filter_text.split(&#39;, &#39;))

        for key, value in filter_dict.items():

            try:

                # Integer should be integers (not strings)

                filter_dict[key] = int(value)

            except ValueError:

                # Get rid of the quotes

                filter_dict[key] = value[1:-1]

            # Allow for dot-navigation

            key.replace(&#34;.&#34;, &#34;__&#34;)

        return filter_dict</code></pre>
</details>
</dd>
<dt id="egse.confman.setup_ui.SetupUIView.init_ui"><code class="name flex">
<span>def <span class="ident">init_ui</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Put the components in the GUI window.</p>
<p>The GUI comprises the following components:
- on the left-hand side: filtering of the setups + list with the setups that meet the conditions from the
filter;
- right-hand side: tabs with setup that were opened for visual inspection.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def init_ui(self):
    &#34;&#34;&#34; Put the components in the GUI window.

    The GUI comprises the following components:
        - on the left-hand side: filtering of the setups + list with the setups that meet the conditions from the
          filter;
        - right-hand side: tabs with setup that were opened for visual inspection.
    &#34;&#34;&#34;

    # Creating the content

    app_frame = QFrame()
    app_frame.setObjectName(&#34;AppFrame&#34;)

    self.create_toolbar()
    self.create_statusbar()

    # Left-hand side: filtering + drop-down menu

    lhs_layout = QVBoxLayout()
    lhs_frame = QFrame()

    filter_widget = self.make_filter_widget()
    self.update_list()

    lhs_layout.addWidget(filter_widget)
    lhs_layout.addWidget(self.filter_list)

    lhs_layout.addStretch()
    lhs_frame.setLayout(lhs_layout)

    # Right-hand side: tabs

    self.make_tabbed_widget()

    # Put everything together

    layout = QHBoxLayout()
    splitter = QSplitter(Qt.Horizontal)

    splitter.addWidget(lhs_frame)
    splitter.addWidget(self.tabbed_widget)
    splitter.setSizes([500, 1000])

    layout.addWidget(splitter)
    app_frame.setLayout(layout)

    self.setCentralWidget(app_frame)</code></pre>
</details>
</dd>
<dt id="egse.confman.setup_ui.SetupUIView.load_setup"><code class="name flex">
<span>def <span class="ident">load_setup</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Load the setup that is shown in the active tab.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def load_setup(self):
    &#34;&#34;&#34;Load the setup that is shown in the active tab. &#34;&#34;&#34;

    current_widget = self.tabbed_widget.currentWidget()

    if current_widget is None:

        description = &#34;No setup selected.&#34;
        info_text = &#34;You can view setup files by selecting them in the list.  They will be opened in &#34; \
                    + &#34;individual tabs on the right-hand side.  \n\nTo be able to load a specific setup, bring &#34; \
                    + &#34;the corresponding tab into focus.&#34;

        show_warning_message(description, info_text=info_text)

    else:

        site, setup_id = current_widget.accessibleName().split(&#34; &#34;)

        if site == SITE:

            try:

                with ConfigurationManagerProxy() as cm:

                    load_result = cm.load_setup(int(setup_id))

                    if isinstance(load_result, Failure):

                        description = f&#34;Setup {setup_id} could not be loaded for {site}&#34;
                        info_text = load_result.message

                        show_warning_message(description, info_text=info_text)

                    else:

                        description = f&#34;Loaded setup {setup_id} for {site}&#34;
                        show_info_message(description)

            except ConnectionError:

                description = &#34;Connection with Configuration Manager was lost.&#34;
                info_text = &#34;Check the status of the core services (and re-start when necessary)&#34;
                show_warning_message(description, info_text=info_text)

        else:

            description = &#34;Wrong site ID.&#34;
            info_text = f&#34;The site ID mentioned in the setup file ({site}) does not match the site you are at &#34; \
                        + &#34;f({SITE}), according to the settings file.  Therefore, loading this setup was prevented.&#34;
            show_warning_message(description, info_text=info_text)</code></pre>
</details>
</dd>
<dt id="egse.confman.setup_ui.SetupUIView.make_filter_widget"><code class="name flex">
<span>def <span class="ident">make_filter_widget</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Make widget where the available setups can be filtered:</p>
<p>This widgets consists of the following elements:
- text field in which the filter can be specified: when the return key is pressed, the filter is applied
(i.e. all tabs are closed and the drop-down menu is updated);
- search button: when this is pressed, the filter is applied (i.e. all tabs are closed and the list is
updated);
- clear button: when this is pressed, the filter is cleared (i.e. all tabs are closed and the list is
updated).</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def make_filter_widget(self):
    &#34;&#34;&#34; Make widget where the available setups can be filtered:

    This widgets consists of the following elements:
        - text field in which the filter can be specified: when the return key is pressed, the filter is applied
          (i.e. all tabs are closed and the drop-down menu is updated);
        - search button: when this is pressed, the filter is applied (i.e. all tabs are closed and the list is
          updated);
        - clear button: when this is pressed, the filter is cleared (i.e. all tabs are closed and the list is
          updated).
    &#34;&#34;&#34;

    layout = QHBoxLayout()

    widget = QGroupBox(&#34;Filter&#34;, self)

    # Text field for the filter

    self.filter.returnPressed.connect(self.apply_filter)
    self.filter.setStatusTip(&#34;Filtering of available setups, e.g. &#34; +
                             &#34;site_id=\&#34;CSL\&#34;, gse.hexapod.ID=2, camera.model=\&#34;STM\&#34;.&#34;)
    layout.addWidget(self.filter)

    # Search button

    search_icon = QIcon(str(find_file(&#34;search.png&#34;, in_dir=&#34;images&#34;)))
    search_button = QPushButton()
    search_button.setIcon(search_icon)
    search_button.setStatusTip(&#34;Apply filter (alternatively hit return key in the text field).&#34;)
    search_button.clicked.connect(self.apply_filter)

    layout.addWidget(search_button)

    # Clear button

    clear_icon = QIcon(str(find_file(&#34;cross.svg&#34;, in_dir=&#34;images&#34;)))
    clear_button = QPushButton()
    clear_button.setIcon(clear_icon)
    clear_button.setStatusTip(&#34;Clear filter.&#34;)
    clear_button.clicked.connect(self.clear_filter)

    layout.addWidget(clear_button)

    widget.setLayout(layout)

    # Make the drop-down menu listen to selections

    self.filter_list.currentTextChanged.connect(self.view_setup)
    self.filter_list.setStatusTip(f&#34;All available setups in {self._data_conf_location} &#34;
                                  f&#34;that meet the filter condition(s).&#34;)

    return widget</code></pre>
</details>
</dd>
<dt id="egse.confman.setup_ui.SetupUIView.make_tabbed_widget"><code class="name flex">
<span>def <span class="ident">make_tabbed_widget</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def make_tabbed_widget(self):

    self.tabbed_widget.setTabsClosable(True)
    self.tabbed_widget.tabCloseRequested.connect(self.close_tab)
    self.tabbed_widget.setMovable(False)
    self.tabbed_widget.setDocumentMode(True)
    self.tabbed_widget.setElideMode(Qt.ElideRight)
    self.tabbed_widget.setUsesScrollButtons(True)

    # Make sure it is clear which tab is currently selected

    self.tabbed_widget.setStyleSheet(
        &#34;&#34;&#34;QTabBar::tab:selected{background: gray}&#34;&#34;&#34;)</code></pre>
</details>
</dd>
<dt id="egse.confman.setup_ui.SetupUIView.open_setup_tab"><code class="name flex">
<span>def <span class="ident">open_setup_tab</span></span>(<span>self, setup_id, setup_site)</span>
</code></dt>
<dd>
<div class="desc"><p>Show the setup file with the given filename in a tab.</p>
<h2 id="args">Args</h2>
<ul>
<li>filename: Filename of the setup to show in a tab.</li>
</ul></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def open_setup_tab(self, setup_id, setup_site):
    &#34;&#34;&#34; Show the setup file with the given filename in a tab.

    Args:
        - filename: Filename of the setup to show in a tab.
    &#34;&#34;&#34;

    setup_tab = QGroupBox()
    layout = QVBoxLayout()
    setup_tab.setLayout(layout)

    # Setup

    setup_text = QTextBrowser()

    with ConfigurationManagerProxy() as cm:
        setup = cm.get_setup(setup_id=int(setup_id))

    console = Console(width=120, force_terminal=False, force_jupyter=False)
    with console.capture() as capture:
        console.print(setup)
    text = capture.get()
    setup_text.setText(text)

    # setup_text.setHorizontalScrollBarPolicy(Qt.ScrollBarAlwaysOn)
    # setup_text.setVerticalScrollBarPolicy(Qt.ScrollBarAlwaysOn)

    layout.addWidget(setup_text)

    tab_name = setup_site + &#34; &#34; + setup_id
    setup_tab.setAccessibleName(tab_name)
    # setup_tab.setStatusTip(f&#34;Setup for {filename}.&#34;)
    self.tabbed_widget.addTab(setup_tab, tab_name)

    # Bring the new tab into focus

    self.tabbed_widget.setCurrentIndex(self.tabbed_widget.count() - 1)

    # Remember that a tab was opened for this setup

    self.open_tabs.append(tab_name)</code></pre>
</details>
</dd>
<dt id="egse.confman.setup_ui.SetupUIView.resizeEvent"><code class="name flex">
<span>def <span class="ident">resizeEvent</span></span>(<span>self, event)</span>
</code></dt>
<dd>
<div class="desc"><p>Re-sizing of the main window.</p>
<h2 id="args">Args</h2>
<ul>
<li>event: Re-size event.</li>
</ul></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def resizeEvent(self, event):
    &#34;&#34;&#34; Re-sizing of the main window.

    Args:
        - event: Re-size event.
    &#34;&#34;&#34;

    QMainWindow.resizeEvent(self, event)
    self.filter_list.setMinimumSize(self.width() / 2 - 50, self.height() - 200)</code></pre>
</details>
</dd>
<dt id="egse.confman.setup_ui.SetupUIView.update_list"><code class="name flex">
<span>def <span class="ident">update_list</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def update_list(self):

    self.filter_list.addItem(None)

    try:

        filter_dict = self.get_filter_dict()

        try:

            with ConfigurationManagerProxy() as cm:

                setup_overview = cm.list_setups(**filter_dict)

                for setup_id, setup_site, description, cam_id in setup_overview:
                    self.filter_list.addItem(f&#34;{setup_site} {setup_id} {cam_id} – {description}&#34;)

        except ConnectionError:

            description = &#34;Connection with Configuration Manager was lost.&#34;
            info_text = &#34;Check the status of the core services (and re-start when necessary)&#34;
            show_warning_message(description, info_text=info_text)

    except ValueError:

        description = &#34;Invalid filter text&#34;

        into_text = (
            &#34;When using multiple filtering conditions, they should be comma-separated. \n&#34;
            &#34;Individual filtering conditions should follow the pattern key = value, where `key` should &#34;
            &#34;match the dot notation from the setup file (e.g. gse.hexapod.ID = 2).&#34;
        )

        show_warning_message(description, into_text)</code></pre>
</details>
</dd>
<dt id="egse.confman.setup_ui.SetupUIView.view_setup"><code class="name flex">
<span>def <span class="ident">view_setup</span></span>(<span>self, value: str)</span>
</code></dt>
<dd>
<div class="desc"><p>Show the setup that was selected in the drop-down menu, in a tab.</p>
<h2 id="args">Args</h2>
<ul>
<li>value: Selected value from the drop-down menu, which contains the site and setup identifier.</li>
</ul></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def view_setup(self, value: str):
    &#34;&#34;&#34; Show the setup that was selected in the drop-down menu, in a tab.

    Args:
        - value: Selected value from the drop-down menu, which contains the site and setup identifier.
    &#34;&#34;&#34;

    if value != &#34;&#34;:

        site, setup_id, _ = value.split(&#34; &#34;, 2)

        # Tab already open

        if (site + &#34; &#34; + setup_id) in self.open_tabs:

            return
        
        self.open_setup_tab(setup_id, site)</code></pre>
</details>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="egse.confman" href="index.html">egse.confman</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="egse.confman.setup_ui.main" href="#egse.confman.setup_ui.main">main</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="egse.confman.setup_ui.SetupUIView" href="#egse.confman.setup_ui.SetupUIView">SetupUIView</a></code></h4>
<ul class="two-column">
<li><code><a title="egse.confman.setup_ui.SetupUIView.apply_filter" href="#egse.confman.setup_ui.SetupUIView.apply_filter">apply_filter</a></code></li>
<li><code><a title="egse.confman.setup_ui.SetupUIView.clear_filter" href="#egse.confman.setup_ui.SetupUIView.clear_filter">clear_filter</a></code></li>
<li><code><a title="egse.confman.setup_ui.SetupUIView.clear_tabs" href="#egse.confman.setup_ui.SetupUIView.clear_tabs">clear_tabs</a></code></li>
<li><code><a title="egse.confman.setup_ui.SetupUIView.close_tab" href="#egse.confman.setup_ui.SetupUIView.close_tab">close_tab</a></code></li>
<li><code><a title="egse.confman.setup_ui.SetupUIView.create_statusbar" href="#egse.confman.setup_ui.SetupUIView.create_statusbar">create_statusbar</a></code></li>
<li><code><a title="egse.confman.setup_ui.SetupUIView.create_toolbar" href="#egse.confman.setup_ui.SetupUIView.create_toolbar">create_toolbar</a></code></li>
<li><code><a title="egse.confman.setup_ui.SetupUIView.get_filter_dict" href="#egse.confman.setup_ui.SetupUIView.get_filter_dict">get_filter_dict</a></code></li>
<li><code><a title="egse.confman.setup_ui.SetupUIView.init_ui" href="#egse.confman.setup_ui.SetupUIView.init_ui">init_ui</a></code></li>
<li><code><a title="egse.confman.setup_ui.SetupUIView.load_setup" href="#egse.confman.setup_ui.SetupUIView.load_setup">load_setup</a></code></li>
<li><code><a title="egse.confman.setup_ui.SetupUIView.make_filter_widget" href="#egse.confman.setup_ui.SetupUIView.make_filter_widget">make_filter_widget</a></code></li>
<li><code><a title="egse.confman.setup_ui.SetupUIView.make_tabbed_widget" href="#egse.confman.setup_ui.SetupUIView.make_tabbed_widget">make_tabbed_widget</a></code></li>
<li><code><a title="egse.confman.setup_ui.SetupUIView.open_setup_tab" href="#egse.confman.setup_ui.SetupUIView.open_setup_tab">open_setup_tab</a></code></li>
<li><code><a title="egse.confman.setup_ui.SetupUIView.resizeEvent" href="#egse.confman.setup_ui.SetupUIView.resizeEvent">resizeEvent</a></code></li>
<li><code><a title="egse.confman.setup_ui.SetupUIView.update_list" href="#egse.confman.setup_ui.SetupUIView.update_list">update_list</a></code></li>
<li><code><a title="egse.confman.setup_ui.SetupUIView.view_setup" href="#egse.confman.setup_ui.SetupUIView.view_setup">view_setup</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>