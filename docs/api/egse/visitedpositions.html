<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>egse.visitedpositions API documentation</title>
<meta name="description" content="This module provides a GUI to show the visited positions (i.e. the positions at which
the source was put during testing) on the focal plane â€¦" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>egse.visitedpositions</code></h1>
</header>
<section id="section-intro">
<p>This module provides a GUI to show the visited positions (i.e. the positions at which
the source was put during testing) on the focal plane.</p>
<p>To start the GUI, start (i)python and type the following commands:</p>
<pre><code>$ from egse import visitedpositions
$ view = visitedpositions.start_visited_positions_gui()
</code></pre>
<p>Then you can add the visited locations as follows:</p>
<pre><code>* in focal-plane coordinates (x_fp, y_fp) [mm]:
    $ view.visit_focal_plane_position(x_fp, y_fp)

* in CCD coordinates (row, column) [pixel] on a given CCD:
    $ view.visit_ccd_position(row, column, ccd_code)

* in field angles (theta, phi) [degrees]:
    $ view.visit_field_angles(theta, phi)
</code></pre>
<p>At each of these locations, a red dot will appear on the plot.
You can
switch between coordinate system (used in the plot) with the combobox
below the plot window (focal-plane coordinates, pixel coordinates, and
field angles).</p>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">&#34;&#34;&#34;
This module provides a GUI to show the visited positions (i.e. the positions at which 
the source was put during testing) on the focal plane.

To start the GUI, start (i)python and type the following commands:

    $ from egse import visitedpositions
    $ view = visitedpositions.start_visited_positions_gui()

Then you can add the visited locations as follows:

    * in focal-plane coordinates (x_fp, y_fp) [mm]:
        $ view.visit_focal_plane_position(x_fp, y_fp)

    * in CCD coordinates (row, column) [pixel] on a given CCD:
        $ view.visit_ccd_position(row, column, ccd_code)

    * in field angles (theta, phi) [degrees]:
        $ view.visit_field_angles(theta, phi)

At each of these locations, a red dot will appear on the plot.  You can 
switch between coordinate system (used in the plot) with the combobox
below the plot window (focal-plane coordinates, pixel coordinates, and
field angles).
&#34;&#34;&#34;
import os
import pickle
import sys
import threading

import zmq
from PyQt5.QtGui import (QPixmap, QFont)
from PyQt5.QtWidgets import (QApplication, QMainWindow, QFrame, QVBoxLayout, QLabel, QStatusBar)

from egse.coordinates import ccd_to_focal_plane_coordinates, angles_to_focal_plane_coordinates, \
    focal_plane_coordinates_to_angles
from egse.gui.buttons import ToolTouchButton
from egse.gui.focalplane import FocalPlaneWidgetWithVisitedPositions
from egse.resource import get_resource
from egse.settings import Settings
from egse.zmq_ser import bind_address, connect_address

FONT = QFont(&#34;Helvetica&#34;, 18)

SETTINGS = Settings.load(&#34;Visited Positions UI&#34;)


class VisitedPositionsUIController:

    def __init__(self, view):
        &#34;&#34;&#34; Create a controller for the visited-positions GUI.

        Args:
            - view: Visited-positions GUI.
        &#34;&#34;&#34;

        super(VisitedPositionsUIController, self).__init__()

        self.view = view

        thread = threading.Thread(target=self.listen)
        thread.daemon = True
        thread.start()

    def listen(self):
        &#34;&#34;&#34; Listen on the PULL socket for visited positions.

        If a visited position is received over the PULL socket, a red dot is placed at that position in the GUI.
        &#34;&#34;&#34;

        context = zmq.Context.instance()
        socket = context.socket(zmq.PULL)

        socket.bind(self.get_bind_address)

        while True:

            pickle_string = socket.recv()
            data = pickle.loads(pickle_string)

            if isinstance(data, dict):

                if &#34;theta&#34; in data and &#34;phi&#34; in data:
                    self.visit_field_angles(data)

            elif data == &#34;clear&#34;:
                self.clear()

    def visit_field_angles(self, data):
        &#34;&#34;&#34; Add a red dot at the given position on the focal-plane plot.

        Args:
            - data: Dictionary with the following entries:
                - theta: Gnomonic distance to the optical axis [degrees]
                - phi: In-field angle [degrees]
        &#34;&#34;&#34;

        theta = data[&#34;theta&#34;]
        phi = data[&#34;phi&#34;]

        self.view.visit_field_angles(theta, phi)

    def clear(self):
        &#34;&#34;&#34; Clear all visited positions from the focal-plane plot.&#34;&#34;&#34;

        self.view.clear_visited_positions()

    @property
    def get_bind_address(self):
        &#34;&#34;&#34; Returns bind address for the PULL socket.

        Returns: Bind address for the PULL socket.
        &#34;&#34;&#34;

        return bind_address(SETTINGS.PROTOCOL, SETTINGS.PORT,)


class VisitedPositionsUIView(QMainWindow):

    def __init__(self):
        &#34;&#34;&#34; Open a window and initialise the GUI.

        The focal plane is shown, together with a blue circle indicating the size of the field-of-view, and a red dots
        indicating the positions that were visited so far.  Below this plot, you can find a combobox to switch between
        coordinate systems (focal-plane coordinates, pixel coordinates, and field angles).
        &#34;&#34;&#34;

        super().__init__()

        self.setGeometry(300, 300, 1500, 1000)
        self.setWindowTitle(&#34;Visited-Positions GUI&#34;)

        self.init_ui()

        self.thread = None

        self.num_points = 0

    def init_ui(self):
        &#34;&#34;&#34; Initialisation of the GUI.

        The focal plane is shown, together with a blue circle indicating
        the size of the field-of-view, and a red dots indicating the positions that were visited so far.
        Below this plot, you can find a combobox to switch between coordinate systems (focal-plane coordinates,
        pixel coordinates, and field angles).
        &#34;&#34;&#34;

        app_frame = QFrame()
        app_frame.setObjectName(&#34;AppFrame&#34;)

        # Statusbar

        self.setStatusBar(QStatusBar(self))
        self.status = self.statusBar()

        # Toolbar

        self.create_toolbar()

        # Central widget

        vbox_right = QVBoxLayout()

        vbox_right.addWidget(self.create_focal_plane_widget())

        app_frame.setLayout(vbox_right)

        self.setCentralWidget(app_frame)

    #########
    # Toolbar
    #########

    def create_toolbar(self):
        &#34;&#34;&#34; Create toolbar.

        Currently doesn&#39;t do anything.
        &#34;&#34;&#34;
        self.clear_button = ToolTouchButton(
            name=&#34;clear_visited_positions&#34;,
            width=25, height=25,
            status_tip=&#34;Clear the visited positions&#34;,
            selected=get_resource(&#34;:/icons/sponge.svg&#34;),
        )
        self.clear_button.clicked.connect(self.clear_visited_positions)

        # image_location = os.environ[&#34;PLATO_COMMON_EGSE_PATH&#34;] + \
        #     &#34;/src/egse/images/&#34;

        # self.undo_pix = QPixmap(
        #     image_location + &#34;undo.png&#34;).scaledToHeight(30, 1)
        #
        # self.undo_icon = QLabel()
        # self.undo_icon.setPixmap(self.undo_pix)
        #
        # # TODO Assign action to this button
        #
        # # Putting everything in place
        #
        self.toolbar = self.addToolBar(&#39;MainToolbar&#39;)
        self.toolbar.addWidget(self.clear_button)

        return self.toolbar

    ####################
    # Focal-plane widget
    ####################

    def create_focal_plane_widget(self):
        &#34;&#34;&#34; Create widget showing the position of the source in the focal plane.
        &#34;&#34;&#34;

        self.focal_plane = FocalPlaneWidgetWithVisitedPositions()
        return self.focal_plane

    ###################
    # Visit position(s)
    ###################

    def visit_field_angles(self, theta, phi):
        &#34;&#34;&#34; Add a red dot at the given position on the focal-plane plot.

        Args:
            - theta: Angular distance from the optical axis [degrees].
            - phi: In-field angle [degrees].
        &#34;&#34;&#34;

        # Conversion from field angles to focal-plane coordinates

        x_fp, y_fp = angles_to_focal_plane_coordinates(theta, phi)

        self.visit_focal_plane_position(x_fp, y_fp)

    def visit_focal_plane_position(self, x_fp, y_fp):
        &#34;&#34;&#34; Add a red dot at the given position on the focal-plan plot.

        Args:
            - x_fp: Focal-plane x-coordinate [mm].
            - y_fp: Focal-plane y-coordinate [mm].
        &#34;&#34;&#34;

        self.focal_plane.visit_position(x_fp, y_fp)

        self.num_points += 1

    def visit_ccd_position(self, row, column, ccd_code):
        &#34;&#34;&#34; Add a red dot at the given position on the focal-plane plot.

        Args:
            - row: Row coordinate [pixels].
            - column: Column coordinate [pixels].
            - ccd_code: Code of the CCD [1, 2, 3, 4].
        &#34;&#34;&#34;

        # Conversion from CCD coordinates to focal-plane coordinates

        x_fp, y_fp = ccd_to_focal_plane_coordinates(row, column, ccd_code)
        
        self.visit_focal_plane_position(x_fp, y_fp)

    ##########
    # Clearing
    ##########

    def clear_visited_positions(self):
        &#34;&#34;&#34; Clear all visited positions.&#34;&#34;&#34;

        self.focal_plane.clear_visited_positions()

###########
# Start GUI
###########


def start_visited_positions_gui():
    &#34;&#34;&#34; Start the GUI showing the focal plane with the visited positions.
    You can add extra visited locations as follows (assuming &#34;view&#34; is the name of the GUI instance)

        * in focal-plane coordinates (x_fp, y_fp) [mm]:
            $ view.visit_focal_plane_position(x_fp, y_fp)

        * in pixel coordinates (row, column) [pixel] on a given CCD:
            $ view.visit_ccd_position(row, column, ccd_code)

        * in field angles (theta, phi) [degrees]:
            $ view.visit_field_angles(theta, phi)
    &#34;&#34;&#34;

    app = QApplication([])

    view = VisitedPositionsUIView()

    view.show()

    return view


def _send_data(data):
    &#34;&#34;&#34; Send the given data to the visited-positions UI.

    Args:
        - data: Data to send to the visited-positions UI.
    &#34;&#34;&#34;

    context = zmq.Context.instance()
    socket = context.socket(zmq.PUSH)

    protocol = SETTINGS.PROTOCOL
    hostname = SETTINGS.HOSTNAME
    port = SETTINGS.PORT

    socket.connect(connect_address(protocol, hostname, port))

    pickle_string = pickle.dumps(data)

    socket.send(pickle_string)
    socket.close()


def clear_visited_positions():
    &#34;&#34;&#34; Clear the visited positions from the visited-positions UI.&#34;&#34;&#34;

    data = &#34;clear&#34;
    _send_data(data)


def visit_field_angles(theta, phi):
    &#34;&#34;&#34; Show the given position in the visited-positions GUI.

    Args:
        - theta: Angular distance from the optical axis [degrees].
        - phi: Angle from the x-axis of the focal plane (i.e. in-field angle) [degrees].
    &#34;&#34;&#34;

    data = {&#34;theta&#34;: theta, &#34;phi&#34;: phi}
    _send_data(data)


def visit_focal_plane_position(x_fp, y_fp):
    &#34;&#34;&#34; Show the given position in the visited-positions GUI.

    Args:
        - x_fp: Focal-plane x-coordinate [mm].
        - y_fp: Focal-plan y-coordinate [mm].
    &#34;&#34;&#34;

    # Convert to field angles

    theta, phi = focal_plane_coordinates_to_angles(x_fp, y_fp)
    visit_field_angles(theta, phi)


def visit_ccd_position(row, column, ccd_code):
    &#34;&#34;&#34; Show the given position in the visited positions GUI.

    Args:
        - row: Row coordinate [pixels].
        - column: Column coordinate [pixels].
        - ccd_code: Code of the CCD for which the pixel coordinates are given.
    &#34;&#34;&#34;

    # Convert to focal-plane coordinates

    x_fp, y_fp = ccd_to_focal_plane_coordinates(row, column, ccd_code)
    visit_focal_plane_position(x_fp, y_fp)


def main():
    &#34;&#34;&#34; Main method to launch the Process Manager GUI.&#34;&#34;&#34;

    app = QApplication(sys.argv)

    # Check whether the Process Manager CS is running
    # (show a warning in a pop-up window if it&#39;s not)

    view = VisitedPositionsUIView()
    controller = VisitedPositionsUIController(view)

    view.show()

    return app.exec_()


if __name__ == &#39;__main__&#39;:
    sys.exit(main())</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="egse.visitedpositions.clear_visited_positions"><code class="name flex">
<span>def <span class="ident">clear_visited_positions</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"><p>Clear the visited positions from the visited-positions UI.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def clear_visited_positions():
    &#34;&#34;&#34; Clear the visited positions from the visited-positions UI.&#34;&#34;&#34;

    data = &#34;clear&#34;
    _send_data(data)</code></pre>
</details>
</dd>
<dt id="egse.visitedpositions.main"><code class="name flex">
<span>def <span class="ident">main</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"><p>Main method to launch the Process Manager GUI.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def main():
    &#34;&#34;&#34; Main method to launch the Process Manager GUI.&#34;&#34;&#34;

    app = QApplication(sys.argv)

    # Check whether the Process Manager CS is running
    # (show a warning in a pop-up window if it&#39;s not)

    view = VisitedPositionsUIView()
    controller = VisitedPositionsUIController(view)

    view.show()

    return app.exec_()</code></pre>
</details>
</dd>
<dt id="egse.visitedpositions.start_visited_positions_gui"><code class="name flex">
<span>def <span class="ident">start_visited_positions_gui</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"><p>Start the GUI showing the focal plane with the visited positions.
You can add extra visited locations as follows (assuming "view" is the name of the GUI instance)</p>
<pre><code>* in focal-plane coordinates (x_fp, y_fp) [mm]:
    $ view.visit_focal_plane_position(x_fp, y_fp)

* in pixel coordinates (row, column) [pixel] on a given CCD:
    $ view.visit_ccd_position(row, column, ccd_code)

* in field angles (theta, phi) [degrees]:
    $ view.visit_field_angles(theta, phi)
</code></pre></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def start_visited_positions_gui():
    &#34;&#34;&#34; Start the GUI showing the focal plane with the visited positions.
    You can add extra visited locations as follows (assuming &#34;view&#34; is the name of the GUI instance)

        * in focal-plane coordinates (x_fp, y_fp) [mm]:
            $ view.visit_focal_plane_position(x_fp, y_fp)

        * in pixel coordinates (row, column) [pixel] on a given CCD:
            $ view.visit_ccd_position(row, column, ccd_code)

        * in field angles (theta, phi) [degrees]:
            $ view.visit_field_angles(theta, phi)
    &#34;&#34;&#34;

    app = QApplication([])

    view = VisitedPositionsUIView()

    view.show()

    return view</code></pre>
</details>
</dd>
<dt id="egse.visitedpositions.visit_ccd_position"><code class="name flex">
<span>def <span class="ident">visit_ccd_position</span></span>(<span>row, column, ccd_code)</span>
</code></dt>
<dd>
<div class="desc"><p>Show the given position in the visited positions GUI.</p>
<h2 id="args">Args</h2>
<ul>
<li>row: Row coordinate [pixels].</li>
<li>column: Column coordinate [pixels].</li>
<li>ccd_code: Code of the CCD for which the pixel coordinates are given.</li>
</ul></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def visit_ccd_position(row, column, ccd_code):
    &#34;&#34;&#34; Show the given position in the visited positions GUI.

    Args:
        - row: Row coordinate [pixels].
        - column: Column coordinate [pixels].
        - ccd_code: Code of the CCD for which the pixel coordinates are given.
    &#34;&#34;&#34;

    # Convert to focal-plane coordinates

    x_fp, y_fp = ccd_to_focal_plane_coordinates(row, column, ccd_code)
    visit_focal_plane_position(x_fp, y_fp)</code></pre>
</details>
</dd>
<dt id="egse.visitedpositions.visit_field_angles"><code class="name flex">
<span>def <span class="ident">visit_field_angles</span></span>(<span>theta, phi)</span>
</code></dt>
<dd>
<div class="desc"><p>Show the given position in the visited-positions GUI.</p>
<h2 id="args">Args</h2>
<ul>
<li>theta: Angular distance from the optical axis [degrees].</li>
<li>phi: Angle from the x-axis of the focal plane (i.e. in-field angle) [degrees].</li>
</ul></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def visit_field_angles(theta, phi):
    &#34;&#34;&#34; Show the given position in the visited-positions GUI.

    Args:
        - theta: Angular distance from the optical axis [degrees].
        - phi: Angle from the x-axis of the focal plane (i.e. in-field angle) [degrees].
    &#34;&#34;&#34;

    data = {&#34;theta&#34;: theta, &#34;phi&#34;: phi}
    _send_data(data)</code></pre>
</details>
</dd>
<dt id="egse.visitedpositions.visit_focal_plane_position"><code class="name flex">
<span>def <span class="ident">visit_focal_plane_position</span></span>(<span>x_fp, y_fp)</span>
</code></dt>
<dd>
<div class="desc"><p>Show the given position in the visited-positions GUI.</p>
<h2 id="args">Args</h2>
<ul>
<li>x_fp: Focal-plane x-coordinate [mm].</li>
<li>y_fp: Focal-plan y-coordinate [mm].</li>
</ul></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def visit_focal_plane_position(x_fp, y_fp):
    &#34;&#34;&#34; Show the given position in the visited-positions GUI.

    Args:
        - x_fp: Focal-plane x-coordinate [mm].
        - y_fp: Focal-plan y-coordinate [mm].
    &#34;&#34;&#34;

    # Convert to field angles

    theta, phi = focal_plane_coordinates_to_angles(x_fp, y_fp)
    visit_field_angles(theta, phi)</code></pre>
</details>
</dd>
</dl>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="egse.visitedpositions.VisitedPositionsUIController"><code class="flex name class">
<span>class <span class="ident">VisitedPositionsUIController</span></span>
<span>(</span><span>view)</span>
</code></dt>
<dd>
<div class="desc"><p>Create a controller for the visited-positions GUI.</p>
<h2 id="args">Args</h2>
<ul>
<li>view: Visited-positions GUI.</li>
</ul></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class VisitedPositionsUIController:

    def __init__(self, view):
        &#34;&#34;&#34; Create a controller for the visited-positions GUI.

        Args:
            - view: Visited-positions GUI.
        &#34;&#34;&#34;

        super(VisitedPositionsUIController, self).__init__()

        self.view = view

        thread = threading.Thread(target=self.listen)
        thread.daemon = True
        thread.start()

    def listen(self):
        &#34;&#34;&#34; Listen on the PULL socket for visited positions.

        If a visited position is received over the PULL socket, a red dot is placed at that position in the GUI.
        &#34;&#34;&#34;

        context = zmq.Context.instance()
        socket = context.socket(zmq.PULL)

        socket.bind(self.get_bind_address)

        while True:

            pickle_string = socket.recv()
            data = pickle.loads(pickle_string)

            if isinstance(data, dict):

                if &#34;theta&#34; in data and &#34;phi&#34; in data:
                    self.visit_field_angles(data)

            elif data == &#34;clear&#34;:
                self.clear()

    def visit_field_angles(self, data):
        &#34;&#34;&#34; Add a red dot at the given position on the focal-plane plot.

        Args:
            - data: Dictionary with the following entries:
                - theta: Gnomonic distance to the optical axis [degrees]
                - phi: In-field angle [degrees]
        &#34;&#34;&#34;

        theta = data[&#34;theta&#34;]
        phi = data[&#34;phi&#34;]

        self.view.visit_field_angles(theta, phi)

    def clear(self):
        &#34;&#34;&#34; Clear all visited positions from the focal-plane plot.&#34;&#34;&#34;

        self.view.clear_visited_positions()

    @property
    def get_bind_address(self):
        &#34;&#34;&#34; Returns bind address for the PULL socket.

        Returns: Bind address for the PULL socket.
        &#34;&#34;&#34;

        return bind_address(SETTINGS.PROTOCOL, SETTINGS.PORT,)</code></pre>
</details>
<h3>Instance variables</h3>
<dl>
<dt id="egse.visitedpositions.VisitedPositionsUIController.get_bind_address"><code class="name">var <span class="ident">get_bind_address</span></code></dt>
<dd>
<div class="desc"><p>Returns bind address for the PULL socket.</p>
<p>Returns: Bind address for the PULL socket.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def get_bind_address(self):
    &#34;&#34;&#34; Returns bind address for the PULL socket.

    Returns: Bind address for the PULL socket.
    &#34;&#34;&#34;

    return bind_address(SETTINGS.PROTOCOL, SETTINGS.PORT,)</code></pre>
</details>
</dd>
</dl>
<h3>Methods</h3>
<dl>
<dt id="egse.visitedpositions.VisitedPositionsUIController.clear"><code class="name flex">
<span>def <span class="ident">clear</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Clear all visited positions from the focal-plane plot.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def clear(self):
    &#34;&#34;&#34; Clear all visited positions from the focal-plane plot.&#34;&#34;&#34;

    self.view.clear_visited_positions()</code></pre>
</details>
</dd>
<dt id="egse.visitedpositions.VisitedPositionsUIController.listen"><code class="name flex">
<span>def <span class="ident">listen</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Listen on the PULL socket for visited positions.</p>
<p>If a visited position is received over the PULL socket, a red dot is placed at that position in the GUI.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def listen(self):
    &#34;&#34;&#34; Listen on the PULL socket for visited positions.

    If a visited position is received over the PULL socket, a red dot is placed at that position in the GUI.
    &#34;&#34;&#34;

    context = zmq.Context.instance()
    socket = context.socket(zmq.PULL)

    socket.bind(self.get_bind_address)

    while True:

        pickle_string = socket.recv()
        data = pickle.loads(pickle_string)

        if isinstance(data, dict):

            if &#34;theta&#34; in data and &#34;phi&#34; in data:
                self.visit_field_angles(data)

        elif data == &#34;clear&#34;:
            self.clear()</code></pre>
</details>
</dd>
<dt id="egse.visitedpositions.VisitedPositionsUIController.visit_field_angles"><code class="name flex">
<span>def <span class="ident">visit_field_angles</span></span>(<span>self, data)</span>
</code></dt>
<dd>
<div class="desc"><p>Add a red dot at the given position on the focal-plane plot.</p>
<h2 id="args">Args</h2>
<ul>
<li>data: Dictionary with the following entries:<ul>
<li>theta: Gnomonic distance to the optical axis [degrees]</li>
<li>phi: In-field angle [degrees]</li>
</ul>
</li>
</ul></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def visit_field_angles(self, data):
    &#34;&#34;&#34; Add a red dot at the given position on the focal-plane plot.

    Args:
        - data: Dictionary with the following entries:
            - theta: Gnomonic distance to the optical axis [degrees]
            - phi: In-field angle [degrees]
    &#34;&#34;&#34;

    theta = data[&#34;theta&#34;]
    phi = data[&#34;phi&#34;]

    self.view.visit_field_angles(theta, phi)</code></pre>
</details>
</dd>
</dl>
</dd>
<dt id="egse.visitedpositions.VisitedPositionsUIView"><code class="flex name class">
<span>class <span class="ident">VisitedPositionsUIView</span></span>
</code></dt>
<dd>
<div class="desc"><p>QMainWindow(parent: QWidget = None, flags: Union[Qt.WindowFlags, Qt.WindowType] = Qt.WindowFlags())</p>
<p>Open a window and initialise the GUI.</p>
<p>The focal plane is shown, together with a blue circle indicating the size of the field-of-view, and a red dots
indicating the positions that were visited so far.
Below this plot, you can find a combobox to switch between
coordinate systems (focal-plane coordinates, pixel coordinates, and field angles).</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class VisitedPositionsUIView(QMainWindow):

    def __init__(self):
        &#34;&#34;&#34; Open a window and initialise the GUI.

        The focal plane is shown, together with a blue circle indicating the size of the field-of-view, and a red dots
        indicating the positions that were visited so far.  Below this plot, you can find a combobox to switch between
        coordinate systems (focal-plane coordinates, pixel coordinates, and field angles).
        &#34;&#34;&#34;

        super().__init__()

        self.setGeometry(300, 300, 1500, 1000)
        self.setWindowTitle(&#34;Visited-Positions GUI&#34;)

        self.init_ui()

        self.thread = None

        self.num_points = 0

    def init_ui(self):
        &#34;&#34;&#34; Initialisation of the GUI.

        The focal plane is shown, together with a blue circle indicating
        the size of the field-of-view, and a red dots indicating the positions that were visited so far.
        Below this plot, you can find a combobox to switch between coordinate systems (focal-plane coordinates,
        pixel coordinates, and field angles).
        &#34;&#34;&#34;

        app_frame = QFrame()
        app_frame.setObjectName(&#34;AppFrame&#34;)

        # Statusbar

        self.setStatusBar(QStatusBar(self))
        self.status = self.statusBar()

        # Toolbar

        self.create_toolbar()

        # Central widget

        vbox_right = QVBoxLayout()

        vbox_right.addWidget(self.create_focal_plane_widget())

        app_frame.setLayout(vbox_right)

        self.setCentralWidget(app_frame)

    #########
    # Toolbar
    #########

    def create_toolbar(self):
        &#34;&#34;&#34; Create toolbar.

        Currently doesn&#39;t do anything.
        &#34;&#34;&#34;
        self.clear_button = ToolTouchButton(
            name=&#34;clear_visited_positions&#34;,
            width=25, height=25,
            status_tip=&#34;Clear the visited positions&#34;,
            selected=get_resource(&#34;:/icons/sponge.svg&#34;),
        )
        self.clear_button.clicked.connect(self.clear_visited_positions)

        # image_location = os.environ[&#34;PLATO_COMMON_EGSE_PATH&#34;] + \
        #     &#34;/src/egse/images/&#34;

        # self.undo_pix = QPixmap(
        #     image_location + &#34;undo.png&#34;).scaledToHeight(30, 1)
        #
        # self.undo_icon = QLabel()
        # self.undo_icon.setPixmap(self.undo_pix)
        #
        # # TODO Assign action to this button
        #
        # # Putting everything in place
        #
        self.toolbar = self.addToolBar(&#39;MainToolbar&#39;)
        self.toolbar.addWidget(self.clear_button)

        return self.toolbar

    ####################
    # Focal-plane widget
    ####################

    def create_focal_plane_widget(self):
        &#34;&#34;&#34; Create widget showing the position of the source in the focal plane.
        &#34;&#34;&#34;

        self.focal_plane = FocalPlaneWidgetWithVisitedPositions()
        return self.focal_plane

    ###################
    # Visit position(s)
    ###################

    def visit_field_angles(self, theta, phi):
        &#34;&#34;&#34; Add a red dot at the given position on the focal-plane plot.

        Args:
            - theta: Angular distance from the optical axis [degrees].
            - phi: In-field angle [degrees].
        &#34;&#34;&#34;

        # Conversion from field angles to focal-plane coordinates

        x_fp, y_fp = angles_to_focal_plane_coordinates(theta, phi)

        self.visit_focal_plane_position(x_fp, y_fp)

    def visit_focal_plane_position(self, x_fp, y_fp):
        &#34;&#34;&#34; Add a red dot at the given position on the focal-plan plot.

        Args:
            - x_fp: Focal-plane x-coordinate [mm].
            - y_fp: Focal-plane y-coordinate [mm].
        &#34;&#34;&#34;

        self.focal_plane.visit_position(x_fp, y_fp)

        self.num_points += 1

    def visit_ccd_position(self, row, column, ccd_code):
        &#34;&#34;&#34; Add a red dot at the given position on the focal-plane plot.

        Args:
            - row: Row coordinate [pixels].
            - column: Column coordinate [pixels].
            - ccd_code: Code of the CCD [1, 2, 3, 4].
        &#34;&#34;&#34;

        # Conversion from CCD coordinates to focal-plane coordinates

        x_fp, y_fp = ccd_to_focal_plane_coordinates(row, column, ccd_code)
        
        self.visit_focal_plane_position(x_fp, y_fp)

    ##########
    # Clearing
    ##########

    def clear_visited_positions(self):
        &#34;&#34;&#34; Clear all visited positions.&#34;&#34;&#34;

        self.focal_plane.clear_visited_positions()</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>PyQt5.QtWidgets.QMainWindow</li>
<li>PyQt5.QtWidgets.QWidget</li>
<li>PyQt5.QtCore.QObject</li>
<li>sip.wrapper</li>
<li>PyQt5.QtGui.QPaintDevice</li>
<li>sip.simplewrapper</li>
</ul>
<h3>Methods</h3>
<dl>
<dt id="egse.visitedpositions.VisitedPositionsUIView.clear_visited_positions"><code class="name flex">
<span>def <span class="ident">clear_visited_positions</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Clear all visited positions.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def clear_visited_positions(self):
    &#34;&#34;&#34; Clear all visited positions.&#34;&#34;&#34;

    self.focal_plane.clear_visited_positions()</code></pre>
</details>
</dd>
<dt id="egse.visitedpositions.VisitedPositionsUIView.create_focal_plane_widget"><code class="name flex">
<span>def <span class="ident">create_focal_plane_widget</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Create widget showing the position of the source in the focal plane.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def create_focal_plane_widget(self):
    &#34;&#34;&#34; Create widget showing the position of the source in the focal plane.
    &#34;&#34;&#34;

    self.focal_plane = FocalPlaneWidgetWithVisitedPositions()
    return self.focal_plane</code></pre>
</details>
</dd>
<dt id="egse.visitedpositions.VisitedPositionsUIView.create_toolbar"><code class="name flex">
<span>def <span class="ident">create_toolbar</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Create toolbar.</p>
<p>Currently doesn't do anything.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def create_toolbar(self):
    &#34;&#34;&#34; Create toolbar.

    Currently doesn&#39;t do anything.
    &#34;&#34;&#34;
    self.clear_button = ToolTouchButton(
        name=&#34;clear_visited_positions&#34;,
        width=25, height=25,
        status_tip=&#34;Clear the visited positions&#34;,
        selected=get_resource(&#34;:/icons/sponge.svg&#34;),
    )
    self.clear_button.clicked.connect(self.clear_visited_positions)

    # image_location = os.environ[&#34;PLATO_COMMON_EGSE_PATH&#34;] + \
    #     &#34;/src/egse/images/&#34;

    # self.undo_pix = QPixmap(
    #     image_location + &#34;undo.png&#34;).scaledToHeight(30, 1)
    #
    # self.undo_icon = QLabel()
    # self.undo_icon.setPixmap(self.undo_pix)
    #
    # # TODO Assign action to this button
    #
    # # Putting everything in place
    #
    self.toolbar = self.addToolBar(&#39;MainToolbar&#39;)
    self.toolbar.addWidget(self.clear_button)

    return self.toolbar</code></pre>
</details>
</dd>
<dt id="egse.visitedpositions.VisitedPositionsUIView.init_ui"><code class="name flex">
<span>def <span class="ident">init_ui</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Initialisation of the GUI.</p>
<p>The focal plane is shown, together with a blue circle indicating
the size of the field-of-view, and a red dots indicating the positions that were visited so far.
Below this plot, you can find a combobox to switch between coordinate systems (focal-plane coordinates,
pixel coordinates, and field angles).</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def init_ui(self):
    &#34;&#34;&#34; Initialisation of the GUI.

    The focal plane is shown, together with a blue circle indicating
    the size of the field-of-view, and a red dots indicating the positions that were visited so far.
    Below this plot, you can find a combobox to switch between coordinate systems (focal-plane coordinates,
    pixel coordinates, and field angles).
    &#34;&#34;&#34;

    app_frame = QFrame()
    app_frame.setObjectName(&#34;AppFrame&#34;)

    # Statusbar

    self.setStatusBar(QStatusBar(self))
    self.status = self.statusBar()

    # Toolbar

    self.create_toolbar()

    # Central widget

    vbox_right = QVBoxLayout()

    vbox_right.addWidget(self.create_focal_plane_widget())

    app_frame.setLayout(vbox_right)

    self.setCentralWidget(app_frame)</code></pre>
</details>
</dd>
<dt id="egse.visitedpositions.VisitedPositionsUIView.visit_ccd_position"><code class="name flex">
<span>def <span class="ident">visit_ccd_position</span></span>(<span>self, row, column, ccd_code)</span>
</code></dt>
<dd>
<div class="desc"><p>Add a red dot at the given position on the focal-plane plot.</p>
<h2 id="args">Args</h2>
<ul>
<li>row: Row coordinate [pixels].</li>
<li>column: Column coordinate [pixels].</li>
<li>ccd_code: Code of the CCD [1, 2, 3, 4].</li>
</ul></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def visit_ccd_position(self, row, column, ccd_code):
    &#34;&#34;&#34; Add a red dot at the given position on the focal-plane plot.

    Args:
        - row: Row coordinate [pixels].
        - column: Column coordinate [pixels].
        - ccd_code: Code of the CCD [1, 2, 3, 4].
    &#34;&#34;&#34;

    # Conversion from CCD coordinates to focal-plane coordinates

    x_fp, y_fp = ccd_to_focal_plane_coordinates(row, column, ccd_code)
    
    self.visit_focal_plane_position(x_fp, y_fp)</code></pre>
</details>
</dd>
<dt id="egse.visitedpositions.VisitedPositionsUIView.visit_field_angles"><code class="name flex">
<span>def <span class="ident">visit_field_angles</span></span>(<span>self, theta, phi)</span>
</code></dt>
<dd>
<div class="desc"><p>Add a red dot at the given position on the focal-plane plot.</p>
<h2 id="args">Args</h2>
<ul>
<li>theta: Angular distance from the optical axis [degrees].</li>
<li>phi: In-field angle [degrees].</li>
</ul></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def visit_field_angles(self, theta, phi):
    &#34;&#34;&#34; Add a red dot at the given position on the focal-plane plot.

    Args:
        - theta: Angular distance from the optical axis [degrees].
        - phi: In-field angle [degrees].
    &#34;&#34;&#34;

    # Conversion from field angles to focal-plane coordinates

    x_fp, y_fp = angles_to_focal_plane_coordinates(theta, phi)

    self.visit_focal_plane_position(x_fp, y_fp)</code></pre>
</details>
</dd>
<dt id="egse.visitedpositions.VisitedPositionsUIView.visit_focal_plane_position"><code class="name flex">
<span>def <span class="ident">visit_focal_plane_position</span></span>(<span>self, x_fp, y_fp)</span>
</code></dt>
<dd>
<div class="desc"><p>Add a red dot at the given position on the focal-plan plot.</p>
<h2 id="args">Args</h2>
<ul>
<li>x_fp: Focal-plane x-coordinate [mm].</li>
<li>y_fp: Focal-plane y-coordinate [mm].</li>
</ul></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def visit_focal_plane_position(self, x_fp, y_fp):
    &#34;&#34;&#34; Add a red dot at the given position on the focal-plan plot.

    Args:
        - x_fp: Focal-plane x-coordinate [mm].
        - y_fp: Focal-plane y-coordinate [mm].
    &#34;&#34;&#34;

    self.focal_plane.visit_position(x_fp, y_fp)

    self.num_points += 1</code></pre>
</details>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="egse" href="index.html">egse</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="egse.visitedpositions.clear_visited_positions" href="#egse.visitedpositions.clear_visited_positions">clear_visited_positions</a></code></li>
<li><code><a title="egse.visitedpositions.main" href="#egse.visitedpositions.main">main</a></code></li>
<li><code><a title="egse.visitedpositions.start_visited_positions_gui" href="#egse.visitedpositions.start_visited_positions_gui">start_visited_positions_gui</a></code></li>
<li><code><a title="egse.visitedpositions.visit_ccd_position" href="#egse.visitedpositions.visit_ccd_position">visit_ccd_position</a></code></li>
<li><code><a title="egse.visitedpositions.visit_field_angles" href="#egse.visitedpositions.visit_field_angles">visit_field_angles</a></code></li>
<li><code><a title="egse.visitedpositions.visit_focal_plane_position" href="#egse.visitedpositions.visit_focal_plane_position">visit_focal_plane_position</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="egse.visitedpositions.VisitedPositionsUIController" href="#egse.visitedpositions.VisitedPositionsUIController">VisitedPositionsUIController</a></code></h4>
<ul class="">
<li><code><a title="egse.visitedpositions.VisitedPositionsUIController.clear" href="#egse.visitedpositions.VisitedPositionsUIController.clear">clear</a></code></li>
<li><code><a title="egse.visitedpositions.VisitedPositionsUIController.get_bind_address" href="#egse.visitedpositions.VisitedPositionsUIController.get_bind_address">get_bind_address</a></code></li>
<li><code><a title="egse.visitedpositions.VisitedPositionsUIController.listen" href="#egse.visitedpositions.VisitedPositionsUIController.listen">listen</a></code></li>
<li><code><a title="egse.visitedpositions.VisitedPositionsUIController.visit_field_angles" href="#egse.visitedpositions.VisitedPositionsUIController.visit_field_angles">visit_field_angles</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="egse.visitedpositions.VisitedPositionsUIView" href="#egse.visitedpositions.VisitedPositionsUIView">VisitedPositionsUIView</a></code></h4>
<ul class="">
<li><code><a title="egse.visitedpositions.VisitedPositionsUIView.clear_visited_positions" href="#egse.visitedpositions.VisitedPositionsUIView.clear_visited_positions">clear_visited_positions</a></code></li>
<li><code><a title="egse.visitedpositions.VisitedPositionsUIView.create_focal_plane_widget" href="#egse.visitedpositions.VisitedPositionsUIView.create_focal_plane_widget">create_focal_plane_widget</a></code></li>
<li><code><a title="egse.visitedpositions.VisitedPositionsUIView.create_toolbar" href="#egse.visitedpositions.VisitedPositionsUIView.create_toolbar">create_toolbar</a></code></li>
<li><code><a title="egse.visitedpositions.VisitedPositionsUIView.init_ui" href="#egse.visitedpositions.VisitedPositionsUIView.init_ui">init_ui</a></code></li>
<li><code><a title="egse.visitedpositions.VisitedPositionsUIView.visit_ccd_position" href="#egse.visitedpositions.VisitedPositionsUIView.visit_ccd_position">visit_ccd_position</a></code></li>
<li><code><a title="egse.visitedpositions.VisitedPositionsUIView.visit_field_angles" href="#egse.visitedpositions.VisitedPositionsUIView.visit_field_angles">visit_field_angles</a></code></li>
<li><code><a title="egse.visitedpositions.VisitedPositionsUIView.visit_focal_plane_position" href="#egse.visitedpositions.VisitedPositionsUIView.visit_focal_plane_position">visit_focal_plane_position</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>