<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>egse.hexapod.symetrie.zonda_cs API documentation</title>
<meta name="description" content="The Control Server that connects to the Hexapod ZONDA Hardware Controller …" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>egse.hexapod.symetrie.zonda_cs</code></h1>
</header>
<section id="section-intro">
<p>The Control Server that connects to the Hexapod ZONDA Hardware Controller.</p>
<p>Start the control server from the terminal as follows:</p>
<pre><code>$ zonda_cs start-bg
</code></pre>
<p>or when you don't have the device available, start the control server in simulator mode. That
will make the control server connect to a device software simulator:</p>
<pre><code>$ zonda_cs start --sim
</code></pre>
<p>Please note that software simulators are intended for simple test purposes and will not simulate
all device behavior correctly, e.g. timing, error conditions, etc.</p>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">&#34;&#34;&#34;
The Control Server that connects to the Hexapod ZONDA Hardware Controller.

Start the control server from the terminal as follows:

    $ zonda_cs start-bg

or when you don&#39;t have the device available, start the control server in simulator mode. That
will make the control server connect to a device software simulator:

    $ zonda_cs start --sim

Please note that software simulators are intended for simple test purposes and will not simulate
all device behavior correctly, e.g. timing, error conditions, etc.

&#34;&#34;&#34;
import logging

if __name__ != &#34;__main__&#34;:
    import multiprocessing
    multiprocessing.current_process().name = &#34;zonda_cs&#34;

import sys

import click
import invoke
import rich
import zmq

from egse.control import ControlServer
from egse.control import is_control_server_active
from egse.hexapod.symetrie.zonda import ZondaProxy
from egse.hexapod.symetrie.zonda_protocol import ZondaProtocol
from egse.settings import Settings
from egse.zmq_ser import connect_address
from prometheus_client import start_http_server

logger = logging.getLogger(__name__)

CTRL_SETTINGS = Settings.load(&#34;Hexapod ZONDA Control Server&#34;)


class ZondaControlServer(ControlServer):
    &#34;&#34;&#34;ZondaControlServer - Command and monitor the Hexapod ZONDA hardware.

    This class works as a command and monitoring server to control the Symétrie Hexapod PUNA.
    This control server shall be used as the single point access for controlling the hardware
    device. Monitoring access should be done preferably through this control server also,
    but can be done with a direct connection through the PunaController if needed.

    The sever binds to the following ZeroMQ sockets:

    * a REQ-REP socket that can be used as a command server. Any client can connect and
      send a command to the Hexapod.

    * a PUB-SUP socket that serves as a monitoring server. It will send out Hexapod status
      information to all the connected clients every five seconds.

    &#34;&#34;&#34;

    def __init__(self):
        super().__init__()

        self.device_protocol = ZondaProtocol(self)

        self.logger.debug(f&#34;Binding ZeroMQ socket to {self.device_protocol.get_bind_address()}&#34;)

        self.device_protocol.bind(self.dev_ctrl_cmd_sock)

        self.poller.register(self.dev_ctrl_cmd_sock, zmq.POLLIN)

    def get_communication_protocol(self):
        return CTRL_SETTINGS.PROTOCOL

    def get_commanding_port(self):
        return CTRL_SETTINGS.COMMANDING_PORT

    def get_service_port(self):
        return CTRL_SETTINGS.SERVICE_PORT

    def get_monitoring_port(self):
        return CTRL_SETTINGS.MONITORING_PORT

    def get_storage_mnemonic(self):
        try:
            return CTRL_SETTINGS.STORAGE_MNEMONIC
        except AttributeError:
            return &#34;ZONDA&#34;

    def before_serve(self):
        start_http_server(CTRL_SETTINGS.METRICS_PORT)

@click.group()
def cli():
    pass


@cli.command()
@click.option(&#34;--simulator&#34;, &#34;--sim&#34;, is_flag=True, help=&#34;Start the Hexapod Zonda Simulator as the backend.&#34;)
def start(simulator):
    &#34;&#34;&#34;Start the Hexapod Zonda Control Server.&#34;&#34;&#34;

    if simulator:

        Settings.set_simulation_mode(True)

    try:

        controller = ZondaControlServer()
        controller.serve()

    except KeyboardInterrupt:

        print(&#34;Shutdown requested...exiting&#34;)

    except SystemExit as exit_code:

        print(&#34;System Exit with code {}.&#34;.format(exit_code))
        sys.exit(exit_code)

    except Exception:

        logger.exception(&#34;Cannot start the Hexapod Zonda Control Server&#34;)

        # The above line does exactly the same as the traceback, but on the logger
        # import traceback
        # traceback.print_exc(file=sys.stdout)

    return 0


@cli.command()
def start_bg():
    &#34;&#34;&#34;Start the ZONDA Control Server in the background.&#34;&#34;&#34;
    invoke.run(&#34;zonda_cs start&#34;, disown=True)


@cli.command()
def stop():
    &#34;&#34;&#34;Send a &#39;quit_server&#39; command to the Hexapod Zonda Control Server.&#34;&#34;&#34;

    try:
        with ZondaProxy() as proxy:
            sp = proxy.get_service_proxy()
            sp.quit_server()
    except ConnectionError:
        rich.print(&#34;[red]Couldn&#39;t connect to &#39;zonda_cs&#39;, process probably not running. &#34;)


@cli.command()
def status():
    &#34;&#34;&#34;Request status information from the Control Server.&#34;&#34;&#34;

    protocol = CTRL_SETTINGS.PROTOCOL
    hostname = CTRL_SETTINGS.HOSTNAME
    port = CTRL_SETTINGS.COMMANDING_PORT

    endpoint = connect_address(protocol, hostname, port)

    if is_control_server_active(endpoint):
        status = &#34;[green]active&#34;
    else:
        status = &#34;[red]not active&#34;

    rich.print(f&#34;ZONDA Hexapod: {status}&#34;)


if __name__ == &#34;__main__&#34;:

    logging.basicConfig(level=logging.DEBUG, format=Settings.LOG_FORMAT_FULL)

    sys.exit(cli())</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="egse.hexapod.symetrie.zonda_cs.ZondaControlServer"><code class="flex name class">
<span>class <span class="ident">ZondaControlServer</span></span>
</code></dt>
<dd>
<div class="desc"><p>ZondaControlServer - Command and monitor the Hexapod ZONDA hardware.</p>
<p>This class works as a command and monitoring server to control the Symétrie Hexapod PUNA.
This control server shall be used as the single point access for controlling the hardware
device. Monitoring access should be done preferably through this control server also,
but can be done with a direct connection through the PunaController if needed.</p>
<p>The sever binds to the following ZeroMQ sockets:</p>
<ul>
<li>
<p>a REQ-REP socket that can be used as a command server. Any client can connect and
send a command to the Hexapod.</p>
</li>
<li>
<p>a PUB-SUP socket that serves as a monitoring server. It will send out Hexapod status
information to all the connected clients every five seconds.</p>
</li>
</ul></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class ZondaControlServer(ControlServer):
    &#34;&#34;&#34;ZondaControlServer - Command and monitor the Hexapod ZONDA hardware.

    This class works as a command and monitoring server to control the Symétrie Hexapod PUNA.
    This control server shall be used as the single point access for controlling the hardware
    device. Monitoring access should be done preferably through this control server also,
    but can be done with a direct connection through the PunaController if needed.

    The sever binds to the following ZeroMQ sockets:

    * a REQ-REP socket that can be used as a command server. Any client can connect and
      send a command to the Hexapod.

    * a PUB-SUP socket that serves as a monitoring server. It will send out Hexapod status
      information to all the connected clients every five seconds.

    &#34;&#34;&#34;

    def __init__(self):
        super().__init__()

        self.device_protocol = ZondaProtocol(self)

        self.logger.debug(f&#34;Binding ZeroMQ socket to {self.device_protocol.get_bind_address()}&#34;)

        self.device_protocol.bind(self.dev_ctrl_cmd_sock)

        self.poller.register(self.dev_ctrl_cmd_sock, zmq.POLLIN)

    def get_communication_protocol(self):
        return CTRL_SETTINGS.PROTOCOL

    def get_commanding_port(self):
        return CTRL_SETTINGS.COMMANDING_PORT

    def get_service_port(self):
        return CTRL_SETTINGS.SERVICE_PORT

    def get_monitoring_port(self):
        return CTRL_SETTINGS.MONITORING_PORT

    def get_storage_mnemonic(self):
        try:
            return CTRL_SETTINGS.STORAGE_MNEMONIC
        except AttributeError:
            return &#34;ZONDA&#34;

    def before_serve(self):
        start_http_server(CTRL_SETTINGS.METRICS_PORT)</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li><a title="egse.control.ControlServer" href="../../control.html#egse.control.ControlServer">ControlServer</a></li>
</ul>
<h3>Methods</h3>
<dl>
<dt id="egse.hexapod.symetrie.zonda_cs.ZondaControlServer.before_serve"><code class="name flex">
<span>def <span class="ident">before_serve</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def before_serve(self):
    start_http_server(CTRL_SETTINGS.METRICS_PORT)</code></pre>
</details>
</dd>
<dt id="egse.hexapod.symetrie.zonda_cs.ZondaControlServer.get_commanding_port"><code class="name flex">
<span>def <span class="ident">get_commanding_port</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_commanding_port(self):
    return CTRL_SETTINGS.COMMANDING_PORT</code></pre>
</details>
</dd>
<dt id="egse.hexapod.symetrie.zonda_cs.ZondaControlServer.get_communication_protocol"><code class="name flex">
<span>def <span class="ident">get_communication_protocol</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_communication_protocol(self):
    return CTRL_SETTINGS.PROTOCOL</code></pre>
</details>
</dd>
<dt id="egse.hexapod.symetrie.zonda_cs.ZondaControlServer.get_monitoring_port"><code class="name flex">
<span>def <span class="ident">get_monitoring_port</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_monitoring_port(self):
    return CTRL_SETTINGS.MONITORING_PORT</code></pre>
</details>
</dd>
<dt id="egse.hexapod.symetrie.zonda_cs.ZondaControlServer.get_service_port"><code class="name flex">
<span>def <span class="ident">get_service_port</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_service_port(self):
    return CTRL_SETTINGS.SERVICE_PORT</code></pre>
</details>
</dd>
<dt id="egse.hexapod.symetrie.zonda_cs.ZondaControlServer.get_storage_mnemonic"><code class="name flex">
<span>def <span class="ident">get_storage_mnemonic</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_storage_mnemonic(self):
    try:
        return CTRL_SETTINGS.STORAGE_MNEMONIC
    except AttributeError:
        return &#34;ZONDA&#34;</code></pre>
</details>
</dd>
</dl>
<h3>Inherited members</h3>
<ul class="hlist">
<li><code><b><a title="egse.control.ControlServer" href="../../control.html#egse.control.ControlServer">ControlServer</a></b></code>:
<ul class="hlist">
<li><code><a title="egse.control.ControlServer.register_to_storage_manager" href="../../control.html#egse.control.ControlServer.register_to_storage_manager">register_to_storage_manager</a></code></li>
<li><code><a title="egse.control.ControlServer.set_delay" href="../../control.html#egse.control.ControlServer.set_delay">set_delay</a></code></li>
<li><code><a title="egse.control.ControlServer.set_hk_delay" href="../../control.html#egse.control.ControlServer.set_hk_delay">set_hk_delay</a></code></li>
<li><code><a title="egse.control.ControlServer.store_housekeeping_information" href="../../control.html#egse.control.ControlServer.store_housekeeping_information">store_housekeeping_information</a></code></li>
<li><code><a title="egse.control.ControlServer.unregister_from_storage_manager" href="../../control.html#egse.control.ControlServer.unregister_from_storage_manager">unregister_from_storage_manager</a></code></li>
</ul>
</li>
</ul>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="egse.hexapod.symetrie" href="index.html">egse.hexapod.symetrie</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="egse.hexapod.symetrie.zonda_cs.ZondaControlServer" href="#egse.hexapod.symetrie.zonda_cs.ZondaControlServer">ZondaControlServer</a></code></h4>
<ul class="">
<li><code><a title="egse.hexapod.symetrie.zonda_cs.ZondaControlServer.before_serve" href="#egse.hexapod.symetrie.zonda_cs.ZondaControlServer.before_serve">before_serve</a></code></li>
<li><code><a title="egse.hexapod.symetrie.zonda_cs.ZondaControlServer.get_commanding_port" href="#egse.hexapod.symetrie.zonda_cs.ZondaControlServer.get_commanding_port">get_commanding_port</a></code></li>
<li><code><a title="egse.hexapod.symetrie.zonda_cs.ZondaControlServer.get_communication_protocol" href="#egse.hexapod.symetrie.zonda_cs.ZondaControlServer.get_communication_protocol">get_communication_protocol</a></code></li>
<li><code><a title="egse.hexapod.symetrie.zonda_cs.ZondaControlServer.get_monitoring_port" href="#egse.hexapod.symetrie.zonda_cs.ZondaControlServer.get_monitoring_port">get_monitoring_port</a></code></li>
<li><code><a title="egse.hexapod.symetrie.zonda_cs.ZondaControlServer.get_service_port" href="#egse.hexapod.symetrie.zonda_cs.ZondaControlServer.get_service_port">get_service_port</a></code></li>
<li><code><a title="egse.hexapod.symetrie.zonda_cs.ZondaControlServer.get_storage_mnemonic" href="#egse.hexapod.symetrie.zonda_cs.ZondaControlServer.get_storage_mnemonic">get_storage_mnemonic</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>