<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>egse.tempcontrol.beaglebone.beaglebone_devif API documentation</title>
<meta name="description" content="" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>egse.tempcontrol.beaglebone.beaglebone_devif</code></h1>
</header>
<section id="section-intro">
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">import logging
import struct
import time
import socket
import errno
import os

from egse.command import ClientServerCommand
from egse.confman import ConfigurationManagerProxy
from egse.exceptions import DeviceNotFoundError
from egse.settings import Settings
from egse.confman import ConfigurationManagerProxy


logger = logging.getLogger(__name__)
ctrl_settings = Settings.load(&#39;BeagleBone Heater Control Server&#39;)

LED_PINS = [69, 68, 66, 67]
PWM_PINS = [4, 5, 7, 8]

class BeagleboneCommand(ClientServerCommand):
    def get_cmd_string(self, *args, **kwargs):
        out = super().get_cmd_string(*args, **kwargs)
        return out + &#39;\n&#39;


class BeagleboneDeviceInterface:
    def __init__(self):

        # Perform SRON gssw imports here to avoid issues at other THs
        from gssw.config.configclient import ConfigClient
        from gssw.common import addLoggingLevel
        from gssw.hal.hal import Hal
        from gssw.hal.halclient import HalClient
        from gssw.lib.device import Device

        self._is_connected = False

        # InitGssw does something to zmq that breaks cgse logging.
        # So instead I copied the essentials here.
        configClient = ConfigClient(os.getenv(&#39;GSSW_CONFIGURATION_FILE&#39;))
        config = configClient.config
        addLoggingLevel(&#39;data&#39;, 15)

        with ConfigurationManagerProxy() as cm:
            setup = cm.get_setup()

        self._availability = setup.gse.beaglebone_heater.availability

        hal = Hal()
        hal_client = HalClient(hal, config)
        hal_client.requestHal()

        self.dev_pwm_names = [f&#39;pwm_{dev_idx+1}&#39; for dev_idx, available in enumerate(self._availability) if available]
        self.dev_i2c_names = [f&#39;i2c_{dev_idx+1}&#39; for dev_idx, available in enumerate(self._availability)  if available]
        self.dev_gpio_names = [f&#39;gpio_{dev_idx+1}&#39; for dev_idx, available in enumerate(self._availability) if available]

        self._dev_pwm = [None, None, None, None, None, None]
        for dev_idx, dev_name in enumerate(self.dev_pwm_names):
            self._dev_pwm[dev_idx] = Device(dev_name, config, hal)

        self._dev_i2c = [None, None, None, None, None, None]
        for dev_idx, dev_name in enumerate(self.dev_i2c_names):
            self._dev_i2c[dev_idx] = Device(dev_name, config, hal)

        self._dev_gpio = [None, None, None, None, None, None]
        for dev_idx, dev_name in enumerate(self.dev_gpio_names):
            self._dev_gpio[dev_idx] = Device(dev_name, config, hal)
            
        # Hardcode the proper period
        for htr in range(len(self._dev_pwm)):
            for ch in range(len(PWM_PINS)):
                self.set_period(htr, ch, 10000)

    def connect(self):
        self._is_connected = True

    def disconnect(self):
        self._is_connected = False

    def reconnect(self):
        if self._is_connected:
            self.disconnect()
        self.connect()

    def is_connected(self):
        return self._is_connected

    def set_enable(self, dev_idx, chnl_idx, enable):
        # logger.debug(f&#34;Setting Heater {dev_idx + 1} Channel {chnl_idx + 1} to state: {enable}&#34;)
        self._dev_pwm[dev_idx].setMultiple([(&#39;PWM_NUM&#39;, PWM_PINS[chnl_idx]),\
                                            (&#39;PWM_ENABLE&#39;, enable)])
        self._dev_gpio[dev_idx].setMultiple([(&#39;GPIO_PIN&#39;, LED_PINS[chnl_idx]),\
                                             (&#39;GPIO_VALUE&#39;, enable)])

    def set_duty_cycle(self, dev_idx, chnl_idx, duty_cycle):
        # logger.debug(f&#34;Setting duty cycle of Heater {dev_idx + 1} Channel {chnl_idx + 1} to: {duty_cycle}&#34;)
        self._dev_pwm[dev_idx].setMultiple([(&#39;PWM_NUM&#39;, PWM_PINS[chnl_idx]), (&#39;PWM_DUTY_CYCLE&#39;, duty_cycle)])

    def set_period(self, dev_idx, chnl_idx, period):
        # logger.debug(f&#34;Setting period of Heater {dev_idx + 1} Channel {chnl_idx + 1} to: {period}&#34;)
        self._dev_pwm[dev_idx].setMultiple([(&#39;PWM_NUM&#39;, PWM_PINS[chnl_idx]), (&#39;PWM_PERIOD&#39;, period)])

    def get_temperature(self, dev_idx):
        def twosComp(val, bits):
            if (val &amp; (1 &lt;&lt; (bits - 1))) != 0:
                val = val - (1 &lt;&lt; bits)
            return val
        raw = self._dev_i2c[dev_idx].get(&#39;TEMP&#39;)
        val = ((raw &lt;&lt; 8) &amp; 0xFF00) + (raw &gt;&gt; 8)
        val = val &gt;&gt; 4
        return twosComp(val, 12) * (128/0x7FF)

    def get_availability(self):
        return self._availablity

    def get_voltage(self, dev_idx, chnl_idx):
        raw = self._dev_i2c[dev_idx].get(&#39;V_{}&#39;.format(chnl_idx))
        val = ((raw &lt;&lt; 8) &amp; 0xFF00) + (raw &gt;&gt; 8)
        val = val &gt;&gt; 4
        return val * 0.025

    def get_current(self, dev_idx, chnl_idx):
        raw = self._dev_i2c[dev_idx].get(&#39;I_{}&#39;.format(chnl_idx))
        val = ((raw &lt;&lt; 8) &amp; 0xFF00) + (raw &gt;&gt; 8)
        val = val &gt;&gt; 4
        return val * 5e-4

    def get_power(self, dev_idx, chnl_idx):
        return self.get_voltage(dev_idx, chnl_idx) * \
               self.get_current(dev_idx, chnl_idx)

    def get_enable(self, dev_idx, chnl_idx):
        pwm_enable = self._dev_pwm[dev_idx].getSetMultiple([(&#39;PWM_NUM&#39;, PWM_PINS[chnl_idx]), (&#39;PWM_ENABLE&#39;, None)])
        return bool(pwm_enable[0])
        
    def get_duty_cycle(self, dev_idx, chnl_idx):
        pwm_duty_cycle = self._dev_pwm[dev_idx].getSetMultiple([(&#39;PWM_NUM&#39;, PWM_PINS[chnl_idx]), (&#39;PWM_DUTY_CYCLE&#39;, None)])
        return int(pwm_duty_cycle[0])

def main():
    bbb = BeagleboneDeviceInterface()
    print(bbb.get_temperature(0))
    print(bbb.get_duty_cycle(0, 1))
    print(bbb.get_enable(0, 1))

if __name__ == &#39;__main__&#39;:
    main()</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="egse.tempcontrol.beaglebone.beaglebone_devif.main"><code class="name flex">
<span>def <span class="ident">main</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def main():
    bbb = BeagleboneDeviceInterface()
    print(bbb.get_temperature(0))
    print(bbb.get_duty_cycle(0, 1))
    print(bbb.get_enable(0, 1))</code></pre>
</details>
</dd>
</dl>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="egse.tempcontrol.beaglebone.beaglebone_devif.BeagleboneCommand"><code class="flex name class">
<span>class <span class="ident">BeagleboneCommand</span></span>
<span>(</span><span>name, cmd, response=None, wait=None, check=None, description=None, device_method=None)</span>
</code></dt>
<dd>
<div class="desc"><p>A Command is basically a string that is send to a device and for which the
device returns a response.</p>
<p>The command string can contain placeholders that will be filled when the
command is 'called'.</p>
<p>The arguments that are given will be filled into the formatted string.
Arguments can be positional or keyword arguments, not both.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class BeagleboneCommand(ClientServerCommand):
    def get_cmd_string(self, *args, **kwargs):
        out = super().get_cmd_string(*args, **kwargs)
        return out + &#39;\n&#39;</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li><a title="egse.command.ClientServerCommand" href="../../command.html#egse.command.ClientServerCommand">ClientServerCommand</a></li>
<li><a title="egse.command.Command" href="../../command.html#egse.command.Command">Command</a></li>
</ul>
<h3>Methods</h3>
<dl>
<dt id="egse.tempcontrol.beaglebone.beaglebone_devif.BeagleboneCommand.get_cmd_string"><code class="name flex">
<span>def <span class="ident">get_cmd_string</span></span>(<span>self, *args, **kwargs)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_cmd_string(self, *args, **kwargs):
    out = super().get_cmd_string(*args, **kwargs)
    return out + &#39;\n&#39;</code></pre>
</details>
</dd>
</dl>
<h3>Inherited members</h3>
<ul class="hlist">
<li><code><b><a title="egse.command.ClientServerCommand" href="../../command.html#egse.command.ClientServerCommand">ClientServerCommand</a></b></code>:
<ul class="hlist">
<li><code><a title="egse.command.ClientServerCommand.client_call" href="../../command.html#egse.command.ClientServerCommand.client_call">client_call</a></code></li>
<li><code><a title="egse.command.ClientServerCommand.server_call" href="../../command.html#egse.command.ClientServerCommand.server_call">server_call</a></code></li>
</ul>
</li>
</ul>
</dd>
<dt id="egse.tempcontrol.beaglebone.beaglebone_devif.BeagleboneDeviceInterface"><code class="flex name class">
<span>class <span class="ident">BeagleboneDeviceInterface</span></span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class BeagleboneDeviceInterface:
    def __init__(self):

        # Perform SRON gssw imports here to avoid issues at other THs
        from gssw.config.configclient import ConfigClient
        from gssw.common import addLoggingLevel
        from gssw.hal.hal import Hal
        from gssw.hal.halclient import HalClient
        from gssw.lib.device import Device

        self._is_connected = False

        # InitGssw does something to zmq that breaks cgse logging.
        # So instead I copied the essentials here.
        configClient = ConfigClient(os.getenv(&#39;GSSW_CONFIGURATION_FILE&#39;))
        config = configClient.config
        addLoggingLevel(&#39;data&#39;, 15)

        with ConfigurationManagerProxy() as cm:
            setup = cm.get_setup()

        self._availability = setup.gse.beaglebone_heater.availability

        hal = Hal()
        hal_client = HalClient(hal, config)
        hal_client.requestHal()

        self.dev_pwm_names = [f&#39;pwm_{dev_idx+1}&#39; for dev_idx, available in enumerate(self._availability) if available]
        self.dev_i2c_names = [f&#39;i2c_{dev_idx+1}&#39; for dev_idx, available in enumerate(self._availability)  if available]
        self.dev_gpio_names = [f&#39;gpio_{dev_idx+1}&#39; for dev_idx, available in enumerate(self._availability) if available]

        self._dev_pwm = [None, None, None, None, None, None]
        for dev_idx, dev_name in enumerate(self.dev_pwm_names):
            self._dev_pwm[dev_idx] = Device(dev_name, config, hal)

        self._dev_i2c = [None, None, None, None, None, None]
        for dev_idx, dev_name in enumerate(self.dev_i2c_names):
            self._dev_i2c[dev_idx] = Device(dev_name, config, hal)

        self._dev_gpio = [None, None, None, None, None, None]
        for dev_idx, dev_name in enumerate(self.dev_gpio_names):
            self._dev_gpio[dev_idx] = Device(dev_name, config, hal)
            
        # Hardcode the proper period
        for htr in range(len(self._dev_pwm)):
            for ch in range(len(PWM_PINS)):
                self.set_period(htr, ch, 10000)

    def connect(self):
        self._is_connected = True

    def disconnect(self):
        self._is_connected = False

    def reconnect(self):
        if self._is_connected:
            self.disconnect()
        self.connect()

    def is_connected(self):
        return self._is_connected

    def set_enable(self, dev_idx, chnl_idx, enable):
        # logger.debug(f&#34;Setting Heater {dev_idx + 1} Channel {chnl_idx + 1} to state: {enable}&#34;)
        self._dev_pwm[dev_idx].setMultiple([(&#39;PWM_NUM&#39;, PWM_PINS[chnl_idx]),\
                                            (&#39;PWM_ENABLE&#39;, enable)])
        self._dev_gpio[dev_idx].setMultiple([(&#39;GPIO_PIN&#39;, LED_PINS[chnl_idx]),\
                                             (&#39;GPIO_VALUE&#39;, enable)])

    def set_duty_cycle(self, dev_idx, chnl_idx, duty_cycle):
        # logger.debug(f&#34;Setting duty cycle of Heater {dev_idx + 1} Channel {chnl_idx + 1} to: {duty_cycle}&#34;)
        self._dev_pwm[dev_idx].setMultiple([(&#39;PWM_NUM&#39;, PWM_PINS[chnl_idx]), (&#39;PWM_DUTY_CYCLE&#39;, duty_cycle)])

    def set_period(self, dev_idx, chnl_idx, period):
        # logger.debug(f&#34;Setting period of Heater {dev_idx + 1} Channel {chnl_idx + 1} to: {period}&#34;)
        self._dev_pwm[dev_idx].setMultiple([(&#39;PWM_NUM&#39;, PWM_PINS[chnl_idx]), (&#39;PWM_PERIOD&#39;, period)])

    def get_temperature(self, dev_idx):
        def twosComp(val, bits):
            if (val &amp; (1 &lt;&lt; (bits - 1))) != 0:
                val = val - (1 &lt;&lt; bits)
            return val
        raw = self._dev_i2c[dev_idx].get(&#39;TEMP&#39;)
        val = ((raw &lt;&lt; 8) &amp; 0xFF00) + (raw &gt;&gt; 8)
        val = val &gt;&gt; 4
        return twosComp(val, 12) * (128/0x7FF)

    def get_availability(self):
        return self._availablity

    def get_voltage(self, dev_idx, chnl_idx):
        raw = self._dev_i2c[dev_idx].get(&#39;V_{}&#39;.format(chnl_idx))
        val = ((raw &lt;&lt; 8) &amp; 0xFF00) + (raw &gt;&gt; 8)
        val = val &gt;&gt; 4
        return val * 0.025

    def get_current(self, dev_idx, chnl_idx):
        raw = self._dev_i2c[dev_idx].get(&#39;I_{}&#39;.format(chnl_idx))
        val = ((raw &lt;&lt; 8) &amp; 0xFF00) + (raw &gt;&gt; 8)
        val = val &gt;&gt; 4
        return val * 5e-4

    def get_power(self, dev_idx, chnl_idx):
        return self.get_voltage(dev_idx, chnl_idx) * \
               self.get_current(dev_idx, chnl_idx)

    def get_enable(self, dev_idx, chnl_idx):
        pwm_enable = self._dev_pwm[dev_idx].getSetMultiple([(&#39;PWM_NUM&#39;, PWM_PINS[chnl_idx]), (&#39;PWM_ENABLE&#39;, None)])
        return bool(pwm_enable[0])
        
    def get_duty_cycle(self, dev_idx, chnl_idx):
        pwm_duty_cycle = self._dev_pwm[dev_idx].getSetMultiple([(&#39;PWM_NUM&#39;, PWM_PINS[chnl_idx]), (&#39;PWM_DUTY_CYCLE&#39;, None)])
        return int(pwm_duty_cycle[0])</code></pre>
</details>
<h3>Methods</h3>
<dl>
<dt id="egse.tempcontrol.beaglebone.beaglebone_devif.BeagleboneDeviceInterface.connect"><code class="name flex">
<span>def <span class="ident">connect</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def connect(self):
    self._is_connected = True</code></pre>
</details>
</dd>
<dt id="egse.tempcontrol.beaglebone.beaglebone_devif.BeagleboneDeviceInterface.disconnect"><code class="name flex">
<span>def <span class="ident">disconnect</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def disconnect(self):
    self._is_connected = False</code></pre>
</details>
</dd>
<dt id="egse.tempcontrol.beaglebone.beaglebone_devif.BeagleboneDeviceInterface.get_availability"><code class="name flex">
<span>def <span class="ident">get_availability</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_availability(self):
    return self._availablity</code></pre>
</details>
</dd>
<dt id="egse.tempcontrol.beaglebone.beaglebone_devif.BeagleboneDeviceInterface.get_current"><code class="name flex">
<span>def <span class="ident">get_current</span></span>(<span>self, dev_idx, chnl_idx)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_current(self, dev_idx, chnl_idx):
    raw = self._dev_i2c[dev_idx].get(&#39;I_{}&#39;.format(chnl_idx))
    val = ((raw &lt;&lt; 8) &amp; 0xFF00) + (raw &gt;&gt; 8)
    val = val &gt;&gt; 4
    return val * 5e-4</code></pre>
</details>
</dd>
<dt id="egse.tempcontrol.beaglebone.beaglebone_devif.BeagleboneDeviceInterface.get_duty_cycle"><code class="name flex">
<span>def <span class="ident">get_duty_cycle</span></span>(<span>self, dev_idx, chnl_idx)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_duty_cycle(self, dev_idx, chnl_idx):
    pwm_duty_cycle = self._dev_pwm[dev_idx].getSetMultiple([(&#39;PWM_NUM&#39;, PWM_PINS[chnl_idx]), (&#39;PWM_DUTY_CYCLE&#39;, None)])
    return int(pwm_duty_cycle[0])</code></pre>
</details>
</dd>
<dt id="egse.tempcontrol.beaglebone.beaglebone_devif.BeagleboneDeviceInterface.get_enable"><code class="name flex">
<span>def <span class="ident">get_enable</span></span>(<span>self, dev_idx, chnl_idx)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_enable(self, dev_idx, chnl_idx):
    pwm_enable = self._dev_pwm[dev_idx].getSetMultiple([(&#39;PWM_NUM&#39;, PWM_PINS[chnl_idx]), (&#39;PWM_ENABLE&#39;, None)])
    return bool(pwm_enable[0])</code></pre>
</details>
</dd>
<dt id="egse.tempcontrol.beaglebone.beaglebone_devif.BeagleboneDeviceInterface.get_power"><code class="name flex">
<span>def <span class="ident">get_power</span></span>(<span>self, dev_idx, chnl_idx)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_power(self, dev_idx, chnl_idx):
    return self.get_voltage(dev_idx, chnl_idx) * \
           self.get_current(dev_idx, chnl_idx)</code></pre>
</details>
</dd>
<dt id="egse.tempcontrol.beaglebone.beaglebone_devif.BeagleboneDeviceInterface.get_temperature"><code class="name flex">
<span>def <span class="ident">get_temperature</span></span>(<span>self, dev_idx)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_temperature(self, dev_idx):
    def twosComp(val, bits):
        if (val &amp; (1 &lt;&lt; (bits - 1))) != 0:
            val = val - (1 &lt;&lt; bits)
        return val
    raw = self._dev_i2c[dev_idx].get(&#39;TEMP&#39;)
    val = ((raw &lt;&lt; 8) &amp; 0xFF00) + (raw &gt;&gt; 8)
    val = val &gt;&gt; 4
    return twosComp(val, 12) * (128/0x7FF)</code></pre>
</details>
</dd>
<dt id="egse.tempcontrol.beaglebone.beaglebone_devif.BeagleboneDeviceInterface.get_voltage"><code class="name flex">
<span>def <span class="ident">get_voltage</span></span>(<span>self, dev_idx, chnl_idx)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_voltage(self, dev_idx, chnl_idx):
    raw = self._dev_i2c[dev_idx].get(&#39;V_{}&#39;.format(chnl_idx))
    val = ((raw &lt;&lt; 8) &amp; 0xFF00) + (raw &gt;&gt; 8)
    val = val &gt;&gt; 4
    return val * 0.025</code></pre>
</details>
</dd>
<dt id="egse.tempcontrol.beaglebone.beaglebone_devif.BeagleboneDeviceInterface.is_connected"><code class="name flex">
<span>def <span class="ident">is_connected</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def is_connected(self):
    return self._is_connected</code></pre>
</details>
</dd>
<dt id="egse.tempcontrol.beaglebone.beaglebone_devif.BeagleboneDeviceInterface.reconnect"><code class="name flex">
<span>def <span class="ident">reconnect</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def reconnect(self):
    if self._is_connected:
        self.disconnect()
    self.connect()</code></pre>
</details>
</dd>
<dt id="egse.tempcontrol.beaglebone.beaglebone_devif.BeagleboneDeviceInterface.set_duty_cycle"><code class="name flex">
<span>def <span class="ident">set_duty_cycle</span></span>(<span>self, dev_idx, chnl_idx, duty_cycle)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def set_duty_cycle(self, dev_idx, chnl_idx, duty_cycle):
    # logger.debug(f&#34;Setting duty cycle of Heater {dev_idx + 1} Channel {chnl_idx + 1} to: {duty_cycle}&#34;)
    self._dev_pwm[dev_idx].setMultiple([(&#39;PWM_NUM&#39;, PWM_PINS[chnl_idx]), (&#39;PWM_DUTY_CYCLE&#39;, duty_cycle)])</code></pre>
</details>
</dd>
<dt id="egse.tempcontrol.beaglebone.beaglebone_devif.BeagleboneDeviceInterface.set_enable"><code class="name flex">
<span>def <span class="ident">set_enable</span></span>(<span>self, dev_idx, chnl_idx, enable)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def set_enable(self, dev_idx, chnl_idx, enable):
    # logger.debug(f&#34;Setting Heater {dev_idx + 1} Channel {chnl_idx + 1} to state: {enable}&#34;)
    self._dev_pwm[dev_idx].setMultiple([(&#39;PWM_NUM&#39;, PWM_PINS[chnl_idx]),\
                                        (&#39;PWM_ENABLE&#39;, enable)])
    self._dev_gpio[dev_idx].setMultiple([(&#39;GPIO_PIN&#39;, LED_PINS[chnl_idx]),\
                                         (&#39;GPIO_VALUE&#39;, enable)])</code></pre>
</details>
</dd>
<dt id="egse.tempcontrol.beaglebone.beaglebone_devif.BeagleboneDeviceInterface.set_period"><code class="name flex">
<span>def <span class="ident">set_period</span></span>(<span>self, dev_idx, chnl_idx, period)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def set_period(self, dev_idx, chnl_idx, period):
    # logger.debug(f&#34;Setting period of Heater {dev_idx + 1} Channel {chnl_idx + 1} to: {period}&#34;)
    self._dev_pwm[dev_idx].setMultiple([(&#39;PWM_NUM&#39;, PWM_PINS[chnl_idx]), (&#39;PWM_PERIOD&#39;, period)])</code></pre>
</details>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="egse.tempcontrol.beaglebone" href="index.html">egse.tempcontrol.beaglebone</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="egse.tempcontrol.beaglebone.beaglebone_devif.main" href="#egse.tempcontrol.beaglebone.beaglebone_devif.main">main</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="egse.tempcontrol.beaglebone.beaglebone_devif.BeagleboneCommand" href="#egse.tempcontrol.beaglebone.beaglebone_devif.BeagleboneCommand">BeagleboneCommand</a></code></h4>
<ul class="">
<li><code><a title="egse.tempcontrol.beaglebone.beaglebone_devif.BeagleboneCommand.get_cmd_string" href="#egse.tempcontrol.beaglebone.beaglebone_devif.BeagleboneCommand.get_cmd_string">get_cmd_string</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="egse.tempcontrol.beaglebone.beaglebone_devif.BeagleboneDeviceInterface" href="#egse.tempcontrol.beaglebone.beaglebone_devif.BeagleboneDeviceInterface">BeagleboneDeviceInterface</a></code></h4>
<ul class="two-column">
<li><code><a title="egse.tempcontrol.beaglebone.beaglebone_devif.BeagleboneDeviceInterface.connect" href="#egse.tempcontrol.beaglebone.beaglebone_devif.BeagleboneDeviceInterface.connect">connect</a></code></li>
<li><code><a title="egse.tempcontrol.beaglebone.beaglebone_devif.BeagleboneDeviceInterface.disconnect" href="#egse.tempcontrol.beaglebone.beaglebone_devif.BeagleboneDeviceInterface.disconnect">disconnect</a></code></li>
<li><code><a title="egse.tempcontrol.beaglebone.beaglebone_devif.BeagleboneDeviceInterface.get_availability" href="#egse.tempcontrol.beaglebone.beaglebone_devif.BeagleboneDeviceInterface.get_availability">get_availability</a></code></li>
<li><code><a title="egse.tempcontrol.beaglebone.beaglebone_devif.BeagleboneDeviceInterface.get_current" href="#egse.tempcontrol.beaglebone.beaglebone_devif.BeagleboneDeviceInterface.get_current">get_current</a></code></li>
<li><code><a title="egse.tempcontrol.beaglebone.beaglebone_devif.BeagleboneDeviceInterface.get_duty_cycle" href="#egse.tempcontrol.beaglebone.beaglebone_devif.BeagleboneDeviceInterface.get_duty_cycle">get_duty_cycle</a></code></li>
<li><code><a title="egse.tempcontrol.beaglebone.beaglebone_devif.BeagleboneDeviceInterface.get_enable" href="#egse.tempcontrol.beaglebone.beaglebone_devif.BeagleboneDeviceInterface.get_enable">get_enable</a></code></li>
<li><code><a title="egse.tempcontrol.beaglebone.beaglebone_devif.BeagleboneDeviceInterface.get_power" href="#egse.tempcontrol.beaglebone.beaglebone_devif.BeagleboneDeviceInterface.get_power">get_power</a></code></li>
<li><code><a title="egse.tempcontrol.beaglebone.beaglebone_devif.BeagleboneDeviceInterface.get_temperature" href="#egse.tempcontrol.beaglebone.beaglebone_devif.BeagleboneDeviceInterface.get_temperature">get_temperature</a></code></li>
<li><code><a title="egse.tempcontrol.beaglebone.beaglebone_devif.BeagleboneDeviceInterface.get_voltage" href="#egse.tempcontrol.beaglebone.beaglebone_devif.BeagleboneDeviceInterface.get_voltage">get_voltage</a></code></li>
<li><code><a title="egse.tempcontrol.beaglebone.beaglebone_devif.BeagleboneDeviceInterface.is_connected" href="#egse.tempcontrol.beaglebone.beaglebone_devif.BeagleboneDeviceInterface.is_connected">is_connected</a></code></li>
<li><code><a title="egse.tempcontrol.beaglebone.beaglebone_devif.BeagleboneDeviceInterface.reconnect" href="#egse.tempcontrol.beaglebone.beaglebone_devif.BeagleboneDeviceInterface.reconnect">reconnect</a></code></li>
<li><code><a title="egse.tempcontrol.beaglebone.beaglebone_devif.BeagleboneDeviceInterface.set_duty_cycle" href="#egse.tempcontrol.beaglebone.beaglebone_devif.BeagleboneDeviceInterface.set_duty_cycle">set_duty_cycle</a></code></li>
<li><code><a title="egse.tempcontrol.beaglebone.beaglebone_devif.BeagleboneDeviceInterface.set_enable" href="#egse.tempcontrol.beaglebone.beaglebone_devif.BeagleboneDeviceInterface.set_enable">set_enable</a></code></li>
<li><code><a title="egse.tempcontrol.beaglebone.beaglebone_devif.BeagleboneDeviceInterface.set_period" href="#egse.tempcontrol.beaglebone.beaglebone_devif.BeagleboneDeviceInterface.set_period">set_period</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>