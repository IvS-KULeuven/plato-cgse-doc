<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>egse.stages.aerotech.ensemble API documentation</title>
<meta name="description" content="" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>egse.stages.aerotech.ensemble</code></h1>
</header>
<section id="section-intro">
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">import enum
import logging
import time

from prometheus_client import Gauge

from egse.control import ControlServer
from egse.command import ClientServerCommand
from egse.protocol import CommandProtocol
from egse.proxy import Proxy
from egse.settings import Settings
from egse.zmq_ser import bind_address
from egse.system import format_datetime
from egse.stages.aerotech.ensemble_interface import EnsembleInterface
from egse.stages.aerotech.ensemble_controller import EnsembleController
from egse.stages.aerotech.ensemble_simulator import EnsembleSimulator
from egse.zmq_ser import connect_address

AXISFAULT = {
    0: &#34;AF:PositionError&#34;,
    1: &#34;AF:OverCurrent&#34;,
    2: &#34;AF:CwEOTLimit&#34;,
    3: &#34;AF:CcwEOTLimit&#34;,
    4: &#34;AF:CwSoftLimit&#34;,
    5: &#34;AF:CcwSoftLimit&#34;,
    6: &#34;AF:AmplifierFault&#34;,
    7: &#34;AF:PositionFbk&#34;,
    8: &#34;AF:VelocityFbk&#34;,
    9: &#34;AF:HallFault&#34;,
    10: &#34;AF:MaxVelocity&#34;,
    11: &#34;AF:EstopFault&#34;,
    12: &#34;AF:VelocityError&#34;,
    15: &#34;AF:ExternalFault&#34;,
    17: &#34;AF:MotorTemp&#34;,
    18: &#34;AF:AmplifierTemp&#34;,
    19: &#34;AF:EncoderFault&#34;,
    20: &#34;AF:CommLost&#34;,
    23: &#34;AF:FbkScalingFault&#34;,
    24: &#34;AF:MrkSearchFault&#34;,
    27: &#34;AF:VoltageClamp&#34;,
    28: &#34;AF:PowerSupply&#34;,
    30: &#34;AF:Internal&#34;
}
AXISSTATUS = {
    0: &#34;AS:Enabled&#34;,
    1: &#34;AS:Homed&#34;,
    2: &#34;AS:InPosition&#34;,
    3: &#34;AS:MoveActive&#34;,
    4: &#34;AS:AccelPhase&#34;,
    5: &#34;AS:DecelPhase&#34;,
    6: &#34;AS:PositionCapture&#34;,
    7: &#34;AS:CurrentClamp&#34;,
    8: &#34;AS:BreakOutput&#34;,
    9: &#34;AS:MotionIsCw&#34;,
    10: &#34;AS:MsSlControl&#34;,
    11: &#34;AS:CalActivate&#34;,
    12: &#34;AS:CalEnabled&#34;,
    13: &#34;AS:JoystickControl&#34;,
    14: &#34;AS:Homing&#34;,
    15: &#34;AS:MasterSuppress&#34;,
    16: &#34;AS:GantryActive&#34;,
    17: &#34;AS:GantryMaster&#34;,
    18: &#34;AS:AutofocusActive&#34;,
    19: &#34;AS:CommandFilterDone&#34;,
    20: &#34;AS:InPosition2&#34;,
    21: &#34;AS:ServoControl&#34;,
    22: &#34;AS:CwEOTLimit&#34;,
    23: &#34;AS:CcwEOTLimit&#34;,
    24: &#34;AS:HomeLimit&#34;,
    25: &#34;AS:MarketInput&#34;,
    26: &#34;AS:HallAInput&#34;,
    27: &#34;AS:HallBInput&#34;,
    28: &#34;AS:HallCInput&#34;,
    29: &#34;AS:SinEncErr&#34;,
    30: &#34;AS:CSinEncErr&#34;,
    21: &#34;AS:ESTOPInput&#34;
}

LOGGER = logging.getLogger(__name__)

DEVICE_SETTINGS = Settings.load(filename=&#34;ensemble.yaml&#34;)
CTRL_SETTINGS = Settings.load(&#34;Aerotech Ensemble Control Server&#34;)


class EnsembleCommand(ClientServerCommand):
    pass


class EnsembleProtocol(CommandProtocol):

    def __init__(self, control_server: ControlServer):

        super().__init__()
        self.control_server = control_server

        if Settings.simulation_mode():
            self.dev = EnsembleSimulator()
        else:
            self.dev = EnsembleController()

        self.gauge_actual_position_x     = Gauge(&#39;GSRON_ENSEMBLE_ACT_POS_X&#39;, &#39;&#39;)
        self.gauge_actual_position_y     = Gauge(&#39;GSRON_ENSEMBLE_ACT_POS_Y&#39;, &#39;&#39;)
        self.gauge_command_position_x    = Gauge(&#39;GSRON_ENSEMBLE_CMD_POS_X&#39;, &#39;&#39;)
        self.gauge_command_position_y    = Gauge(&#39;GSRON_ENSEMBLE_CMD_POS_Y&#39;, &#39;&#39;)
        self.gauge_error_position_x      = Gauge(&#39;GSRON_ENSEMBLE_ERR_POS_X&#39;, &#39;&#39;)
        self.gauge_error_position_y      = Gauge(&#39;GSRON_ENSEMBLE_ERR_POS_Y&#39;, &#39;&#39;)
        self.gauge_actual_current_x      = Gauge(&#39;GSRON_ENSEMBLE_ACT_CUR_X&#39;, &#39;&#39;)
        self.gauge_actual_current_y      = Gauge(&#39;GSRON_ENSEMBLE_ACT_CUR_Y&#39;, &#39;&#39;)
        self.gauge_command_current_x     = Gauge(&#39;GSRON_ENSEMBLE_CMD_CUR_X&#39;, &#39;&#39;)
        self.gauge_command_current_y     = Gauge(&#39;GSRON_ENSEMBLE_CMD_CUR_Y&#39;, &#39;&#39;)

        self.gauge_actual_velocity_x     = Gauge(&#39;GSRON_ENSEMBLE_ACT_VEL_X&#39;, &#39;&#39;)
        self.gauge_actual_velocity_y     = Gauge(&#39;GSRON_ENSEMBLE_ACT_VEL_Y&#39;, &#39;&#39;)
        self.gauge_command_velocity_x    = Gauge(&#39;GSRON_ENSEMBLE_CMD_VEL_X&#39;, &#39;&#39;)
        self.gauge_command_velocity_y    = Gauge(&#39;GSRON_ENSEMBLE_CMD_VEL_Y&#39;, &#39;&#39;)

        self.gauge_power_x               = Gauge(&#39;GSRON_ENSEMBLE_POWER_X&#39;, &#39;&#39;)
        self.gauge_power_y               = Gauge(&#39;GSRON_ENSEMBLE_POWER_Y&#39;, &#39;&#39;)
        self.gauge_status_x              = [
            Gauge(f&#39;X{AXISSTATUS[x]}&#39;, &#39;&#39;) for _, x in enumerate(AXISSTATUS)]
        self.gauge_status_y              = [
            Gauge(f&#39;Y{AXISSTATUS[x]}&#39;, &#39;&#39;) for _, x in enumerate(AXISSTATUS)]
        self.gauge_fault_x               = [
            Gauge(f&#39;X{AXISFAULT[x]}&#39;, &#39;&#39;) for _, x in enumerate(AXISFAULT)]
        self.gauge_fault_y               = [
            Gauge(f&#39;Y{AXISFAULT[x]}&#39;, &#39;&#39;) for _, x in enumerate(AXISFAULT)]

        self.load_commands(DEVICE_SETTINGS.Commands, EnsembleCommand, EnsembleInterface)
        self.build_device_method_lookup_table(self.dev)


    # move to parent class?
    def get_bind_address(self):

        return bind_address(
            self.control_server.get_communication_protocol(),
            self.control_server.get_commanding_port(),
        )


    def get_status(self):

        status_dict = super().get_status()

        status_dict[&#34;alpha&#34;] = self.dev.get_actual_position(axis=&#34;X&#34;)   # [degrees]
        status_dict[&#34;beta&#34;] = self.dev.get_actual_position(axis=&#34;Y&#34;)    # [degrees]

        return status_dict


    def get_housekeeping(self) -&gt; dict:

        result = dict()

        result[&#34;timestamp&#34;] = format_datetime()
        try:
            result[&#34;GSRON_ENSEMBLE_STATUS_X&#34;] = self.dev.get_status(axis=&#39;X&#39;)
            result[&#34;GSRON_ENSEMBLE_STATUS_Y&#34;] = self.dev.get_status(axis=&#39;Y&#39;)
            result[&#34;GSRON_ENSEMBLE_FAULT_X&#34;] = self.dev.get_fault(axis=&#39;X&#39;)
            result[&#34;GSRON_ENSEMBLE_FAULT_Y&#34;] = self.dev.get_fault(axis=&#39;Y&#39;)
            result[&#34;GSRON_ENSEMBLE_ACT_POS_X&#34;] = self.dev.get_actual_position(axis=&#39;X&#39;)
            result[&#34;GSRON_ENSEMBLE_ACT_POS_Y&#34;] = self.dev.get_actual_position(axis=&#39;Y&#39;)
            result[&#34;GSRON_ENSEMBLE_CMD_POS_X&#34;] = self.dev.get_command_position(axis=&#39;X&#39;)
            result[&#34;GSRON_ENSEMBLE_CMD_POS_Y&#34;] = self.dev.get_command_position(axis=&#39;Y&#39;)
            result[&#34;GSRON_ENSEMBLE_ERR_POS_X&#34;] = self.dev.get_error_position(axis=&#39;X&#39;)
            result[&#34;GSRON_ENSEMBLE_ERR_POS_Y&#34;] = self.dev.get_error_position(axis=&#39;Y&#39;)
            result[&#34;GSRON_ENSEMBLE_ACT_CUR_X&#34;] = self.dev.get_actual_current(axis=&#39;X&#39;)
            result[&#34;GSRON_ENSEMBLE_ACT_CUR_Y&#34;] = self.dev.get_actual_current(axis=&#39;Y&#39;)
            result[&#34;GSRON_ENSEMBLE_CMD_CUR_X&#34;] = self.dev.get_command_current(axis=&#39;X&#39;)
            result[&#34;GSRON_ENSEMBLE_CMD_CUR_Y&#34;] = self.dev.get_command_current(axis=&#39;Y&#39;)
            result[&#34;GSRON_ENSEMBLE_CMD_VEL_X&#34;] = self.dev.get_command_velocity(axis=&#39;X&#39;)
            result[&#34;GSRON_ENSEMBLE_CMD_VEL_Y&#34;] = self.dev.get_command_velocity(axis=&#39;Y&#39;)
            result[&#34;GSRON_ENSEMBLE_ACT_VEL_X&#34;] = self.dev.get_actual_velocity(axis=&#39;X&#39;)
            result[&#34;GSRON_ENSEMBLE_ACT_VEL_Y&#34;] = self.dev.get_actual_velocity(axis=&#39;Y&#39;)

            # calculate the power dissipated
            result[&#34;GSRON_ENSEMBLE_POWER_X&#34;] = float(result[&#34;GSRON_ENSEMBLE_ACT_CUR_X&#34;]) * 60.0 * (3/2)
            result[&#34;GSRON_ENSEMBLE_POWER_Y&#34;] = float(result[&#34;GSRON_ENSEMBLE_ACT_CUR_Y&#34;]) * 60.0 * (3/2)

            # LOGGER.debug(f&#34;PACT: {result[&#39;GSRON_ENSEMBLE_ACT_POS_Y&#39;]}, \
            #                PCMD: {result[&#39;GSRON_ENSEMBLE_CMD_POS_Y&#39;]}, \
            #                IACT: {result[&#39;GSRON_ENSEMBLE_ACT_CUR_Y&#39;]}, \
            #                ICMD: {result[&#39;GSRON_ENSEMBLE_CMD_CUR_Y&#39;]}&#34;)

        except Exception as exc:
            LOGGER.error(f&#34;Exception getting HK: {exc}&#34;)

        self.gauge_actual_position_x.set(result[&#34;GSRON_ENSEMBLE_ACT_POS_X&#34;])
        self.gauge_actual_position_y.set(result[&#34;GSRON_ENSEMBLE_ACT_POS_Y&#34;])
        self.gauge_command_position_x.set(result[&#34;GSRON_ENSEMBLE_CMD_POS_X&#34;])
        self.gauge_command_position_y.set(result[&#34;GSRON_ENSEMBLE_CMD_POS_Y&#34;])
        self.gauge_actual_current_x.set(result[&#39;GSRON_ENSEMBLE_ACT_CUR_X&#39;])
        self.gauge_actual_current_y.set(result[&#39;GSRON_ENSEMBLE_ACT_CUR_Y&#39;])
        self.gauge_command_current_x.set(result[&#34;GSRON_ENSEMBLE_CMD_CUR_X&#34;])
        self.gauge_command_current_y.set(result[&#34;GSRON_ENSEMBLE_CMD_CUR_Y&#34;])
        self.gauge_actual_velocity_x.set(result[&#34;GSRON_ENSEMBLE_ACT_VEL_X&#34;])
        self.gauge_actual_velocity_y.set(result[&#34;GSRON_ENSEMBLE_ACT_VEL_Y&#34;])
        self.gauge_command_velocity_x.set(result[&#34;GSRON_ENSEMBLE_CMD_VEL_X&#34;])
        self.gauge_command_velocity_y.set(result[&#34;GSRON_ENSEMBLE_CMD_VEL_Y&#34;])

        self.gauge_power_x.set(result[&#34;GSRON_ENSEMBLE_POWER_X&#34;])
        self.gauge_power_y.set(result[&#34;GSRON_ENSEMBLE_POWER_Y&#34;])

        for y, x in enumerate(AXISSTATUS):
            self.gauge_status_x[y].set((result[&#34;GSRON_ENSEMBLE_STATUS_X&#34;] &gt;&gt; x) &amp; 0b1)
            self.gauge_status_y[y].set((result[&#34;GSRON_ENSEMBLE_STATUS_Y&#34;] &gt;&gt; x) &amp; 0b1)

        for y, x in enumerate(AXISFAULT):
            self.gauge_fault_x[y].set((result[&#34;GSRON_ENSEMBLE_FAULT_X&#34;] &gt;&gt; x) &amp; 0b1)
            self.gauge_fault_y[y].set((result[&#34;GSRON_ENSEMBLE_FAULT_Y&#34;] &gt;&gt; x) &amp; 0b1)
            
        # Check X axis EoT limits
        if result[&#39;GSRON_ENSEMBLE_FAULT_X&#39;] &amp; 0x04:
            LOGGER.warning(&#34;X axis clockwise End-of-Travel limit has been reached&#34;)
        if result[&#39;GSRON_ENSEMBLE_FAULT_X&#39;] &amp; 0x08:
            LOGGER.warning(&#34;X axis counterclockwise End-of-Travel limit has been reached&#34;)
        
        # Check Y axis EoT limits 
        if result[&#39;GSRON_ENSEMBLE_FAULT_Y&#39;] &amp; 0x04:
            LOGGER.warning(&#34;Y axis clockwise End-of-Travel limit has been reached&#34;)
        if result[&#39;GSRON_ENSEMBLE_FAULT_Y&#39;] &amp; 0x08:
            LOGGER.warning(&#34;Y axis counterclockwise End-of-Travel limit has been reached&#34;)

        return result


class EnsembleProxy(Proxy, EnsembleInterface):

    def __init__(self):
        super().__init__(
            connect_address(
                CTRL_SETTINGS.PROTOCOL, CTRL_SETTINGS.HOSTNAME, CTRL_SETTINGS.COMMANDING_PORT), timeout=500000)</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="egse.stages.aerotech.ensemble.EnsembleCommand"><code class="flex name class">
<span>class <span class="ident">EnsembleCommand</span></span>
<span>(</span><span>name, cmd, response=None, wait=None, check=None, description=None, device_method=None)</span>
</code></dt>
<dd>
<div class="desc"><p>A Command is basically a string that is send to a device and for which the
device returns a response.</p>
<p>The command string can contain placeholders that will be filled when the
command is 'called'.</p>
<p>The arguments that are given will be filled into the formatted string.
Arguments can be positional or keyword arguments, not both.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class EnsembleCommand(ClientServerCommand):
    pass</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li><a title="egse.command.ClientServerCommand" href="../../command.html#egse.command.ClientServerCommand">ClientServerCommand</a></li>
<li><a title="egse.command.Command" href="../../command.html#egse.command.Command">Command</a></li>
</ul>
<h3>Inherited members</h3>
<ul class="hlist">
<li><code><b><a title="egse.command.ClientServerCommand" href="../../command.html#egse.command.ClientServerCommand">ClientServerCommand</a></b></code>:
<ul class="hlist">
<li><code><a title="egse.command.ClientServerCommand.client_call" href="../../command.html#egse.command.ClientServerCommand.client_call">client_call</a></code></li>
<li><code><a title="egse.command.ClientServerCommand.server_call" href="../../command.html#egse.command.ClientServerCommand.server_call">server_call</a></code></li>
</ul>
</li>
</ul>
</dd>
<dt id="egse.stages.aerotech.ensemble.EnsembleProtocol"><code class="flex name class">
<span>class <span class="ident">EnsembleProtocol</span></span>
<span>(</span><span>control_server:Â <a title="egse.control.ControlServer" href="../../control.html#egse.control.ControlServer">ControlServer</a>)</span>
</code></dt>
<dd>
<div class="desc"><p>This class is the glue between the control servers and the hardware
controllers on one side, and between the control server and the connected
proxy classes on the other side.</p>
<p>The connection with the hardware controllers is when the <code>execute()</code> method
calls the <code>server_call()</code> method of the command class.</p>
<p>The connection with the proxy classes is when the <code>client_call()</code> method is added to the
interface of the Proxy subclass (by the <code>_add_commands()</code> method).</p>
<p>FIXME: Protocol is not used at the client side, i.e. the Proxy class.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class EnsembleProtocol(CommandProtocol):

    def __init__(self, control_server: ControlServer):

        super().__init__()
        self.control_server = control_server

        if Settings.simulation_mode():
            self.dev = EnsembleSimulator()
        else:
            self.dev = EnsembleController()

        self.gauge_actual_position_x     = Gauge(&#39;GSRON_ENSEMBLE_ACT_POS_X&#39;, &#39;&#39;)
        self.gauge_actual_position_y     = Gauge(&#39;GSRON_ENSEMBLE_ACT_POS_Y&#39;, &#39;&#39;)
        self.gauge_command_position_x    = Gauge(&#39;GSRON_ENSEMBLE_CMD_POS_X&#39;, &#39;&#39;)
        self.gauge_command_position_y    = Gauge(&#39;GSRON_ENSEMBLE_CMD_POS_Y&#39;, &#39;&#39;)
        self.gauge_error_position_x      = Gauge(&#39;GSRON_ENSEMBLE_ERR_POS_X&#39;, &#39;&#39;)
        self.gauge_error_position_y      = Gauge(&#39;GSRON_ENSEMBLE_ERR_POS_Y&#39;, &#39;&#39;)
        self.gauge_actual_current_x      = Gauge(&#39;GSRON_ENSEMBLE_ACT_CUR_X&#39;, &#39;&#39;)
        self.gauge_actual_current_y      = Gauge(&#39;GSRON_ENSEMBLE_ACT_CUR_Y&#39;, &#39;&#39;)
        self.gauge_command_current_x     = Gauge(&#39;GSRON_ENSEMBLE_CMD_CUR_X&#39;, &#39;&#39;)
        self.gauge_command_current_y     = Gauge(&#39;GSRON_ENSEMBLE_CMD_CUR_Y&#39;, &#39;&#39;)

        self.gauge_actual_velocity_x     = Gauge(&#39;GSRON_ENSEMBLE_ACT_VEL_X&#39;, &#39;&#39;)
        self.gauge_actual_velocity_y     = Gauge(&#39;GSRON_ENSEMBLE_ACT_VEL_Y&#39;, &#39;&#39;)
        self.gauge_command_velocity_x    = Gauge(&#39;GSRON_ENSEMBLE_CMD_VEL_X&#39;, &#39;&#39;)
        self.gauge_command_velocity_y    = Gauge(&#39;GSRON_ENSEMBLE_CMD_VEL_Y&#39;, &#39;&#39;)

        self.gauge_power_x               = Gauge(&#39;GSRON_ENSEMBLE_POWER_X&#39;, &#39;&#39;)
        self.gauge_power_y               = Gauge(&#39;GSRON_ENSEMBLE_POWER_Y&#39;, &#39;&#39;)
        self.gauge_status_x              = [
            Gauge(f&#39;X{AXISSTATUS[x]}&#39;, &#39;&#39;) for _, x in enumerate(AXISSTATUS)]
        self.gauge_status_y              = [
            Gauge(f&#39;Y{AXISSTATUS[x]}&#39;, &#39;&#39;) for _, x in enumerate(AXISSTATUS)]
        self.gauge_fault_x               = [
            Gauge(f&#39;X{AXISFAULT[x]}&#39;, &#39;&#39;) for _, x in enumerate(AXISFAULT)]
        self.gauge_fault_y               = [
            Gauge(f&#39;Y{AXISFAULT[x]}&#39;, &#39;&#39;) for _, x in enumerate(AXISFAULT)]

        self.load_commands(DEVICE_SETTINGS.Commands, EnsembleCommand, EnsembleInterface)
        self.build_device_method_lookup_table(self.dev)


    # move to parent class?
    def get_bind_address(self):

        return bind_address(
            self.control_server.get_communication_protocol(),
            self.control_server.get_commanding_port(),
        )


    def get_status(self):

        status_dict = super().get_status()

        status_dict[&#34;alpha&#34;] = self.dev.get_actual_position(axis=&#34;X&#34;)   # [degrees]
        status_dict[&#34;beta&#34;] = self.dev.get_actual_position(axis=&#34;Y&#34;)    # [degrees]

        return status_dict


    def get_housekeeping(self) -&gt; dict:

        result = dict()

        result[&#34;timestamp&#34;] = format_datetime()
        try:
            result[&#34;GSRON_ENSEMBLE_STATUS_X&#34;] = self.dev.get_status(axis=&#39;X&#39;)
            result[&#34;GSRON_ENSEMBLE_STATUS_Y&#34;] = self.dev.get_status(axis=&#39;Y&#39;)
            result[&#34;GSRON_ENSEMBLE_FAULT_X&#34;] = self.dev.get_fault(axis=&#39;X&#39;)
            result[&#34;GSRON_ENSEMBLE_FAULT_Y&#34;] = self.dev.get_fault(axis=&#39;Y&#39;)
            result[&#34;GSRON_ENSEMBLE_ACT_POS_X&#34;] = self.dev.get_actual_position(axis=&#39;X&#39;)
            result[&#34;GSRON_ENSEMBLE_ACT_POS_Y&#34;] = self.dev.get_actual_position(axis=&#39;Y&#39;)
            result[&#34;GSRON_ENSEMBLE_CMD_POS_X&#34;] = self.dev.get_command_position(axis=&#39;X&#39;)
            result[&#34;GSRON_ENSEMBLE_CMD_POS_Y&#34;] = self.dev.get_command_position(axis=&#39;Y&#39;)
            result[&#34;GSRON_ENSEMBLE_ERR_POS_X&#34;] = self.dev.get_error_position(axis=&#39;X&#39;)
            result[&#34;GSRON_ENSEMBLE_ERR_POS_Y&#34;] = self.dev.get_error_position(axis=&#39;Y&#39;)
            result[&#34;GSRON_ENSEMBLE_ACT_CUR_X&#34;] = self.dev.get_actual_current(axis=&#39;X&#39;)
            result[&#34;GSRON_ENSEMBLE_ACT_CUR_Y&#34;] = self.dev.get_actual_current(axis=&#39;Y&#39;)
            result[&#34;GSRON_ENSEMBLE_CMD_CUR_X&#34;] = self.dev.get_command_current(axis=&#39;X&#39;)
            result[&#34;GSRON_ENSEMBLE_CMD_CUR_Y&#34;] = self.dev.get_command_current(axis=&#39;Y&#39;)
            result[&#34;GSRON_ENSEMBLE_CMD_VEL_X&#34;] = self.dev.get_command_velocity(axis=&#39;X&#39;)
            result[&#34;GSRON_ENSEMBLE_CMD_VEL_Y&#34;] = self.dev.get_command_velocity(axis=&#39;Y&#39;)
            result[&#34;GSRON_ENSEMBLE_ACT_VEL_X&#34;] = self.dev.get_actual_velocity(axis=&#39;X&#39;)
            result[&#34;GSRON_ENSEMBLE_ACT_VEL_Y&#34;] = self.dev.get_actual_velocity(axis=&#39;Y&#39;)

            # calculate the power dissipated
            result[&#34;GSRON_ENSEMBLE_POWER_X&#34;] = float(result[&#34;GSRON_ENSEMBLE_ACT_CUR_X&#34;]) * 60.0 * (3/2)
            result[&#34;GSRON_ENSEMBLE_POWER_Y&#34;] = float(result[&#34;GSRON_ENSEMBLE_ACT_CUR_Y&#34;]) * 60.0 * (3/2)

            # LOGGER.debug(f&#34;PACT: {result[&#39;GSRON_ENSEMBLE_ACT_POS_Y&#39;]}, \
            #                PCMD: {result[&#39;GSRON_ENSEMBLE_CMD_POS_Y&#39;]}, \
            #                IACT: {result[&#39;GSRON_ENSEMBLE_ACT_CUR_Y&#39;]}, \
            #                ICMD: {result[&#39;GSRON_ENSEMBLE_CMD_CUR_Y&#39;]}&#34;)

        except Exception as exc:
            LOGGER.error(f&#34;Exception getting HK: {exc}&#34;)

        self.gauge_actual_position_x.set(result[&#34;GSRON_ENSEMBLE_ACT_POS_X&#34;])
        self.gauge_actual_position_y.set(result[&#34;GSRON_ENSEMBLE_ACT_POS_Y&#34;])
        self.gauge_command_position_x.set(result[&#34;GSRON_ENSEMBLE_CMD_POS_X&#34;])
        self.gauge_command_position_y.set(result[&#34;GSRON_ENSEMBLE_CMD_POS_Y&#34;])
        self.gauge_actual_current_x.set(result[&#39;GSRON_ENSEMBLE_ACT_CUR_X&#39;])
        self.gauge_actual_current_y.set(result[&#39;GSRON_ENSEMBLE_ACT_CUR_Y&#39;])
        self.gauge_command_current_x.set(result[&#34;GSRON_ENSEMBLE_CMD_CUR_X&#34;])
        self.gauge_command_current_y.set(result[&#34;GSRON_ENSEMBLE_CMD_CUR_Y&#34;])
        self.gauge_actual_velocity_x.set(result[&#34;GSRON_ENSEMBLE_ACT_VEL_X&#34;])
        self.gauge_actual_velocity_y.set(result[&#34;GSRON_ENSEMBLE_ACT_VEL_Y&#34;])
        self.gauge_command_velocity_x.set(result[&#34;GSRON_ENSEMBLE_CMD_VEL_X&#34;])
        self.gauge_command_velocity_y.set(result[&#34;GSRON_ENSEMBLE_CMD_VEL_Y&#34;])

        self.gauge_power_x.set(result[&#34;GSRON_ENSEMBLE_POWER_X&#34;])
        self.gauge_power_y.set(result[&#34;GSRON_ENSEMBLE_POWER_Y&#34;])

        for y, x in enumerate(AXISSTATUS):
            self.gauge_status_x[y].set((result[&#34;GSRON_ENSEMBLE_STATUS_X&#34;] &gt;&gt; x) &amp; 0b1)
            self.gauge_status_y[y].set((result[&#34;GSRON_ENSEMBLE_STATUS_Y&#34;] &gt;&gt; x) &amp; 0b1)

        for y, x in enumerate(AXISFAULT):
            self.gauge_fault_x[y].set((result[&#34;GSRON_ENSEMBLE_FAULT_X&#34;] &gt;&gt; x) &amp; 0b1)
            self.gauge_fault_y[y].set((result[&#34;GSRON_ENSEMBLE_FAULT_Y&#34;] &gt;&gt; x) &amp; 0b1)
            
        # Check X axis EoT limits
        if result[&#39;GSRON_ENSEMBLE_FAULT_X&#39;] &amp; 0x04:
            LOGGER.warning(&#34;X axis clockwise End-of-Travel limit has been reached&#34;)
        if result[&#39;GSRON_ENSEMBLE_FAULT_X&#39;] &amp; 0x08:
            LOGGER.warning(&#34;X axis counterclockwise End-of-Travel limit has been reached&#34;)
        
        # Check Y axis EoT limits 
        if result[&#39;GSRON_ENSEMBLE_FAULT_Y&#39;] &amp; 0x04:
            LOGGER.warning(&#34;Y axis clockwise End-of-Travel limit has been reached&#34;)
        if result[&#39;GSRON_ENSEMBLE_FAULT_Y&#39;] &amp; 0x08:
            LOGGER.warning(&#34;Y axis counterclockwise End-of-Travel limit has been reached&#34;)

        return result</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li><a title="egse.protocol.CommandProtocol" href="../../protocol.html#egse.protocol.CommandProtocol">CommandProtocol</a></li>
<li><a title="egse.device.DeviceConnectionObserver" href="../../device.html#egse.device.DeviceConnectionObserver">DeviceConnectionObserver</a></li>
</ul>
<h3>Inherited members</h3>
<ul class="hlist">
<li><code><b><a title="egse.protocol.CommandProtocol" href="../../protocol.html#egse.protocol.CommandProtocol">CommandProtocol</a></b></code>:
<ul class="hlist">
<li><code><a title="egse.protocol.CommandProtocol.bind" href="../../protocol.html#egse.protocol.CommandProtocol.bind">bind</a></code></li>
<li><code><a title="egse.protocol.CommandProtocol.build_device_method_lookup_table" href="../../protocol.html#egse.protocol.CommandProtocol.build_device_method_lookup_table">build_device_method_lookup_table</a></code></li>
<li><code><a title="egse.protocol.CommandProtocol.get_bind_address" href="../../protocol.html#egse.protocol.CommandProtocol.get_bind_address">get_bind_address</a></code></li>
<li><code><a title="egse.protocol.CommandProtocol.get_housekeeping" href="../../protocol.html#egse.protocol.CommandProtocol.get_housekeeping">get_housekeeping</a></code></li>
<li><code><a title="egse.protocol.CommandProtocol.get_status" href="../../protocol.html#egse.protocol.CommandProtocol.get_status">get_status</a></code></li>
<li><code><a title="egse.protocol.CommandProtocol.handle_device_method" href="../../protocol.html#egse.protocol.CommandProtocol.handle_device_method">handle_device_method</a></code></li>
<li><code><a title="egse.protocol.CommandProtocol.is_alive" href="../../protocol.html#egse.protocol.CommandProtocol.is_alive">is_alive</a></code></li>
<li><code><a title="egse.protocol.CommandProtocol.load_commands" href="../../protocol.html#egse.protocol.CommandProtocol.load_commands">load_commands</a></code></li>
<li><code><a title="egse.protocol.CommandProtocol.quit" href="../../protocol.html#egse.protocol.CommandProtocol.quit">quit</a></code></li>
<li><code><a title="egse.protocol.CommandProtocol.receive" href="../../protocol.html#egse.protocol.CommandProtocol.receive">receive</a></code></li>
<li><code><a title="egse.protocol.CommandProtocol.send" href="../../protocol.html#egse.protocol.CommandProtocol.send">send</a></code></li>
<li><code><a title="egse.protocol.CommandProtocol.send_commands" href="../../protocol.html#egse.protocol.CommandProtocol.send_commands">send_commands</a></code></li>
<li><code><a title="egse.protocol.CommandProtocol.state" href="../../device.html#egse.device.DeviceConnectionObserver.state">state</a></code></li>
<li><code><a title="egse.protocol.CommandProtocol.update_connection_state" href="../../device.html#egse.device.DeviceConnectionObserver.update_connection_state">update_connection_state</a></code></li>
</ul>
</li>
</ul>
</dd>
<dt id="egse.stages.aerotech.ensemble.EnsembleProxy"><code class="flex name class">
<span>class <span class="ident">EnsembleProxy</span></span>
</code></dt>
<dd>
<div class="desc"><p>A Proxy object will forward CommandExecutions to the connected control server
and wait for a response. When the Proxy can not connect to its control server
during initialization, a ConnectionError will be raised.</p>
<p>During initialization, the Proxy will connect to the control server and send a
handshaking <code>Ping</code> command. When that succeeds the Proxy will request and load the
available commands from the control server. When the connection with the control server
fails, no commands are loaded and the Proxy is left in a 'disconnected' state. The caller
can fix the problem with the control server and call <code>connect_cs()</code>, followed by a call to
<code>load_commands()</code>.</p>
<p>The <code>timeout</code> argument specifies the number of milliseconds</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class EnsembleProxy(Proxy, EnsembleInterface):

    def __init__(self):
        super().__init__(
            connect_address(
                CTRL_SETTINGS.PROTOCOL, CTRL_SETTINGS.HOSTNAME, CTRL_SETTINGS.COMMANDING_PORT), timeout=500000)</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li><a title="egse.proxy.Proxy" href="../../proxy.html#egse.proxy.Proxy">Proxy</a></li>
<li><a title="egse.proxy.BaseProxy" href="../../proxy.html#egse.proxy.BaseProxy">BaseProxy</a></li>
<li><a title="egse.proxy.ControlServerConnectionInterface" href="../../proxy.html#egse.proxy.ControlServerConnectionInterface">ControlServerConnectionInterface</a></li>
<li><a title="egse.stages.aerotech.ensemble_interface.EnsembleInterface" href="ensemble_interface.html#egse.stages.aerotech.ensemble_interface.EnsembleInterface">EnsembleInterface</a></li>
<li><a title="egse.device.DeviceInterface" href="../../device.html#egse.device.DeviceInterface">DeviceInterface</a></li>
<li><a title="egse.device.DeviceConnectionInterface" href="../../device.html#egse.device.DeviceConnectionInterface">DeviceConnectionInterface</a></li>
<li><a title="egse.device.DeviceConnectionObservable" href="../../device.html#egse.device.DeviceConnectionObservable">DeviceConnectionObservable</a></li>
</ul>
<h3>Inherited members</h3>
<ul class="hlist">
<li><code><b><a title="egse.proxy.Proxy" href="../../proxy.html#egse.proxy.Proxy">Proxy</a></b></code>:
<ul class="hlist">
<li><code><a title="egse.proxy.Proxy.connect_cs" href="../../proxy.html#egse.proxy.ControlServerConnectionInterface.connect_cs">connect_cs</a></code></li>
<li><code><a title="egse.proxy.Proxy.disconnect_cs" href="../../proxy.html#egse.proxy.ControlServerConnectionInterface.disconnect_cs">disconnect_cs</a></code></li>
<li><code><a title="egse.proxy.Proxy.get_commanding_port" href="../../proxy.html#egse.proxy.BaseProxy.get_commanding_port">get_commanding_port</a></code></li>
<li><code><a title="egse.proxy.Proxy.get_commands" href="../../proxy.html#egse.proxy.Proxy.get_commands">get_commands</a></code></li>
<li><code><a title="egse.proxy.Proxy.get_endpoint" href="../../proxy.html#egse.proxy.Proxy.get_endpoint">get_endpoint</a></code></li>
<li><code><a title="egse.proxy.Proxy.get_ip_address" href="../../proxy.html#egse.proxy.BaseProxy.get_ip_address">get_ip_address</a></code></li>
<li><code><a title="egse.proxy.Proxy.get_monitoring_port" href="../../proxy.html#egse.proxy.BaseProxy.get_monitoring_port">get_monitoring_port</a></code></li>
<li><code><a title="egse.proxy.Proxy.get_service_port" href="../../proxy.html#egse.proxy.BaseProxy.get_service_port">get_service_port</a></code></li>
<li><code><a title="egse.proxy.Proxy.get_service_proxy" href="../../proxy.html#egse.proxy.BaseProxy.get_service_proxy">get_service_proxy</a></code></li>
<li><code><a title="egse.proxy.Proxy.has_commands" href="../../proxy.html#egse.proxy.Proxy.has_commands">has_commands</a></code></li>
<li><code><a title="egse.proxy.Proxy.is_cs_connected" href="../../proxy.html#egse.proxy.ControlServerConnectionInterface.is_cs_connected">is_cs_connected</a></code></li>
<li><code><a title="egse.proxy.Proxy.load_commands" href="../../proxy.html#egse.proxy.Proxy.load_commands">load_commands</a></code></li>
<li><code><a title="egse.proxy.Proxy.reconnect_cs" href="../../proxy.html#egse.proxy.ControlServerConnectionInterface.reconnect_cs">reconnect_cs</a></code></li>
<li><code><a title="egse.proxy.Proxy.reset_cs_connection" href="../../proxy.html#egse.proxy.ControlServerConnectionInterface.reset_cs_connection">reset_cs_connection</a></code></li>
<li><code><a title="egse.proxy.Proxy.send" href="../../proxy.html#egse.proxy.BaseProxy.send">send</a></code></li>
</ul>
</li>
<li><code><b><a title="egse.stages.aerotech.ensemble_interface.EnsembleInterface" href="ensemble_interface.html#egse.stages.aerotech.ensemble_interface.EnsembleInterface">EnsembleInterface</a></b></code>:
<ul class="hlist">
<li><code><a title="egse.stages.aerotech.ensemble_interface.EnsembleInterface.add_observer" href="../../device.html#egse.device.DeviceConnectionObservable.add_observer">add_observer</a></code></li>
<li><code><a title="egse.stages.aerotech.ensemble_interface.EnsembleInterface.connect" href="../../device.html#egse.device.DeviceConnectionInterface.connect">connect</a></code></li>
<li><code><a title="egse.stages.aerotech.ensemble_interface.EnsembleInterface.disconnect" href="../../device.html#egse.device.DeviceConnectionInterface.disconnect">disconnect</a></code></li>
<li><code><a title="egse.stages.aerotech.ensemble_interface.EnsembleInterface.is_connected" href="../../device.html#egse.device.DeviceConnectionInterface.is_connected">is_connected</a></code></li>
<li><code><a title="egse.stages.aerotech.ensemble_interface.EnsembleInterface.is_simulator" href="../../device.html#egse.device.DeviceInterface.is_simulator">is_simulator</a></code></li>
<li><code><a title="egse.stages.aerotech.ensemble_interface.EnsembleInterface.notify_observers" href="../../device.html#egse.device.DeviceConnectionObservable.notify_observers">notify_observers</a></code></li>
<li><code><a title="egse.stages.aerotech.ensemble_interface.EnsembleInterface.reconnect" href="../../device.html#egse.device.DeviceConnectionInterface.reconnect">reconnect</a></code></li>
</ul>
</li>
</ul>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="egse.stages.aerotech" href="index.html">egse.stages.aerotech</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="egse.stages.aerotech.ensemble.EnsembleCommand" href="#egse.stages.aerotech.ensemble.EnsembleCommand">EnsembleCommand</a></code></h4>
</li>
<li>
<h4><code><a title="egse.stages.aerotech.ensemble.EnsembleProtocol" href="#egse.stages.aerotech.ensemble.EnsembleProtocol">EnsembleProtocol</a></code></h4>
</li>
<li>
<h4><code><a title="egse.stages.aerotech.ensemble.EnsembleProxy" href="#egse.stages.aerotech.ensemble.EnsembleProxy">EnsembleProxy</a></code></h4>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>