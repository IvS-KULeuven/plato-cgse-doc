<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>egse.dpu.dpu_ui API documentation</title>
<meta name="description" content="This module implements the image display for the N-FEE data and housekeeping …" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>egse.dpu.dpu_ui</code></h1>
</header>
<section id="section-intro">
<p>This module implements the image display for the N-FEE data and housekeeping.</p>
<p>The DPU GUI can be started from the command line with the <code>dpu_ui</code> command. The GUI will connect to the
data distribution port of the DPU Processor. For this to work, you will need to have at least a DPU control server
running.</p>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">&#34;&#34;&#34;
This module implements the image display for the N-FEE data and housekeeping.

The DPU GUI can be started from the command line with the `dpu_ui` command. The GUI will connect to the
data distribution port of the DPU Processor. For this to work, you will need to have at least a DPU control server
running.

&#34;&#34;&#34;
import contextlib
import logging
import multiprocessing
import os
import pickle
import threading
from pathlib import Path

import sys
from PyQt5.QtCore import QLockFile, QModelIndex
from PyQt5.QtWidgets import QMessageBox, QTableView

from egse.dpu.hdf5_model import RegisterTableModel
from egse.setup import SetupError
from egse.state import GlobalState

multiprocessing.current_process().name = &#34;dpu_ui&#34;

import zmq
from PyQt5 import QtCore
from PyQt5.QtCore import QObject
from PyQt5.QtCore import QRunnable
from PyQt5.QtCore import QThreadPool
from PyQt5.QtCore import pyqtSignal
from PyQt5.QtCore import pyqtSlot
from PyQt5.QtGui import QIcon
from PyQt5.QtWidgets import QApplication
from PyQt5.QtWidgets import QHBoxLayout
from PyQt5.QtWidgets import QLabel
from PyQt5.QtWidgets import QMainWindow
from PyQt5.QtWidgets import QStatusBar
from PyQt5.QtWidgets import QTabWidget
from PyQt5.QtWidgets import QVBoxLayout
from PyQt5.QtWidgets import QWidget
from prometheus_client import start_http_server

from egse.dpu.ccd_ui import ImageCreatorFullSize
from egse.dpu.ccd_ui import NFEE4CCDWidget
from egse.dpu.hk_ui import NFEEHousekeepingWidget
from egse.fee import convert_ccd_order_value
from egse.fee import n_fee_mode
from egse.process import ProcessStatus
from egse.reg import RegisterMap
from egse.resource import get_resource
from egse.settings import Settings
from egse.system import do_every
from egse.zmq import MessageIdentifier

LOGGER = logging.getLogger(__name__)

DPU_SETTINGS = Settings.load(&#34;DPU Processor&#34;)
GUI_SETTINGS = Settings.load(&#34;DPU GUI&#34;)


class WorkerSignals(QObject):
    &#34;&#34;&#34;
    Defines the signals available from a running worker thread.

    Supported signals are:

    finished
        No data

    error
        `str` Exception string

    result
        `dict` data returned from processing

    &#34;&#34;&#34;

    finished = pyqtSignal()
    error = pyqtSignal(str)
    data = pyqtSignal(int, object)


class DataPuller(QRunnable):
    def __init__(self, hostname: str, port: int):
        super().__init__()
        self.signals = WorkerSignals()
        self.hostname = hostname
        self.port = port
        self.quit_request = False
        self.receiver = None

    @pyqtSlot()
    def run(self):

        context = zmq.Context.instance()
        self.receiver = context.socket(zmq.SUB)
        self.receiver.setsockopt_string(zmq.SUBSCRIBE, &#34;&#34;)

        # It&#39;s not really clear if the &#39;client&#39; needs to connect to the port or
        # needs to bind to the port. What I see currently is that when the server (DPU Processor)
        # binds, then that process hangs. So, for the moment the DPU Processor connects to the
        # socket but PUSH the data. The result is that only one other process can bind!
        # Needs further investigation.... perhaps we should go back to PUB–SUB...
        # We went back to PUB-SUB...

        self.receiver.connect(f&#34;tcp://{self.hostname}:{self.port}&#34;)

        while True:
            if self.quit_request:
                break

            socket_list, _, _ = zmq.select([self.receiver], [], [], timeout=1.0)

            if self.receiver in socket_list:
                try:
                    sync_id, pickle_string = self.receiver.recv_multipart()
                    sync_id = int.from_bytes(sync_id, byteorder=&#39;big&#39;)
                    data = pickle.loads(pickle_string)
                    self.signals.data.emit(sync_id, data)
                except Exception as exc:
                    LOGGER.error(&#34;Exception caught!&#34;, exc_info=True)
                    self.signals.error.emit(str(exc))

        self.receiver.disconnect(f&#34;tcp://{self.hostname}:{self.port}&#34;)
        self.receiver.close()
        self.signals.finished.emit()

    def quit(self):
        self.quit_request = True


class ModeParameterWidget(QWidget):
    def __init__(self, params: dict):
        super().__init__()

        self.params = params

        # Use the following line to put a small border around all the parameters
        # self.setStyleSheet(&#39;border: 1px solid red;&#39;)

        vbox = QVBoxLayout()
        vbox.setSpacing(4)
        vbox.setContentsMargins(10, 0, 10, 0)

        vbox.addWidget(QLabel(&#34;Mode Parameters&#34;))

        for name, widget in self.params.items():
            hbox = QHBoxLayout()
            hbox.addWidget(QLabel(name))
            hbox.addWidget(widget)
            vbox.addLayout(hbox)

        self.setLayout(vbox)

    def update_par(self, name, value):
        self.params[name].setText(f&#34;{value}&#34;)

    def update_params(self, params: dict):
        for name, value in params.items():
            self.params[name].setText(f&#34;{value}&#34;)


class ReadoutParameterWidget(QWidget):
    def __init__(self, params: dict):
        super().__init__()

        self.params = params

        # Use the following line to put a small border around all the parameters
        # self.setStyleSheet(&#39;border: 1px solid red;&#39;)

        vbox = QVBoxLayout()
        vbox.setSpacing(4)
        vbox.setContentsMargins(10, 0, 10, 0)

        vbox.addWidget(QLabel(&#34;Readout Parameters&#34;))

        for name, widget in self.params.items():
            hbox = QHBoxLayout()
            hbox.addWidget(QLabel(name))
            hbox.addWidget(widget)
            vbox.addLayout(hbox)

        self.setLayout(vbox)

    def get_value(self, name):
        return self.params[name].text()

    def update_par(self, name, value):
        self.params[name].setText(f&#34;{value}&#34;)

    def update_params(self, params: dict):
        for name, value in params.items():
            self.params[name].setText(f&#34;{value}&#34;)


class MainWindow(QMainWindow):
    def __init__(self):
        super().__init__()

        self.setWindowTitle(&#34;DPU Image Display&#34;)

        self.setStatusBar(QStatusBar(self))
        self.status = self.statusBar()

        self.image = None
        self.register_map = None
        self.data_puller = None
        self.setup = GlobalState.setup

        try:
            self.ccd_bin_to_id = self.setup.camera.fee.ccd_numbering.CCD_BIN_TO_ID
        except AttributeError:
            raise SetupError(&#34;No entry in the setup for camera.fee.ccd_numbering.CCD_BIN_TO_ID&#34;)

        try:
            self.ccd_bin_to_idx = self.setup.camera.fee.ccd_numbering.CCD_BIN_TO_IDX
        except AttributeError:
            raise SetupError(&#34;No entry in the setup for camera.fee.ccd_numbering.CCD_BIN_TO_IDX&#34;)

        try:
            self.sensor_sel = self.setup.camera.fee.sensor_sel.enum
        except AttributeError:
            raise SetupError(&#34;No entry in the setup for camera.fee.sensor_sel&#34;)

        self.threadpool = QThreadPool()

        self.counter = 0

        self.tabs = QTabWidget()

        # Use the following line to put a small border around the components of the TAB Widget
        # self.tabs.setStyleSheet(&#39;border: 1px solid green;&#39;)

        self.hk_box = NFEEHousekeepingWidget()
        self.ccd_box = NFEE4CCDWidget()
        self.register_box = RegisterWidget()

        mode_params = {
            &#39;N-FEE Mode&#39;: QLabel(&#39;OFF&#39;),
            &#39;N-FEE Cycle Time&#39;: QLabel(&#34;&#34;),
            &#39;DUMP Mode&#39;: QLabel(&#34;&#34;),
            &#39;Internal Sync&#39;: QLabel(&#34;&#34;),
            &#39;External Sync&#39;: QLabel(&#34;&#34;),
        }

        self.mode_params = ModeParameterWidget(mode_params)

        readout_params = {
            &#39;Row Start&#39;: QLabel(&#39;0&#39;),
            &#39;Row End&#39;: QLabel(&#34;4509&#34;),
            &#39;Num Columns&#39;: QLabel(&#34;2295&#34;),
            &#39;Readout Order&#39;: QLabel(f&#34;{[1, 2, 3, 4]}&#34;),
            &#39;CCD Side&#39;: QLabel(&#34;&#34;),
            &#39;Number of Cycles&#39;: QLabel(&#34;&#34;),
        }

        self.readout_params = ReadoutParameterWidget(readout_params)

        self.tabs.addTab(self.ccd_box, &#34;CCD Display&#34;)
        self.tabs.addTab(self.hk_box, &#34;HK Packet&#34;)
        self.tabs.addTab(self.register_box, &#34;Register Map&#34;)

        params_box = QHBoxLayout()

        params_box.addWidget(self.mode_params)
        params_box.addWidget(self.readout_params)

        vbox = QVBoxLayout()
        vbox.setSpacing(0)  # limit the space between the views and the parameters
        vbox.addWidget(self.tabs, stretch=1)
        vbox.addLayout(params_box)

        w = QWidget()
        w.setLayout(vbox)
        self.setCentralWidget(w)

        self.show()

        self.start_pulling_data()

    def closeEvent(self, event):
        LOGGER.info(&#34;Window closed, quiting....&#34;)
        self.data_puller.quit()
        event.accept()

        all_threads_finished = self.threadpool.waitForDone(msecs=2000)
        if not all_threads_finished:
            LOGGER.warning(&#34;Not all threads were finished before the DPU GUI terminated.&#34;)

    def start_pulling_data(self):
        self.data_puller = worker = DataPuller(DPU_SETTINGS.HOSTNAME, DPU_SETTINGS.DATA_DISTRIBUTION_PORT)
        self.threadpool.start(worker)
        worker.signals.data.connect(self.worker_output)
        worker.signals.finished.connect(self.worker_complete)
        worker.signals.error.connect(self.worker_error)

    @pyqtSlot(int, bytes)
    def worker_output(self, sync_id, data):
        if sync_id == MessageIdentifier.SYNC_TIMECODE:
            timecode, timestamp = data
            # LOGGER.info(f&#34;TIMECODE: {timecode=}, {timestamp=}&#34;)
        if sync_id == MessageIdentifier.SYNC_HK_PACKET:
            hk_packet, timestamp = data
            if self.tabs.currentWidget() is self.hk_box:
                with contextlib.suppress(KeyError):
                    self.hk_box.update_fields(hk_packet)
            # LOGGER.info(f&#34;HK_PACKET: {hk_packet.type.frame_number=}, {timestamp=}&#34;)
            if hk_packet.type.frame_number == 0:
                pass
                # self.ccd_box.clear_image_data()
            if self.register_map is not None:
                # nr_lines = self.register_map[&#34;v_end&#34;] - self.register_map[&#34;v_start&#34;] + 1
                # nr_columns = self.register_map[&#34;h_end&#34;] + 1
                # self.image = ImageCreator(nr_lines=nr_lines, nr_columns=nr_columns)
                self.image = ImageCreatorFullSize(
                    v_start=self.register_map[&#34;v_start&#34;],
                    v_end=self.register_map[&#34;v_end&#34;],
                    h_end=self.register_map[&#34;h_end&#34;],
                )
                self.register_box.update(self.register_map)
        if sync_id == MessageIdentifier.SYNC_DATA_PACKET:
            data_packet, timestamp = data
            # LOGGER.info(f&#34;DATA_PACKET: {data_packet.type.ccd_number=}, {timestamp=}&#34;)
            self.mark_ccd_widget(data_packet.type.ccd_number)
            if self.image is not None:
                self.image.add_data(data_packet)
                if data_packet.type.last_packet:
                    self.ccd_box.show_ccd_image(
                        self.ccd_bin_to_id[data_packet.type.ccd_number],
                        data_packet.type.ccd_side,
                        self.image.get_image(data_packet.type.ccd_side)
                    )

        if sync_id == MessageIdentifier.N_FEE_REGISTER_MAP:
            self.register_map = reg = RegisterMap(&#39;N-FEE&#39;, memory_map=data)
            # LOGGER.info(f&#34;REGISTER_MAP: {reg[&#39;ccd_mode_config&#39;]=}&#34;)
            is_dump_mode = bool(not reg[&#34;digitise_en&#34;] and reg[&#34;DG_en&#34;] and reg[&#34;ccd_mode_config&#34;] == n_fee_mode.FULL_IMAGE_MODE)

            params = {
                &#39;N-FEE Mode&#39;: n_fee_mode(reg[&#34;ccd_mode_config&#34;]).name,
                &#39;N-FEE Cycle Time&#39;: &#34;25.0s&#34; if not reg[&#34;sync_sel&#34;] else f&#34;{reg[&#39;int_sync_period&#39;]/1000}s&#34;,
                &#39;DUMP Mode&#39;: is_dump_mode,
                &#39;Internal Sync&#39;: &#34;True&#34; if reg[&#34;sync_sel&#34;] else &#34;False&#34;,
                &#39;External Sync&#39;: &#34;False&#34; if reg[&#34;sync_sel&#34;] else &#34;True&#34;,
            }
            self.mode_params.update_params(params)
            readout_order = reg[&#34;ccd_readout_order&#34;]
            readout_order = convert_ccd_order_value(readout_order)
            params = {
                &#39;Row Start&#39;: reg[&#34;v_start&#34;],
                &#39;Row End&#39;: reg[&#34;v_end&#34;],
                &#39;Num Columns&#39;: reg[&#34;h_end&#34;] + 1,
                &#39;Readout Order&#39;: readout_order,
                &#39;CCD Side&#39;: self.sensor_sel(reg[&#39;sensor_sel&#39;]).name,
            }
            self.readout_params.update_params(params)
            if is_dump_mode:
                self.ccd_box.unmark()
        if sync_id == MessageIdentifier.NUM_CYCLES:
            # LOGGER.info(f&#34;NUMBER OF CYCLES: {data}&#34;)
            self.readout_params.update_par(&#39;Number of Cycles&#39;, max(0, data))

    @pyqtSlot()
    def worker_complete(self):
        LOGGER.warning(&#34;THREAD COMPLETE!&#34;)
        zmq.Context().destroy(linger=0)

    @pyqtSlot(str)
    def worker_error(self, t):
        LOGGER.warning(&#34;ERROR: %s&#34; % t)

    def mark_ccd_widget(self, ccd_number: int):
        self.ccd_box.mark(self.ccd_bin_to_idx[ccd_number])


class RegisterWidget(QWidget):
    &#34;&#34;&#34; Widget to display the FEE register map.&#34;&#34;&#34;

    def __init__(self, *args, **kwargs):
        super().__init__(*args, **kwargs)

        self.register_model = RegisterTableModel(RegisterMap())
        self.table_view = QTableView(self)
        self.table_view.setModel(self.register_model)
        self.table_view.resizeColumnsToContents()
        self.table_view.clicked.connect(self.on_cell_clicked)
        layout = QVBoxLayout(self)
        layout.addWidget(self.table_view)

    def update(self, register_map: RegisterMap):
        &#34;&#34;&#34; Update the register map.

        Args:
            - register_map: Register map to display.
        &#34;&#34;&#34;

        self.register_model.setRegisterMap(register_map)
        self.register_model.layoutChanged.emit()

        self.table_view.resizeColumnsToContents()
        self.repaint()

    def on_cell_clicked(self, index: QModelIndex, *args, **kwargs):
        self.register_model.toggleDisplayRole(index)


def main():

    lock_file = QLockFile(str(Path(&#34;~/dpu_ui.app.lock&#34;).expanduser()))

    app_logo = get_resource(&#34;:/icons/logo-dpu.svg&#34;)

    app = QApplication(sys.argv)
    app.setWindowIcon(QIcon(str(app_logo)))

    os.environ[&#34;QT_ENABLE_HIGHDPI_SCALING&#34;] = &#34;1&#34;

    QApplication.setHighDpiScaleFactorRoundingPolicy(
        QtCore.Qt.HighDpiScaleFactorRoundingPolicy.PassThrough)

    if lock_file.tryLock(100):

        process_status = ProcessStatus()

        timer_thread = threading.Thread(target=do_every, args=(10, process_status.update))
        timer_thread.daemon = True
        timer_thread.start()

        start_http_server(GUI_SETTINGS.METRICS_PORT)

        window = MainWindow()
        window.show()
        return app.exec()

    else:
        error_message = QMessageBox()
        error_message.setIcon(QMessageBox.Warning)
        error_message.setWindowTitle(&#34;Error&#34;)
        error_message.setText(&#34;The DPU GUI application is already running!&#34;)
        error_message.setStandardButtons(QMessageBox.Ok)

        return error_message.exec()


if __name__ == &#39;__main__&#39;:
    sys.exit(main())</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="egse.dpu.dpu_ui.main"><code class="name flex">
<span>def <span class="ident">main</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def main():

    lock_file = QLockFile(str(Path(&#34;~/dpu_ui.app.lock&#34;).expanduser()))

    app_logo = get_resource(&#34;:/icons/logo-dpu.svg&#34;)

    app = QApplication(sys.argv)
    app.setWindowIcon(QIcon(str(app_logo)))

    os.environ[&#34;QT_ENABLE_HIGHDPI_SCALING&#34;] = &#34;1&#34;

    QApplication.setHighDpiScaleFactorRoundingPolicy(
        QtCore.Qt.HighDpiScaleFactorRoundingPolicy.PassThrough)

    if lock_file.tryLock(100):

        process_status = ProcessStatus()

        timer_thread = threading.Thread(target=do_every, args=(10, process_status.update))
        timer_thread.daemon = True
        timer_thread.start()

        start_http_server(GUI_SETTINGS.METRICS_PORT)

        window = MainWindow()
        window.show()
        return app.exec()

    else:
        error_message = QMessageBox()
        error_message.setIcon(QMessageBox.Warning)
        error_message.setWindowTitle(&#34;Error&#34;)
        error_message.setText(&#34;The DPU GUI application is already running!&#34;)
        error_message.setStandardButtons(QMessageBox.Ok)

        return error_message.exec()</code></pre>
</details>
</dd>
</dl>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="egse.dpu.dpu_ui.DataPuller"><code class="flex name class">
<span>class <span class="ident">DataPuller</span></span>
<span>(</span><span>hostname: str, port: int)</span>
</code></dt>
<dd>
<div class="desc"><p>QRunnable()
QRunnable(QRunnable)</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class DataPuller(QRunnable):
    def __init__(self, hostname: str, port: int):
        super().__init__()
        self.signals = WorkerSignals()
        self.hostname = hostname
        self.port = port
        self.quit_request = False
        self.receiver = None

    @pyqtSlot()
    def run(self):

        context = zmq.Context.instance()
        self.receiver = context.socket(zmq.SUB)
        self.receiver.setsockopt_string(zmq.SUBSCRIBE, &#34;&#34;)

        # It&#39;s not really clear if the &#39;client&#39; needs to connect to the port or
        # needs to bind to the port. What I see currently is that when the server (DPU Processor)
        # binds, then that process hangs. So, for the moment the DPU Processor connects to the
        # socket but PUSH the data. The result is that only one other process can bind!
        # Needs further investigation.... perhaps we should go back to PUB–SUB...
        # We went back to PUB-SUB...

        self.receiver.connect(f&#34;tcp://{self.hostname}:{self.port}&#34;)

        while True:
            if self.quit_request:
                break

            socket_list, _, _ = zmq.select([self.receiver], [], [], timeout=1.0)

            if self.receiver in socket_list:
                try:
                    sync_id, pickle_string = self.receiver.recv_multipart()
                    sync_id = int.from_bytes(sync_id, byteorder=&#39;big&#39;)
                    data = pickle.loads(pickle_string)
                    self.signals.data.emit(sync_id, data)
                except Exception as exc:
                    LOGGER.error(&#34;Exception caught!&#34;, exc_info=True)
                    self.signals.error.emit(str(exc))

        self.receiver.disconnect(f&#34;tcp://{self.hostname}:{self.port}&#34;)
        self.receiver.close()
        self.signals.finished.emit()

    def quit(self):
        self.quit_request = True</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>PyQt5.QtCore.QRunnable</li>
<li>sip.wrapper</li>
<li>sip.simplewrapper</li>
</ul>
<h3>Methods</h3>
<dl>
<dt id="egse.dpu.dpu_ui.DataPuller.quit"><code class="name flex">
<span>def <span class="ident">quit</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def quit(self):
    self.quit_request = True</code></pre>
</details>
</dd>
<dt id="egse.dpu.dpu_ui.DataPuller.run"><code class="name flex">
<span>def <span class="ident">run</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>run(self)</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@pyqtSlot()
def run(self):

    context = zmq.Context.instance()
    self.receiver = context.socket(zmq.SUB)
    self.receiver.setsockopt_string(zmq.SUBSCRIBE, &#34;&#34;)

    # It&#39;s not really clear if the &#39;client&#39; needs to connect to the port or
    # needs to bind to the port. What I see currently is that when the server (DPU Processor)
    # binds, then that process hangs. So, for the moment the DPU Processor connects to the
    # socket but PUSH the data. The result is that only one other process can bind!
    # Needs further investigation.... perhaps we should go back to PUB–SUB...
    # We went back to PUB-SUB...

    self.receiver.connect(f&#34;tcp://{self.hostname}:{self.port}&#34;)

    while True:
        if self.quit_request:
            break

        socket_list, _, _ = zmq.select([self.receiver], [], [], timeout=1.0)

        if self.receiver in socket_list:
            try:
                sync_id, pickle_string = self.receiver.recv_multipart()
                sync_id = int.from_bytes(sync_id, byteorder=&#39;big&#39;)
                data = pickle.loads(pickle_string)
                self.signals.data.emit(sync_id, data)
            except Exception as exc:
                LOGGER.error(&#34;Exception caught!&#34;, exc_info=True)
                self.signals.error.emit(str(exc))

    self.receiver.disconnect(f&#34;tcp://{self.hostname}:{self.port}&#34;)
    self.receiver.close()
    self.signals.finished.emit()</code></pre>
</details>
</dd>
</dl>
</dd>
<dt id="egse.dpu.dpu_ui.MainWindow"><code class="flex name class">
<span>class <span class="ident">MainWindow</span></span>
</code></dt>
<dd>
<div class="desc"><p>QMainWindow(parent: QWidget = None, flags: Union[Qt.WindowFlags, Qt.WindowType] = Qt.WindowFlags())</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class MainWindow(QMainWindow):
    def __init__(self):
        super().__init__()

        self.setWindowTitle(&#34;DPU Image Display&#34;)

        self.setStatusBar(QStatusBar(self))
        self.status = self.statusBar()

        self.image = None
        self.register_map = None
        self.data_puller = None
        self.setup = GlobalState.setup

        try:
            self.ccd_bin_to_id = self.setup.camera.fee.ccd_numbering.CCD_BIN_TO_ID
        except AttributeError:
            raise SetupError(&#34;No entry in the setup for camera.fee.ccd_numbering.CCD_BIN_TO_ID&#34;)

        try:
            self.ccd_bin_to_idx = self.setup.camera.fee.ccd_numbering.CCD_BIN_TO_IDX
        except AttributeError:
            raise SetupError(&#34;No entry in the setup for camera.fee.ccd_numbering.CCD_BIN_TO_IDX&#34;)

        try:
            self.sensor_sel = self.setup.camera.fee.sensor_sel.enum
        except AttributeError:
            raise SetupError(&#34;No entry in the setup for camera.fee.sensor_sel&#34;)

        self.threadpool = QThreadPool()

        self.counter = 0

        self.tabs = QTabWidget()

        # Use the following line to put a small border around the components of the TAB Widget
        # self.tabs.setStyleSheet(&#39;border: 1px solid green;&#39;)

        self.hk_box = NFEEHousekeepingWidget()
        self.ccd_box = NFEE4CCDWidget()
        self.register_box = RegisterWidget()

        mode_params = {
            &#39;N-FEE Mode&#39;: QLabel(&#39;OFF&#39;),
            &#39;N-FEE Cycle Time&#39;: QLabel(&#34;&#34;),
            &#39;DUMP Mode&#39;: QLabel(&#34;&#34;),
            &#39;Internal Sync&#39;: QLabel(&#34;&#34;),
            &#39;External Sync&#39;: QLabel(&#34;&#34;),
        }

        self.mode_params = ModeParameterWidget(mode_params)

        readout_params = {
            &#39;Row Start&#39;: QLabel(&#39;0&#39;),
            &#39;Row End&#39;: QLabel(&#34;4509&#34;),
            &#39;Num Columns&#39;: QLabel(&#34;2295&#34;),
            &#39;Readout Order&#39;: QLabel(f&#34;{[1, 2, 3, 4]}&#34;),
            &#39;CCD Side&#39;: QLabel(&#34;&#34;),
            &#39;Number of Cycles&#39;: QLabel(&#34;&#34;),
        }

        self.readout_params = ReadoutParameterWidget(readout_params)

        self.tabs.addTab(self.ccd_box, &#34;CCD Display&#34;)
        self.tabs.addTab(self.hk_box, &#34;HK Packet&#34;)
        self.tabs.addTab(self.register_box, &#34;Register Map&#34;)

        params_box = QHBoxLayout()

        params_box.addWidget(self.mode_params)
        params_box.addWidget(self.readout_params)

        vbox = QVBoxLayout()
        vbox.setSpacing(0)  # limit the space between the views and the parameters
        vbox.addWidget(self.tabs, stretch=1)
        vbox.addLayout(params_box)

        w = QWidget()
        w.setLayout(vbox)
        self.setCentralWidget(w)

        self.show()

        self.start_pulling_data()

    def closeEvent(self, event):
        LOGGER.info(&#34;Window closed, quiting....&#34;)
        self.data_puller.quit()
        event.accept()

        all_threads_finished = self.threadpool.waitForDone(msecs=2000)
        if not all_threads_finished:
            LOGGER.warning(&#34;Not all threads were finished before the DPU GUI terminated.&#34;)

    def start_pulling_data(self):
        self.data_puller = worker = DataPuller(DPU_SETTINGS.HOSTNAME, DPU_SETTINGS.DATA_DISTRIBUTION_PORT)
        self.threadpool.start(worker)
        worker.signals.data.connect(self.worker_output)
        worker.signals.finished.connect(self.worker_complete)
        worker.signals.error.connect(self.worker_error)

    @pyqtSlot(int, bytes)
    def worker_output(self, sync_id, data):
        if sync_id == MessageIdentifier.SYNC_TIMECODE:
            timecode, timestamp = data
            # LOGGER.info(f&#34;TIMECODE: {timecode=}, {timestamp=}&#34;)
        if sync_id == MessageIdentifier.SYNC_HK_PACKET:
            hk_packet, timestamp = data
            if self.tabs.currentWidget() is self.hk_box:
                with contextlib.suppress(KeyError):
                    self.hk_box.update_fields(hk_packet)
            # LOGGER.info(f&#34;HK_PACKET: {hk_packet.type.frame_number=}, {timestamp=}&#34;)
            if hk_packet.type.frame_number == 0:
                pass
                # self.ccd_box.clear_image_data()
            if self.register_map is not None:
                # nr_lines = self.register_map[&#34;v_end&#34;] - self.register_map[&#34;v_start&#34;] + 1
                # nr_columns = self.register_map[&#34;h_end&#34;] + 1
                # self.image = ImageCreator(nr_lines=nr_lines, nr_columns=nr_columns)
                self.image = ImageCreatorFullSize(
                    v_start=self.register_map[&#34;v_start&#34;],
                    v_end=self.register_map[&#34;v_end&#34;],
                    h_end=self.register_map[&#34;h_end&#34;],
                )
                self.register_box.update(self.register_map)
        if sync_id == MessageIdentifier.SYNC_DATA_PACKET:
            data_packet, timestamp = data
            # LOGGER.info(f&#34;DATA_PACKET: {data_packet.type.ccd_number=}, {timestamp=}&#34;)
            self.mark_ccd_widget(data_packet.type.ccd_number)
            if self.image is not None:
                self.image.add_data(data_packet)
                if data_packet.type.last_packet:
                    self.ccd_box.show_ccd_image(
                        self.ccd_bin_to_id[data_packet.type.ccd_number],
                        data_packet.type.ccd_side,
                        self.image.get_image(data_packet.type.ccd_side)
                    )

        if sync_id == MessageIdentifier.N_FEE_REGISTER_MAP:
            self.register_map = reg = RegisterMap(&#39;N-FEE&#39;, memory_map=data)
            # LOGGER.info(f&#34;REGISTER_MAP: {reg[&#39;ccd_mode_config&#39;]=}&#34;)
            is_dump_mode = bool(not reg[&#34;digitise_en&#34;] and reg[&#34;DG_en&#34;] and reg[&#34;ccd_mode_config&#34;] == n_fee_mode.FULL_IMAGE_MODE)

            params = {
                &#39;N-FEE Mode&#39;: n_fee_mode(reg[&#34;ccd_mode_config&#34;]).name,
                &#39;N-FEE Cycle Time&#39;: &#34;25.0s&#34; if not reg[&#34;sync_sel&#34;] else f&#34;{reg[&#39;int_sync_period&#39;]/1000}s&#34;,
                &#39;DUMP Mode&#39;: is_dump_mode,
                &#39;Internal Sync&#39;: &#34;True&#34; if reg[&#34;sync_sel&#34;] else &#34;False&#34;,
                &#39;External Sync&#39;: &#34;False&#34; if reg[&#34;sync_sel&#34;] else &#34;True&#34;,
            }
            self.mode_params.update_params(params)
            readout_order = reg[&#34;ccd_readout_order&#34;]
            readout_order = convert_ccd_order_value(readout_order)
            params = {
                &#39;Row Start&#39;: reg[&#34;v_start&#34;],
                &#39;Row End&#39;: reg[&#34;v_end&#34;],
                &#39;Num Columns&#39;: reg[&#34;h_end&#34;] + 1,
                &#39;Readout Order&#39;: readout_order,
                &#39;CCD Side&#39;: self.sensor_sel(reg[&#39;sensor_sel&#39;]).name,
            }
            self.readout_params.update_params(params)
            if is_dump_mode:
                self.ccd_box.unmark()
        if sync_id == MessageIdentifier.NUM_CYCLES:
            # LOGGER.info(f&#34;NUMBER OF CYCLES: {data}&#34;)
            self.readout_params.update_par(&#39;Number of Cycles&#39;, max(0, data))

    @pyqtSlot()
    def worker_complete(self):
        LOGGER.warning(&#34;THREAD COMPLETE!&#34;)
        zmq.Context().destroy(linger=0)

    @pyqtSlot(str)
    def worker_error(self, t):
        LOGGER.warning(&#34;ERROR: %s&#34; % t)

    def mark_ccd_widget(self, ccd_number: int):
        self.ccd_box.mark(self.ccd_bin_to_idx[ccd_number])</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>PyQt5.QtWidgets.QMainWindow</li>
<li>PyQt5.QtWidgets.QWidget</li>
<li>PyQt5.QtCore.QObject</li>
<li>sip.wrapper</li>
<li>PyQt5.QtGui.QPaintDevice</li>
<li>sip.simplewrapper</li>
</ul>
<h3>Methods</h3>
<dl>
<dt id="egse.dpu.dpu_ui.MainWindow.closeEvent"><code class="name flex">
<span>def <span class="ident">closeEvent</span></span>(<span>self, event)</span>
</code></dt>
<dd>
<div class="desc"><p>closeEvent(self, QCloseEvent)</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def closeEvent(self, event):
    LOGGER.info(&#34;Window closed, quiting....&#34;)
    self.data_puller.quit()
    event.accept()

    all_threads_finished = self.threadpool.waitForDone(msecs=2000)
    if not all_threads_finished:
        LOGGER.warning(&#34;Not all threads were finished before the DPU GUI terminated.&#34;)</code></pre>
</details>
</dd>
<dt id="egse.dpu.dpu_ui.MainWindow.mark_ccd_widget"><code class="name flex">
<span>def <span class="ident">mark_ccd_widget</span></span>(<span>self, ccd_number: int)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def mark_ccd_widget(self, ccd_number: int):
    self.ccd_box.mark(self.ccd_bin_to_idx[ccd_number])</code></pre>
</details>
</dd>
<dt id="egse.dpu.dpu_ui.MainWindow.start_pulling_data"><code class="name flex">
<span>def <span class="ident">start_pulling_data</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def start_pulling_data(self):
    self.data_puller = worker = DataPuller(DPU_SETTINGS.HOSTNAME, DPU_SETTINGS.DATA_DISTRIBUTION_PORT)
    self.threadpool.start(worker)
    worker.signals.data.connect(self.worker_output)
    worker.signals.finished.connect(self.worker_complete)
    worker.signals.error.connect(self.worker_error)</code></pre>
</details>
</dd>
<dt id="egse.dpu.dpu_ui.MainWindow.worker_complete"><code class="name flex">
<span>def <span class="ident">worker_complete</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@pyqtSlot()
def worker_complete(self):
    LOGGER.warning(&#34;THREAD COMPLETE!&#34;)
    zmq.Context().destroy(linger=0)</code></pre>
</details>
</dd>
<dt id="egse.dpu.dpu_ui.MainWindow.worker_error"><code class="name flex">
<span>def <span class="ident">worker_error</span></span>(<span>self, t)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@pyqtSlot(str)
def worker_error(self, t):
    LOGGER.warning(&#34;ERROR: %s&#34; % t)</code></pre>
</details>
</dd>
<dt id="egse.dpu.dpu_ui.MainWindow.worker_output"><code class="name flex">
<span>def <span class="ident">worker_output</span></span>(<span>self, sync_id, data)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@pyqtSlot(int, bytes)
def worker_output(self, sync_id, data):
    if sync_id == MessageIdentifier.SYNC_TIMECODE:
        timecode, timestamp = data
        # LOGGER.info(f&#34;TIMECODE: {timecode=}, {timestamp=}&#34;)
    if sync_id == MessageIdentifier.SYNC_HK_PACKET:
        hk_packet, timestamp = data
        if self.tabs.currentWidget() is self.hk_box:
            with contextlib.suppress(KeyError):
                self.hk_box.update_fields(hk_packet)
        # LOGGER.info(f&#34;HK_PACKET: {hk_packet.type.frame_number=}, {timestamp=}&#34;)
        if hk_packet.type.frame_number == 0:
            pass
            # self.ccd_box.clear_image_data()
        if self.register_map is not None:
            # nr_lines = self.register_map[&#34;v_end&#34;] - self.register_map[&#34;v_start&#34;] + 1
            # nr_columns = self.register_map[&#34;h_end&#34;] + 1
            # self.image = ImageCreator(nr_lines=nr_lines, nr_columns=nr_columns)
            self.image = ImageCreatorFullSize(
                v_start=self.register_map[&#34;v_start&#34;],
                v_end=self.register_map[&#34;v_end&#34;],
                h_end=self.register_map[&#34;h_end&#34;],
            )
            self.register_box.update(self.register_map)
    if sync_id == MessageIdentifier.SYNC_DATA_PACKET:
        data_packet, timestamp = data
        # LOGGER.info(f&#34;DATA_PACKET: {data_packet.type.ccd_number=}, {timestamp=}&#34;)
        self.mark_ccd_widget(data_packet.type.ccd_number)
        if self.image is not None:
            self.image.add_data(data_packet)
            if data_packet.type.last_packet:
                self.ccd_box.show_ccd_image(
                    self.ccd_bin_to_id[data_packet.type.ccd_number],
                    data_packet.type.ccd_side,
                    self.image.get_image(data_packet.type.ccd_side)
                )

    if sync_id == MessageIdentifier.N_FEE_REGISTER_MAP:
        self.register_map = reg = RegisterMap(&#39;N-FEE&#39;, memory_map=data)
        # LOGGER.info(f&#34;REGISTER_MAP: {reg[&#39;ccd_mode_config&#39;]=}&#34;)
        is_dump_mode = bool(not reg[&#34;digitise_en&#34;] and reg[&#34;DG_en&#34;] and reg[&#34;ccd_mode_config&#34;] == n_fee_mode.FULL_IMAGE_MODE)

        params = {
            &#39;N-FEE Mode&#39;: n_fee_mode(reg[&#34;ccd_mode_config&#34;]).name,
            &#39;N-FEE Cycle Time&#39;: &#34;25.0s&#34; if not reg[&#34;sync_sel&#34;] else f&#34;{reg[&#39;int_sync_period&#39;]/1000}s&#34;,
            &#39;DUMP Mode&#39;: is_dump_mode,
            &#39;Internal Sync&#39;: &#34;True&#34; if reg[&#34;sync_sel&#34;] else &#34;False&#34;,
            &#39;External Sync&#39;: &#34;False&#34; if reg[&#34;sync_sel&#34;] else &#34;True&#34;,
        }
        self.mode_params.update_params(params)
        readout_order = reg[&#34;ccd_readout_order&#34;]
        readout_order = convert_ccd_order_value(readout_order)
        params = {
            &#39;Row Start&#39;: reg[&#34;v_start&#34;],
            &#39;Row End&#39;: reg[&#34;v_end&#34;],
            &#39;Num Columns&#39;: reg[&#34;h_end&#34;] + 1,
            &#39;Readout Order&#39;: readout_order,
            &#39;CCD Side&#39;: self.sensor_sel(reg[&#39;sensor_sel&#39;]).name,
        }
        self.readout_params.update_params(params)
        if is_dump_mode:
            self.ccd_box.unmark()
    if sync_id == MessageIdentifier.NUM_CYCLES:
        # LOGGER.info(f&#34;NUMBER OF CYCLES: {data}&#34;)
        self.readout_params.update_par(&#39;Number of Cycles&#39;, max(0, data))</code></pre>
</details>
</dd>
</dl>
</dd>
<dt id="egse.dpu.dpu_ui.ModeParameterWidget"><code class="flex name class">
<span>class <span class="ident">ModeParameterWidget</span></span>
<span>(</span><span>params: dict)</span>
</code></dt>
<dd>
<div class="desc"><p>QWidget(parent: QWidget = None, flags: Union[Qt.WindowFlags, Qt.WindowType] = Qt.WindowFlags())</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class ModeParameterWidget(QWidget):
    def __init__(self, params: dict):
        super().__init__()

        self.params = params

        # Use the following line to put a small border around all the parameters
        # self.setStyleSheet(&#39;border: 1px solid red;&#39;)

        vbox = QVBoxLayout()
        vbox.setSpacing(4)
        vbox.setContentsMargins(10, 0, 10, 0)

        vbox.addWidget(QLabel(&#34;Mode Parameters&#34;))

        for name, widget in self.params.items():
            hbox = QHBoxLayout()
            hbox.addWidget(QLabel(name))
            hbox.addWidget(widget)
            vbox.addLayout(hbox)

        self.setLayout(vbox)

    def update_par(self, name, value):
        self.params[name].setText(f&#34;{value}&#34;)

    def update_params(self, params: dict):
        for name, value in params.items():
            self.params[name].setText(f&#34;{value}&#34;)</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>PyQt5.QtWidgets.QWidget</li>
<li>PyQt5.QtCore.QObject</li>
<li>sip.wrapper</li>
<li>PyQt5.QtGui.QPaintDevice</li>
<li>sip.simplewrapper</li>
</ul>
<h3>Methods</h3>
<dl>
<dt id="egse.dpu.dpu_ui.ModeParameterWidget.update_par"><code class="name flex">
<span>def <span class="ident">update_par</span></span>(<span>self, name, value)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def update_par(self, name, value):
    self.params[name].setText(f&#34;{value}&#34;)</code></pre>
</details>
</dd>
<dt id="egse.dpu.dpu_ui.ModeParameterWidget.update_params"><code class="name flex">
<span>def <span class="ident">update_params</span></span>(<span>self, params: dict)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def update_params(self, params: dict):
    for name, value in params.items():
        self.params[name].setText(f&#34;{value}&#34;)</code></pre>
</details>
</dd>
</dl>
</dd>
<dt id="egse.dpu.dpu_ui.ReadoutParameterWidget"><code class="flex name class">
<span>class <span class="ident">ReadoutParameterWidget</span></span>
<span>(</span><span>params: dict)</span>
</code></dt>
<dd>
<div class="desc"><p>QWidget(parent: QWidget = None, flags: Union[Qt.WindowFlags, Qt.WindowType] = Qt.WindowFlags())</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class ReadoutParameterWidget(QWidget):
    def __init__(self, params: dict):
        super().__init__()

        self.params = params

        # Use the following line to put a small border around all the parameters
        # self.setStyleSheet(&#39;border: 1px solid red;&#39;)

        vbox = QVBoxLayout()
        vbox.setSpacing(4)
        vbox.setContentsMargins(10, 0, 10, 0)

        vbox.addWidget(QLabel(&#34;Readout Parameters&#34;))

        for name, widget in self.params.items():
            hbox = QHBoxLayout()
            hbox.addWidget(QLabel(name))
            hbox.addWidget(widget)
            vbox.addLayout(hbox)

        self.setLayout(vbox)

    def get_value(self, name):
        return self.params[name].text()

    def update_par(self, name, value):
        self.params[name].setText(f&#34;{value}&#34;)

    def update_params(self, params: dict):
        for name, value in params.items():
            self.params[name].setText(f&#34;{value}&#34;)</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>PyQt5.QtWidgets.QWidget</li>
<li>PyQt5.QtCore.QObject</li>
<li>sip.wrapper</li>
<li>PyQt5.QtGui.QPaintDevice</li>
<li>sip.simplewrapper</li>
</ul>
<h3>Methods</h3>
<dl>
<dt id="egse.dpu.dpu_ui.ReadoutParameterWidget.get_value"><code class="name flex">
<span>def <span class="ident">get_value</span></span>(<span>self, name)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_value(self, name):
    return self.params[name].text()</code></pre>
</details>
</dd>
<dt id="egse.dpu.dpu_ui.ReadoutParameterWidget.update_par"><code class="name flex">
<span>def <span class="ident">update_par</span></span>(<span>self, name, value)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def update_par(self, name, value):
    self.params[name].setText(f&#34;{value}&#34;)</code></pre>
</details>
</dd>
<dt id="egse.dpu.dpu_ui.ReadoutParameterWidget.update_params"><code class="name flex">
<span>def <span class="ident">update_params</span></span>(<span>self, params: dict)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def update_params(self, params: dict):
    for name, value in params.items():
        self.params[name].setText(f&#34;{value}&#34;)</code></pre>
</details>
</dd>
</dl>
</dd>
<dt id="egse.dpu.dpu_ui.RegisterWidget"><code class="flex name class">
<span>class <span class="ident">RegisterWidget</span></span>
<span>(</span><span>*args, **kwargs)</span>
</code></dt>
<dd>
<div class="desc"><p>Widget to display the FEE register map.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class RegisterWidget(QWidget):
    &#34;&#34;&#34; Widget to display the FEE register map.&#34;&#34;&#34;

    def __init__(self, *args, **kwargs):
        super().__init__(*args, **kwargs)

        self.register_model = RegisterTableModel(RegisterMap())
        self.table_view = QTableView(self)
        self.table_view.setModel(self.register_model)
        self.table_view.resizeColumnsToContents()
        self.table_view.clicked.connect(self.on_cell_clicked)
        layout = QVBoxLayout(self)
        layout.addWidget(self.table_view)

    def update(self, register_map: RegisterMap):
        &#34;&#34;&#34; Update the register map.

        Args:
            - register_map: Register map to display.
        &#34;&#34;&#34;

        self.register_model.setRegisterMap(register_map)
        self.register_model.layoutChanged.emit()

        self.table_view.resizeColumnsToContents()
        self.repaint()

    def on_cell_clicked(self, index: QModelIndex, *args, **kwargs):
        self.register_model.toggleDisplayRole(index)</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>PyQt5.QtWidgets.QWidget</li>
<li>PyQt5.QtCore.QObject</li>
<li>sip.wrapper</li>
<li>PyQt5.QtGui.QPaintDevice</li>
<li>sip.simplewrapper</li>
</ul>
<h3>Methods</h3>
<dl>
<dt id="egse.dpu.dpu_ui.RegisterWidget.on_cell_clicked"><code class="name flex">
<span>def <span class="ident">on_cell_clicked</span></span>(<span>self, index: PyQt5.QtCore.QModelIndex, *args, **kwargs)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def on_cell_clicked(self, index: QModelIndex, *args, **kwargs):
    self.register_model.toggleDisplayRole(index)</code></pre>
</details>
</dd>
<dt id="egse.dpu.dpu_ui.RegisterWidget.update"><code class="name flex">
<span>def <span class="ident">update</span></span>(<span>self, register_map: <a title="egse.reg.RegisterMap" href="../reg.html#egse.reg.RegisterMap">RegisterMap</a>)</span>
</code></dt>
<dd>
<div class="desc"><p>Update the register map.</p>
<h2 id="args">Args</h2>
<ul>
<li>register_map: Register map to display.</li>
</ul></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def update(self, register_map: RegisterMap):
    &#34;&#34;&#34; Update the register map.

    Args:
        - register_map: Register map to display.
    &#34;&#34;&#34;

    self.register_model.setRegisterMap(register_map)
    self.register_model.layoutChanged.emit()

    self.table_view.resizeColumnsToContents()
    self.repaint()</code></pre>
</details>
</dd>
</dl>
</dd>
<dt id="egse.dpu.dpu_ui.WorkerSignals"><code class="flex name class">
<span>class <span class="ident">WorkerSignals</span></span>
<span>(</span><span>*args, **kwargs)</span>
</code></dt>
<dd>
<div class="desc"><p>Defines the signals available from a running worker thread.</p>
<p>Supported signals are:</p>
<p>finished
No data</p>
<p>error
<code>str</code> Exception string</p>
<p>result
<code>dict</code> data returned from processing</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class WorkerSignals(QObject):
    &#34;&#34;&#34;
    Defines the signals available from a running worker thread.

    Supported signals are:

    finished
        No data

    error
        `str` Exception string

    result
        `dict` data returned from processing

    &#34;&#34;&#34;

    finished = pyqtSignal()
    error = pyqtSignal(str)
    data = pyqtSignal(int, object)</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>PyQt5.QtCore.QObject</li>
<li>sip.wrapper</li>
<li>sip.simplewrapper</li>
</ul>
<h3>Methods</h3>
<dl>
<dt id="egse.dpu.dpu_ui.WorkerSignals.data"><code class="name flex">
<span>def <span class="ident">data</span></span>(<span>...)</span>
</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="egse.dpu.dpu_ui.WorkerSignals.error"><code class="name flex">
<span>def <span class="ident">error</span></span>(<span>...)</span>
</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="egse.dpu.dpu_ui.WorkerSignals.finished"><code class="name flex">
<span>def <span class="ident">finished</span></span>(<span>...)</span>
</code></dt>
<dd>
<div class="desc"></div>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="egse.dpu" href="index.html">egse.dpu</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="egse.dpu.dpu_ui.main" href="#egse.dpu.dpu_ui.main">main</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="egse.dpu.dpu_ui.DataPuller" href="#egse.dpu.dpu_ui.DataPuller">DataPuller</a></code></h4>
<ul class="">
<li><code><a title="egse.dpu.dpu_ui.DataPuller.quit" href="#egse.dpu.dpu_ui.DataPuller.quit">quit</a></code></li>
<li><code><a title="egse.dpu.dpu_ui.DataPuller.run" href="#egse.dpu.dpu_ui.DataPuller.run">run</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="egse.dpu.dpu_ui.MainWindow" href="#egse.dpu.dpu_ui.MainWindow">MainWindow</a></code></h4>
<ul class="two-column">
<li><code><a title="egse.dpu.dpu_ui.MainWindow.closeEvent" href="#egse.dpu.dpu_ui.MainWindow.closeEvent">closeEvent</a></code></li>
<li><code><a title="egse.dpu.dpu_ui.MainWindow.mark_ccd_widget" href="#egse.dpu.dpu_ui.MainWindow.mark_ccd_widget">mark_ccd_widget</a></code></li>
<li><code><a title="egse.dpu.dpu_ui.MainWindow.start_pulling_data" href="#egse.dpu.dpu_ui.MainWindow.start_pulling_data">start_pulling_data</a></code></li>
<li><code><a title="egse.dpu.dpu_ui.MainWindow.worker_complete" href="#egse.dpu.dpu_ui.MainWindow.worker_complete">worker_complete</a></code></li>
<li><code><a title="egse.dpu.dpu_ui.MainWindow.worker_error" href="#egse.dpu.dpu_ui.MainWindow.worker_error">worker_error</a></code></li>
<li><code><a title="egse.dpu.dpu_ui.MainWindow.worker_output" href="#egse.dpu.dpu_ui.MainWindow.worker_output">worker_output</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="egse.dpu.dpu_ui.ModeParameterWidget" href="#egse.dpu.dpu_ui.ModeParameterWidget">ModeParameterWidget</a></code></h4>
<ul class="">
<li><code><a title="egse.dpu.dpu_ui.ModeParameterWidget.update_par" href="#egse.dpu.dpu_ui.ModeParameterWidget.update_par">update_par</a></code></li>
<li><code><a title="egse.dpu.dpu_ui.ModeParameterWidget.update_params" href="#egse.dpu.dpu_ui.ModeParameterWidget.update_params">update_params</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="egse.dpu.dpu_ui.ReadoutParameterWidget" href="#egse.dpu.dpu_ui.ReadoutParameterWidget">ReadoutParameterWidget</a></code></h4>
<ul class="">
<li><code><a title="egse.dpu.dpu_ui.ReadoutParameterWidget.get_value" href="#egse.dpu.dpu_ui.ReadoutParameterWidget.get_value">get_value</a></code></li>
<li><code><a title="egse.dpu.dpu_ui.ReadoutParameterWidget.update_par" href="#egse.dpu.dpu_ui.ReadoutParameterWidget.update_par">update_par</a></code></li>
<li><code><a title="egse.dpu.dpu_ui.ReadoutParameterWidget.update_params" href="#egse.dpu.dpu_ui.ReadoutParameterWidget.update_params">update_params</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="egse.dpu.dpu_ui.RegisterWidget" href="#egse.dpu.dpu_ui.RegisterWidget">RegisterWidget</a></code></h4>
<ul class="">
<li><code><a title="egse.dpu.dpu_ui.RegisterWidget.on_cell_clicked" href="#egse.dpu.dpu_ui.RegisterWidget.on_cell_clicked">on_cell_clicked</a></code></li>
<li><code><a title="egse.dpu.dpu_ui.RegisterWidget.update" href="#egse.dpu.dpu_ui.RegisterWidget.update">update</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="egse.dpu.dpu_ui.WorkerSignals" href="#egse.dpu.dpu_ui.WorkerSignals">WorkerSignals</a></code></h4>
<ul class="">
<li><code><a title="egse.dpu.dpu_ui.WorkerSignals.data" href="#egse.dpu.dpu_ui.WorkerSignals.data">data</a></code></li>
<li><code><a title="egse.dpu.dpu_ui.WorkerSignals.error" href="#egse.dpu.dpu_ui.WorkerSignals.error">error</a></code></li>
<li><code><a title="egse.dpu.dpu_ui.WorkerSignals.finished" href="#egse.dpu.dpu_ui.WorkerSignals.finished">finished</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>