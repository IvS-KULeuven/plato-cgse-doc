<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>egse.dpu.hdf5_viewer API documentation</title>
<meta name="description" content="A simple GUI application to visualise the content of an HDF5 file that contains N-FEE SpceWire data." />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>egse.dpu.hdf5_viewer</code></h1>
</header>
<section id="section-intro">
<p>A simple GUI application to visualise the content of an HDF5 file that contains N-FEE SpceWire data.</p>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">&#34;&#34;&#34;
A simple GUI application to visualise the content of an HDF5 file that contains N-FEE SpceWire data.
&#34;&#34;&#34;
# The original attempt was to use the TreeModel dynamically, but that didn&#39;t work and I finally
# found the reason in this StackOverflow topic:
#
# https://stackoverflow.com/questions/22713374/
#
# My solution to this problem was to save the internal_pointers in a set() because then they would
# not be duplicated, but that didn&#39;t work out. I then saved them in a list, this version was
# working, but very slow and the _internal_pointers grow indefinitely. My next try was to use a
# dictionary and create / retrieve the internal pointers. That work fine and is already faster, but
# it is not an elegant solution.
#
# The current implementation is based on the Simple Tree Model Example from the Qt documentation:
#
# https://doc.qt.io/qt-5/qtwidgets-itemviews-simpletreemodel-example.html#treemodel-class-definition
#
# The model in the example builds a complete fixed tree structure from the input data. I tried to
# optimize that by updating the tree structure whenever the user chooses to expand the nodes in
# the tree. The trick I used is to define a new role ExpandableRole and assign that role to Groups.
#
# Although I really want to stick to PEP8 for naming methods, functions and variable, I also wanted
# to stick to the Qt naming convention. For classes and methods that are in the realm of Qt I stick
# to their convention, this is the case for TreeModel, all other naming follows PEP8.
#
# TODO: data and headerData shall return a QVariant object. Is this needed for Python?

import logging
import sys
from pathlib import Path
from typing import Optional
from typing import Tuple

import h5py
import numpy as np
from PyQt5.QtCore import QModelIndex
from PyQt5.QtCore import QObject
from PyQt5.QtCore import QRunnable
from PyQt5.QtCore import QThreadPool
from PyQt5.QtCore import QTimer
from PyQt5.QtCore import pyqtSignal as QSignal
from PyQt5.QtCore import pyqtSlot as QSlot
from PyQt5.QtWidgets import QApplication
from PyQt5.QtWidgets import QFileDialog
from PyQt5.QtWidgets import QLabel
from PyQt5.QtWidgets import QMainWindow
from PyQt5.QtWidgets import QProgressBar
from rich.console import Console

from egse.dpu.ccd_ui import ImageCreatorFullSize
from egse.dpu.hdf5_model import HDF5Item
from egse.dpu.hdf5_model import HDF5Model
from egse.dpu.hdf5_model import RegisterTableModel
from egse.dpu.hdf5_ui import AttributesModel
from egse.dpu.hdf5_ui import DataPacketHeaderModel
from egse.dpu.hdf5_ui import DatasetPropertiesModel
from egse.dpu.hdf5_ui import FilePropertiesModel
from egse.dpu.hdf5_ui import GroupPropertiesModel
from egse.dpu.hdf5_ui import MainWindowGUI
from egse.dpu.hdf5_ui import PropertiesModel
from egse.exceptions import InternalError
from egse.fee import n_fee_side
from egse.fee.nfee import HousekeepingData
from egse.reg import RegisterMap
from egse.setup import SetupError
from egse.spw import DataPacket
from egse.spw import HousekeepingPacket
from egse.spw import SpaceWirePacket
from egse.state import GlobalState

MODULE_LOGGER = logging.getLogger(__name__)


class WorkerSignals(QObject):
    &#34;&#34;&#34;
    Defines the signals available from a running worker thread.

    * progress (int): progress complete,from 0-100
    * finished (no data): the worker is finished
    * result (object): the result from the Worker run() method, e.g.
        * a 2D Numpy array with the image data
    * error (tuple): exception type, value, traceback.format_exc()
    &#34;&#34;&#34;

    progress = QSignal(int)
    result = QSignal(tuple)
    finished = QSignal()
    error = QSignal(tuple)


class Worker(QRunnable):
    &#34;&#34;&#34;
    Worker thread

    Inherits from QRunnable to handle worker thread setup, signals
    and wrap-up.
    &#34;&#34;&#34;

    def __init__(self, func, *args, **kwargs):
        super().__init__()
        self.func = func
        self.args = args
        self.kwargs = kwargs
        self.signals = WorkerSignals()

        # Add the callback for signals to the kwargs, that way the function
        # has access to the signals of the worker. The signature of the
        # function needs to take args and kwargs into account.

        kwargs[&#34;signals&#34;] = self.signals

    @QSlot()
    def run(self):
        try:
            result = self.func(*self.args, **self.kwargs)
        except (Exception, ) as exc:
            exc_type, value, tb = sys.exc_info()
            self.signals.error.emit((exc_type, value, tb))
        else:
            self.signals.result.emit(result)
        finally:
            self.signals.finished.emit()


class MainWindow(QMainWindow, MainWindowGUI):
    def __init__(self):
        super().__init__()

        # Setup the complete GUI

        self.setup_gui(self)

        # Add triggers / signals to the different views

        self.tree_view.clicked.connect(self.on_clicked)
        self.table_view.clicked.connect(self.on_cell_clicked)

        self.open_doc_action.triggered.connect(self.on_open_doc_clicked)

        self.reg_model = RegisterTableModel(RegisterMap())

        if len(sys.argv) &gt; 0:
            filename = sys.argv[-1]
            self.load_hdf5_file(Path(filename))

        self.thread_pool = QThreadPool()

        self.counter = 0

        self.timer = QTimer()
        self.timer.setInterval(1000)
        self.timer.timeout.connect(self.recurring_timer)

    def on_open_doc_clicked(self, *args, **kwargs):

        filename = QFileDialog.getOpenFileName(
            self, &#34;Open a HDF5 file&#34;, filter=&#34;HDF5 Files (*.hdf5 *.h5)&#34;)
        filename = Path(filename[0])

        self.load_hdf5_file(filename)

    def load_hdf5_file(self, filename: Path):
        if filename.exists():
            try:
                hdf_file = h5py.File(filename, mode=&#39;r&#39;, locking=False)
                h5_model = HDF5Model(hdf_file)
            except OSError:
                self.status_bar.showMessage(f&#34;OSError: could not open file {filename.name}&#34;, 5000)
                return

            self.tree_view.setModel(h5_model)
            self.tree_view.expanded.connect(h5_model.update_model_data)

            self.properties.setModel(FilePropertiesModel(hdf_file))

    def on_cell_clicked(self, index: QModelIndex, *args, **kwargs):
        self.proxy_model.sourceModel().toggleDisplayRole(index)

    def on_clicked(self, index: QModelIndex, *args, **kwargs):
        item: HDF5Item = index.internalPointer()
        hdf_item = item.get_item()

        self.packet_header.setModel(None)

        if len(hdf_item.attrs):
            self.attributes.setModel(AttributesModel(hdf_item))
        else:
            self.attributes.setModel(None)

        if isinstance(hdf_item, h5py.Group):
            self.properties.setModel(GroupPropertiesModel(hdf_item))
        elif isinstance(hdf_item, h5py.Dataset):
            self.properties.setModel(DatasetPropertiesModel(hdf_item))
        else:
            self.properties.setModel(PropertiesModel())

        if isinstance(hdf_item, h5py.Dataset):
            if &#34;register&#34; in hdf_item.name:
                reg_map = RegisterMap(&#34;N-FEE&#34;, memory_map=hdf_item[()])
                self.reg_model.setRegisterMap(reg_map)
                self.proxy_model.setSourceModel(self.reg_model)
                self.data_view.setCurrentWidget(self.table_box)
                self.table_view.resizeColumnsToContents()
                self.proxy_model.layoutChanged.emit()
            elif &#34;hk&#34; in hdf_item.name:
                packet = HousekeepingPacket(hdf_item[()])
                self.display_hk_packet_view(packet)
            elif &#34;timecode&#34; in hdf_item.name:
                data = hdf_item[()]
                self.text_box.setText(str(data))
                self.data_view.setCurrentWidget(self.text_box)
            else:
                data = hdf_item[()]
                if DataPacket.is_data_packet(data):
                    self.packet_header.setModel(DataPacketHeaderModel(DataPacket(data)))
                    self.packet_header.resizeColumnsToContents()
                self.text_box.setText(ndarray_to_str(data))
                self.data_view.setCurrentWidget(self.text_box)
        elif isinstance(hdf_item, h5py.Group):
            if &#34;data&#34; in hdf_item:
                self.handle_image_data(hdf_item)

    def display_hk_packet_view(self, packet: HousekeepingPacket):
        hk_data = HousekeepingData(packet.data)

        fields = self.hk_box.spw_status.fields
        for par in fields:
            fields[par].setText(f&#34;{hk_data[par]:8d}&#34;)

        fields = self.hk_box.tou_sense.fields
        for par in fields:
            x = f&#34;TOU_SENSE_{par}&#34;
            fields[par].setText(f&#34;{hk_data[x]}&#34;)

        fields = self.hk_box.n_fee_voltages.fields
        for par in fields:
            fields[par].setText(f&#34;{hk_data[par]:8d}&#34;)

        fields = self.hk_box.n_fee_temperatures.fields
        for par in fields:
            fields[par].setText(f&#34;{hk_data[par]:8d}&#34;)

        fields = self.hk_box.ccd_voltages.fields
        for par in fields:
            fields[par].setText(f&#34;{hk_data[par]:8d}&#34;)

        self.hk_box.spw_leds.update_leds(hk_data[&#34;spw_status&#34;])

        self.hk_box.error_flags.update_flags(hk_data[&#34;error_flags&#34;])

        self.data_view.setCurrentWidget(self.hk_box)

    def display_hk_packet_text(self, packet: HousekeepingPacket):
        hk_data = HousekeepingData(packet.data)

        console = Console(width=120, force_terminal=False, force_jupyter=False)
        with console.capture() as capture:
            console.print(hk_data)
        text = capture.get()
        self.text_box.setText(text)
        self.data_view.setCurrentWidget(self.text_box)

    def handle_image_data(self, hdf_item: h5py.Group):
        if &#34;timecode&#34; not in hdf_item:
            return None

        data_item = hdf_item[&#34;data&#34;]

        if &#34;v_start&#34; not in data_item.attrs:
            reg_map = find_current_register_map(hdf_item)
            if not reg_map:
                return

            v_start = reg_map[&#34;v_start&#34;]
            v_end = reg_map[&#34;v_end&#34;]
            h_end = reg_map[&#34;h_end&#34;]

        else:
            v_start = data_item.attrs[&#34;v_start&#34;]
            v_end = data_item.attrs[&#34;v_end&#34;]
            h_end = data_item.attrs[&#34;h_end&#34;]

        # Create the Worker, any other args, kwargs are passed to the run function

        worker = Worker(
            create_image, data_item, v_start, v_end, h_end
        )
        worker.signals.result.connect(self.show_image_data)
        worker.signals.finished.connect(self.worker_finished)
        worker.signals.progress.connect(self.update_progress)

        # Execute the Worker run() method

        self.thread_pool.start(worker)

        self.timer.start()

        self.progress_label = QLabel(f&#34;Generating image[{v_start}, {v_end}]&#34;)
        self.timer_label = QLabel(&#34;0s&#34;)
        self.progress = QProgressBar()
        self.status_bar.addWidget(self.progress_label)
        self.status_bar.addWidget(self.progress)
        self.status_bar.addWidget(self.timer_label)

    def recurring_timer(self):
        self.counter += 1
        self.timer_label.setText(f&#34;{self.counter}s&#34;)

    def worker_finished(self):
        self.status_bar.removeWidget(self.progress)
        self.status_bar.removeWidget(self.progress_label)
        self.status_bar.removeWidget(self.timer_label)
        self.status_bar.show()
        self.timer.stop()
        self.counter = 0

    def update_progress(self, progress):
        self.progress.setValue(progress)

    def show_image_data(self, data: Tuple):
        ccd_nr, image_e, image_f = data
        # MODULE_LOGGER.info(f&#34;{ccd_nr=}, {image_e.shape=}, {image_f.shape}&#34;)
        self.graph_box.ccd_number = ccd_nr
        if image_e is not None and sum(image_e.shape) &gt; 0:
            self.graph_box.show_image_data(n_fee_side.E_SIDE, image_e)
            self.data_view.setCurrentWidget(self.graph_box)
        if image_f is not None and sum(image_f.shape) &gt; 0:
            self.graph_box.show_image_data(n_fee_side.F_SIDE, image_f)
            self.data_view.setCurrentWidget(self.graph_box)


def ndarray_to_str(data: np.ndarray):

    if not isinstance(data, np.ndarray):
        return str(data)

    packet: DataPacket = SpaceWirePacket.create_packet(data)
    data = packet.data_as_ndarray
    data_as_bytes = packet.data

    t = data.dtype
    w = data.shape[0]

    sdata = f&#34;{w=} {t=}\n&#34;
    sdata += f&#34;{packet.type=!s}\n&#34;

    # Represent the bytes object data, i.e. the original data coming from the SpaceWire

    sdata += &#34;data_as_bytes:   &#34;
    sdata += &#34;, &#34;.join(f&#34;{data_as_bytes[ix]:08b} {data_as_bytes[ix+1]:08b}&#34; for ix in range(0, 66, 2))
    sdata += &#34; ... &#34;
    sdata += &#34;, &#34;.join(f&#34;{data_as_bytes[ix]:08b} {data_as_bytes[ix+1]:08b}&#34; for ix in range((w-40)*2, w*2, 2))
    sdata += &#34;\n&#34;

    # Represent the numpy array, first as integers, seconds as binary strings

    sdata += &#34;data_as_ndarray: &#34;
    sdata += &#34;, &#34;.join(f&#34;{data[ix]:d}&#34; for ix in range(33))
    sdata += &#34; ... &#34;
    sdata += &#34;, &#34;.join(f&#34;{data[ix]:d}&#34; for ix in range(w - 40, w))
    sdata += &#34;\n&#34;

    sdata += &#34;data_as_ndarray: &#34;
    sdata += &#34;, &#34;.join(f&#34;{data[ix] &gt;&gt; 8 &amp; 0b11111111:08b} {data[ix] &amp; 0b11111111:08b}&#34; for ix in range(33))
    sdata += &#34; ... &#34;
    sdata += &#34;, &#34;.join(f&#34;{data[ix] &gt;&gt; 8 &amp; 0b11111111:08b} {data[ix] &amp; 0b11111111:08b}&#34; for ix in range(w - 40, w))
    sdata += &#34;\n&#34;

    return sdata


# @profile(sort_by=&#39;cumulative&#39;, lines_to_print=10, strip_dirs=True)
def create_image(hdf_item: h5py.Group, v_start: int, v_end: int, h_end: int,
                 signals: WorkerSignals):

    # MODULE_LOGGER.info(f&#34;Creating image: {v_start=}, {v_end=}&#34;)

    nr_lines = v_end - v_start + 1
    nr_columns = h_end + 1

    image = ImageCreatorFullSize(v_start, v_end, h_end)

    ccd_nr = None
    lines_count = 0
    data_group = hdf_item
    nr_data = len(data_group)

    # If v_end is larger than 4509 it means we have parallel overscan data

    last_packet = [2, 2] if v_end &gt; 4509 else [1, 1]

    for data_count in sorted(data_group, key=int):
        data = data_group[data_count][()]

        if not isinstance(data, np.ndarray):
            raise InternalError(&#39;HDF5 data group should only contain numpy arrays.&#39;)

        data_packet = SpaceWirePacket.create_packet(data)
        data = data_packet.data_as_ndarray

        image.add_data(data_packet)

        signals.progress.emit(int(data_count) * 100 // nr_data)

    # MODULE_LOGGER.info(f&#34;{lines_count=}, {nr_lines=}&#34;)
    # MODULE_LOGGER.info(f&#34;{image_e.shape=}, {image_f.shape=}&#34;)
    # MODULE_LOGGER.info(f&#34;{last_packet=}&#34;)

    image_e = image.get_image(n_fee_side.E_SIDE).astype(float)
    image_f = image.get_image(n_fee_side.F_SIDE).astype(float)

    try:
        image_e[image_e == 0] = np.nan
        image_f[image_f == 0] = np.nan
    except (Exception, ) as exc:
        MODULE_LOGGER.error(exc)

    # MODULE_LOGGER.info(f&#34;{image_e.shape=}, {image_f.shape=}&#34;)

    if nr_data:
        try:
            data_packet = SpaceWirePacket.create_packet(data_group[&#34;0&#34;][()])
            ccd_nr = data_packet.header.type_as_object.ccd_number  # N-FEE CCD number [0-3]
            # MODULE_LOGGER.info(f&#34;before {ccd_nr=}&#34;)
            try:
                ccd_nr = GlobalState.setup.camera.fee.ccd_numbering.CCD_BIN_TO_ID[ccd_nr]
            except AttributeError:
                raise SetupError(&#34;No entry in the setup for camera.fee.ccd_numbering.CCD_BIN_TO_ID&#34;)
            # MODULE_LOGGER.info(f&#34;after  {ccd_nr=}&#34;)
        except (Exception, ) as exc:
            MODULE_LOGGER.error(exc)

    # MODULE_LOGGER.info(f&#34;Return: {ccd_nr=}, {image_e.shape=}, {image_f.shape=}&#34;)

    return ccd_nr, image_e, image_f


def find_current_register_map(hdf_item: h5py.Group) -&gt; Optional[RegisterMap]:
    # The current register map is the one with the valid values for the current data.
    # Current means, for the hdf_item that was passed into this function
    # The algorithm is not fail safe yet, what we would actually need is attributes
    # to the readout group: v_start, v_end, h_end
    parent = hdf_item.parent
    parent_path = Path(parent.name)

    if &#34;register&#34; in parent:
        path = str(parent_path / &#34;register&#34;)
        reg_map = RegisterMap(&#34;N-FEE&#34;, memory_map=hdf_item[path][()])
        return reg_map

    try:
        name = Path(hdf_item.name).name
        readout_count = count = int(name)
    except ValueError:
        MODULE_LOGGER.warning(
            f&#34;Corrupt HDF5 file? Expected readout count as group name, got {hdf_item.name}.&#34;)
        return None

    MODULE_LOGGER.info(f&#34;Processing readout count {count}.&#34;)

    # Search for the last readout containing a register map

    while True:
        count -= 1
        name = str(count)
        if name not in parent:
            break
        item = parent[name]
        if &#34;register&#34; in item and &#34;data&#34; not in item:
            MODULE_LOGGER.info(f&#34;Found register in {name}.&#34;)
            path = str(parent_path / name / &#34;register&#34;)
            reg_map = RegisterMap(&#34;N-FEE&#34;, memory_map=hdf_item[path][()])
            return reg_map

    return None


def main():
    app = QApplication(sys.argv)
    window = MainWindow()
    window.show()

    rc = app.exec()

    return rc


if __name__ == &#34;__main__&#34;:

    sys.exit(main())</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="egse.dpu.hdf5_viewer.create_image"><code class="name flex">
<span>def <span class="ident">create_image</span></span>(<span>hdf_item: h5py._hl.group.Group, v_start: int, v_end: int, h_end: int, signals: <a title="egse.dpu.hdf5_viewer.WorkerSignals" href="#egse.dpu.hdf5_viewer.WorkerSignals">WorkerSignals</a>)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def create_image(hdf_item: h5py.Group, v_start: int, v_end: int, h_end: int,
                 signals: WorkerSignals):

    # MODULE_LOGGER.info(f&#34;Creating image: {v_start=}, {v_end=}&#34;)

    nr_lines = v_end - v_start + 1
    nr_columns = h_end + 1

    image = ImageCreatorFullSize(v_start, v_end, h_end)

    ccd_nr = None
    lines_count = 0
    data_group = hdf_item
    nr_data = len(data_group)

    # If v_end is larger than 4509 it means we have parallel overscan data

    last_packet = [2, 2] if v_end &gt; 4509 else [1, 1]

    for data_count in sorted(data_group, key=int):
        data = data_group[data_count][()]

        if not isinstance(data, np.ndarray):
            raise InternalError(&#39;HDF5 data group should only contain numpy arrays.&#39;)

        data_packet = SpaceWirePacket.create_packet(data)
        data = data_packet.data_as_ndarray

        image.add_data(data_packet)

        signals.progress.emit(int(data_count) * 100 // nr_data)

    # MODULE_LOGGER.info(f&#34;{lines_count=}, {nr_lines=}&#34;)
    # MODULE_LOGGER.info(f&#34;{image_e.shape=}, {image_f.shape=}&#34;)
    # MODULE_LOGGER.info(f&#34;{last_packet=}&#34;)

    image_e = image.get_image(n_fee_side.E_SIDE).astype(float)
    image_f = image.get_image(n_fee_side.F_SIDE).astype(float)

    try:
        image_e[image_e == 0] = np.nan
        image_f[image_f == 0] = np.nan
    except (Exception, ) as exc:
        MODULE_LOGGER.error(exc)

    # MODULE_LOGGER.info(f&#34;{image_e.shape=}, {image_f.shape=}&#34;)

    if nr_data:
        try:
            data_packet = SpaceWirePacket.create_packet(data_group[&#34;0&#34;][()])
            ccd_nr = data_packet.header.type_as_object.ccd_number  # N-FEE CCD number [0-3]
            # MODULE_LOGGER.info(f&#34;before {ccd_nr=}&#34;)
            try:
                ccd_nr = GlobalState.setup.camera.fee.ccd_numbering.CCD_BIN_TO_ID[ccd_nr]
            except AttributeError:
                raise SetupError(&#34;No entry in the setup for camera.fee.ccd_numbering.CCD_BIN_TO_ID&#34;)
            # MODULE_LOGGER.info(f&#34;after  {ccd_nr=}&#34;)
        except (Exception, ) as exc:
            MODULE_LOGGER.error(exc)

    # MODULE_LOGGER.info(f&#34;Return: {ccd_nr=}, {image_e.shape=}, {image_f.shape=}&#34;)

    return ccd_nr, image_e, image_f</code></pre>
</details>
</dd>
<dt id="egse.dpu.hdf5_viewer.find_current_register_map"><code class="name flex">
<span>def <span class="ident">find_current_register_map</span></span>(<span>hdf_item: h5py._hl.group.Group) ‑> Optional[<a title="egse.reg.RegisterMap" href="../reg.html#egse.reg.RegisterMap">RegisterMap</a>]</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def find_current_register_map(hdf_item: h5py.Group) -&gt; Optional[RegisterMap]:
    # The current register map is the one with the valid values for the current data.
    # Current means, for the hdf_item that was passed into this function
    # The algorithm is not fail safe yet, what we would actually need is attributes
    # to the readout group: v_start, v_end, h_end
    parent = hdf_item.parent
    parent_path = Path(parent.name)

    if &#34;register&#34; in parent:
        path = str(parent_path / &#34;register&#34;)
        reg_map = RegisterMap(&#34;N-FEE&#34;, memory_map=hdf_item[path][()])
        return reg_map

    try:
        name = Path(hdf_item.name).name
        readout_count = count = int(name)
    except ValueError:
        MODULE_LOGGER.warning(
            f&#34;Corrupt HDF5 file? Expected readout count as group name, got {hdf_item.name}.&#34;)
        return None

    MODULE_LOGGER.info(f&#34;Processing readout count {count}.&#34;)

    # Search for the last readout containing a register map

    while True:
        count -= 1
        name = str(count)
        if name not in parent:
            break
        item = parent[name]
        if &#34;register&#34; in item and &#34;data&#34; not in item:
            MODULE_LOGGER.info(f&#34;Found register in {name}.&#34;)
            path = str(parent_path / name / &#34;register&#34;)
            reg_map = RegisterMap(&#34;N-FEE&#34;, memory_map=hdf_item[path][()])
            return reg_map

    return None</code></pre>
</details>
</dd>
<dt id="egse.dpu.hdf5_viewer.main"><code class="name flex">
<span>def <span class="ident">main</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def main():
    app = QApplication(sys.argv)
    window = MainWindow()
    window.show()

    rc = app.exec()

    return rc</code></pre>
</details>
</dd>
<dt id="egse.dpu.hdf5_viewer.ndarray_to_str"><code class="name flex">
<span>def <span class="ident">ndarray_to_str</span></span>(<span>data: numpy.ndarray)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def ndarray_to_str(data: np.ndarray):

    if not isinstance(data, np.ndarray):
        return str(data)

    packet: DataPacket = SpaceWirePacket.create_packet(data)
    data = packet.data_as_ndarray
    data_as_bytes = packet.data

    t = data.dtype
    w = data.shape[0]

    sdata = f&#34;{w=} {t=}\n&#34;
    sdata += f&#34;{packet.type=!s}\n&#34;

    # Represent the bytes object data, i.e. the original data coming from the SpaceWire

    sdata += &#34;data_as_bytes:   &#34;
    sdata += &#34;, &#34;.join(f&#34;{data_as_bytes[ix]:08b} {data_as_bytes[ix+1]:08b}&#34; for ix in range(0, 66, 2))
    sdata += &#34; ... &#34;
    sdata += &#34;, &#34;.join(f&#34;{data_as_bytes[ix]:08b} {data_as_bytes[ix+1]:08b}&#34; for ix in range((w-40)*2, w*2, 2))
    sdata += &#34;\n&#34;

    # Represent the numpy array, first as integers, seconds as binary strings

    sdata += &#34;data_as_ndarray: &#34;
    sdata += &#34;, &#34;.join(f&#34;{data[ix]:d}&#34; for ix in range(33))
    sdata += &#34; ... &#34;
    sdata += &#34;, &#34;.join(f&#34;{data[ix]:d}&#34; for ix in range(w - 40, w))
    sdata += &#34;\n&#34;

    sdata += &#34;data_as_ndarray: &#34;
    sdata += &#34;, &#34;.join(f&#34;{data[ix] &gt;&gt; 8 &amp; 0b11111111:08b} {data[ix] &amp; 0b11111111:08b}&#34; for ix in range(33))
    sdata += &#34; ... &#34;
    sdata += &#34;, &#34;.join(f&#34;{data[ix] &gt;&gt; 8 &amp; 0b11111111:08b} {data[ix] &amp; 0b11111111:08b}&#34; for ix in range(w - 40, w))
    sdata += &#34;\n&#34;

    return sdata</code></pre>
</details>
</dd>
</dl>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="egse.dpu.hdf5_viewer.MainWindow"><code class="flex name class">
<span>class <span class="ident">MainWindow</span></span>
</code></dt>
<dd>
<div class="desc"><p>QMainWindow(parent: QWidget = None, flags: Union[Qt.WindowFlags, Qt.WindowType] = Qt.WindowFlags())</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class MainWindow(QMainWindow, MainWindowGUI):
    def __init__(self):
        super().__init__()

        # Setup the complete GUI

        self.setup_gui(self)

        # Add triggers / signals to the different views

        self.tree_view.clicked.connect(self.on_clicked)
        self.table_view.clicked.connect(self.on_cell_clicked)

        self.open_doc_action.triggered.connect(self.on_open_doc_clicked)

        self.reg_model = RegisterTableModel(RegisterMap())

        if len(sys.argv) &gt; 0:
            filename = sys.argv[-1]
            self.load_hdf5_file(Path(filename))

        self.thread_pool = QThreadPool()

        self.counter = 0

        self.timer = QTimer()
        self.timer.setInterval(1000)
        self.timer.timeout.connect(self.recurring_timer)

    def on_open_doc_clicked(self, *args, **kwargs):

        filename = QFileDialog.getOpenFileName(
            self, &#34;Open a HDF5 file&#34;, filter=&#34;HDF5 Files (*.hdf5 *.h5)&#34;)
        filename = Path(filename[0])

        self.load_hdf5_file(filename)

    def load_hdf5_file(self, filename: Path):
        if filename.exists():
            try:
                hdf_file = h5py.File(filename, mode=&#39;r&#39;, locking=False)
                h5_model = HDF5Model(hdf_file)
            except OSError:
                self.status_bar.showMessage(f&#34;OSError: could not open file {filename.name}&#34;, 5000)
                return

            self.tree_view.setModel(h5_model)
            self.tree_view.expanded.connect(h5_model.update_model_data)

            self.properties.setModel(FilePropertiesModel(hdf_file))

    def on_cell_clicked(self, index: QModelIndex, *args, **kwargs):
        self.proxy_model.sourceModel().toggleDisplayRole(index)

    def on_clicked(self, index: QModelIndex, *args, **kwargs):
        item: HDF5Item = index.internalPointer()
        hdf_item = item.get_item()

        self.packet_header.setModel(None)

        if len(hdf_item.attrs):
            self.attributes.setModel(AttributesModel(hdf_item))
        else:
            self.attributes.setModel(None)

        if isinstance(hdf_item, h5py.Group):
            self.properties.setModel(GroupPropertiesModel(hdf_item))
        elif isinstance(hdf_item, h5py.Dataset):
            self.properties.setModel(DatasetPropertiesModel(hdf_item))
        else:
            self.properties.setModel(PropertiesModel())

        if isinstance(hdf_item, h5py.Dataset):
            if &#34;register&#34; in hdf_item.name:
                reg_map = RegisterMap(&#34;N-FEE&#34;, memory_map=hdf_item[()])
                self.reg_model.setRegisterMap(reg_map)
                self.proxy_model.setSourceModel(self.reg_model)
                self.data_view.setCurrentWidget(self.table_box)
                self.table_view.resizeColumnsToContents()
                self.proxy_model.layoutChanged.emit()
            elif &#34;hk&#34; in hdf_item.name:
                packet = HousekeepingPacket(hdf_item[()])
                self.display_hk_packet_view(packet)
            elif &#34;timecode&#34; in hdf_item.name:
                data = hdf_item[()]
                self.text_box.setText(str(data))
                self.data_view.setCurrentWidget(self.text_box)
            else:
                data = hdf_item[()]
                if DataPacket.is_data_packet(data):
                    self.packet_header.setModel(DataPacketHeaderModel(DataPacket(data)))
                    self.packet_header.resizeColumnsToContents()
                self.text_box.setText(ndarray_to_str(data))
                self.data_view.setCurrentWidget(self.text_box)
        elif isinstance(hdf_item, h5py.Group):
            if &#34;data&#34; in hdf_item:
                self.handle_image_data(hdf_item)

    def display_hk_packet_view(self, packet: HousekeepingPacket):
        hk_data = HousekeepingData(packet.data)

        fields = self.hk_box.spw_status.fields
        for par in fields:
            fields[par].setText(f&#34;{hk_data[par]:8d}&#34;)

        fields = self.hk_box.tou_sense.fields
        for par in fields:
            x = f&#34;TOU_SENSE_{par}&#34;
            fields[par].setText(f&#34;{hk_data[x]}&#34;)

        fields = self.hk_box.n_fee_voltages.fields
        for par in fields:
            fields[par].setText(f&#34;{hk_data[par]:8d}&#34;)

        fields = self.hk_box.n_fee_temperatures.fields
        for par in fields:
            fields[par].setText(f&#34;{hk_data[par]:8d}&#34;)

        fields = self.hk_box.ccd_voltages.fields
        for par in fields:
            fields[par].setText(f&#34;{hk_data[par]:8d}&#34;)

        self.hk_box.spw_leds.update_leds(hk_data[&#34;spw_status&#34;])

        self.hk_box.error_flags.update_flags(hk_data[&#34;error_flags&#34;])

        self.data_view.setCurrentWidget(self.hk_box)

    def display_hk_packet_text(self, packet: HousekeepingPacket):
        hk_data = HousekeepingData(packet.data)

        console = Console(width=120, force_terminal=False, force_jupyter=False)
        with console.capture() as capture:
            console.print(hk_data)
        text = capture.get()
        self.text_box.setText(text)
        self.data_view.setCurrentWidget(self.text_box)

    def handle_image_data(self, hdf_item: h5py.Group):
        if &#34;timecode&#34; not in hdf_item:
            return None

        data_item = hdf_item[&#34;data&#34;]

        if &#34;v_start&#34; not in data_item.attrs:
            reg_map = find_current_register_map(hdf_item)
            if not reg_map:
                return

            v_start = reg_map[&#34;v_start&#34;]
            v_end = reg_map[&#34;v_end&#34;]
            h_end = reg_map[&#34;h_end&#34;]

        else:
            v_start = data_item.attrs[&#34;v_start&#34;]
            v_end = data_item.attrs[&#34;v_end&#34;]
            h_end = data_item.attrs[&#34;h_end&#34;]

        # Create the Worker, any other args, kwargs are passed to the run function

        worker = Worker(
            create_image, data_item, v_start, v_end, h_end
        )
        worker.signals.result.connect(self.show_image_data)
        worker.signals.finished.connect(self.worker_finished)
        worker.signals.progress.connect(self.update_progress)

        # Execute the Worker run() method

        self.thread_pool.start(worker)

        self.timer.start()

        self.progress_label = QLabel(f&#34;Generating image[{v_start}, {v_end}]&#34;)
        self.timer_label = QLabel(&#34;0s&#34;)
        self.progress = QProgressBar()
        self.status_bar.addWidget(self.progress_label)
        self.status_bar.addWidget(self.progress)
        self.status_bar.addWidget(self.timer_label)

    def recurring_timer(self):
        self.counter += 1
        self.timer_label.setText(f&#34;{self.counter}s&#34;)

    def worker_finished(self):
        self.status_bar.removeWidget(self.progress)
        self.status_bar.removeWidget(self.progress_label)
        self.status_bar.removeWidget(self.timer_label)
        self.status_bar.show()
        self.timer.stop()
        self.counter = 0

    def update_progress(self, progress):
        self.progress.setValue(progress)

    def show_image_data(self, data: Tuple):
        ccd_nr, image_e, image_f = data
        # MODULE_LOGGER.info(f&#34;{ccd_nr=}, {image_e.shape=}, {image_f.shape}&#34;)
        self.graph_box.ccd_number = ccd_nr
        if image_e is not None and sum(image_e.shape) &gt; 0:
            self.graph_box.show_image_data(n_fee_side.E_SIDE, image_e)
            self.data_view.setCurrentWidget(self.graph_box)
        if image_f is not None and sum(image_f.shape) &gt; 0:
            self.graph_box.show_image_data(n_fee_side.F_SIDE, image_f)
            self.data_view.setCurrentWidget(self.graph_box)</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>PyQt5.QtWidgets.QMainWindow</li>
<li>PyQt5.QtWidgets.QWidget</li>
<li>PyQt5.QtCore.QObject</li>
<li>sip.wrapper</li>
<li>PyQt5.QtGui.QPaintDevice</li>
<li>sip.simplewrapper</li>
<li><a title="egse.dpu.hdf5_ui.MainWindowGUI" href="hdf5_ui.html#egse.dpu.hdf5_ui.MainWindowGUI">MainWindowGUI</a></li>
</ul>
<h3>Methods</h3>
<dl>
<dt id="egse.dpu.hdf5_viewer.MainWindow.display_hk_packet_text"><code class="name flex">
<span>def <span class="ident">display_hk_packet_text</span></span>(<span>self, packet: <a title="egse.spw.HousekeepingPacket" href="../spw.html#egse.spw.HousekeepingPacket">HousekeepingPacket</a>)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def display_hk_packet_text(self, packet: HousekeepingPacket):
    hk_data = HousekeepingData(packet.data)

    console = Console(width=120, force_terminal=False, force_jupyter=False)
    with console.capture() as capture:
        console.print(hk_data)
    text = capture.get()
    self.text_box.setText(text)
    self.data_view.setCurrentWidget(self.text_box)</code></pre>
</details>
</dd>
<dt id="egse.dpu.hdf5_viewer.MainWindow.display_hk_packet_view"><code class="name flex">
<span>def <span class="ident">display_hk_packet_view</span></span>(<span>self, packet: <a title="egse.spw.HousekeepingPacket" href="../spw.html#egse.spw.HousekeepingPacket">HousekeepingPacket</a>)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def display_hk_packet_view(self, packet: HousekeepingPacket):
    hk_data = HousekeepingData(packet.data)

    fields = self.hk_box.spw_status.fields
    for par in fields:
        fields[par].setText(f&#34;{hk_data[par]:8d}&#34;)

    fields = self.hk_box.tou_sense.fields
    for par in fields:
        x = f&#34;TOU_SENSE_{par}&#34;
        fields[par].setText(f&#34;{hk_data[x]}&#34;)

    fields = self.hk_box.n_fee_voltages.fields
    for par in fields:
        fields[par].setText(f&#34;{hk_data[par]:8d}&#34;)

    fields = self.hk_box.n_fee_temperatures.fields
    for par in fields:
        fields[par].setText(f&#34;{hk_data[par]:8d}&#34;)

    fields = self.hk_box.ccd_voltages.fields
    for par in fields:
        fields[par].setText(f&#34;{hk_data[par]:8d}&#34;)

    self.hk_box.spw_leds.update_leds(hk_data[&#34;spw_status&#34;])

    self.hk_box.error_flags.update_flags(hk_data[&#34;error_flags&#34;])

    self.data_view.setCurrentWidget(self.hk_box)</code></pre>
</details>
</dd>
<dt id="egse.dpu.hdf5_viewer.MainWindow.handle_image_data"><code class="name flex">
<span>def <span class="ident">handle_image_data</span></span>(<span>self, hdf_item: h5py._hl.group.Group)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def handle_image_data(self, hdf_item: h5py.Group):
    if &#34;timecode&#34; not in hdf_item:
        return None

    data_item = hdf_item[&#34;data&#34;]

    if &#34;v_start&#34; not in data_item.attrs:
        reg_map = find_current_register_map(hdf_item)
        if not reg_map:
            return

        v_start = reg_map[&#34;v_start&#34;]
        v_end = reg_map[&#34;v_end&#34;]
        h_end = reg_map[&#34;h_end&#34;]

    else:
        v_start = data_item.attrs[&#34;v_start&#34;]
        v_end = data_item.attrs[&#34;v_end&#34;]
        h_end = data_item.attrs[&#34;h_end&#34;]

    # Create the Worker, any other args, kwargs are passed to the run function

    worker = Worker(
        create_image, data_item, v_start, v_end, h_end
    )
    worker.signals.result.connect(self.show_image_data)
    worker.signals.finished.connect(self.worker_finished)
    worker.signals.progress.connect(self.update_progress)

    # Execute the Worker run() method

    self.thread_pool.start(worker)

    self.timer.start()

    self.progress_label = QLabel(f&#34;Generating image[{v_start}, {v_end}]&#34;)
    self.timer_label = QLabel(&#34;0s&#34;)
    self.progress = QProgressBar()
    self.status_bar.addWidget(self.progress_label)
    self.status_bar.addWidget(self.progress)
    self.status_bar.addWidget(self.timer_label)</code></pre>
</details>
</dd>
<dt id="egse.dpu.hdf5_viewer.MainWindow.load_hdf5_file"><code class="name flex">
<span>def <span class="ident">load_hdf5_file</span></span>(<span>self, filename: pathlib.Path)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def load_hdf5_file(self, filename: Path):
    if filename.exists():
        try:
            hdf_file = h5py.File(filename, mode=&#39;r&#39;, locking=False)
            h5_model = HDF5Model(hdf_file)
        except OSError:
            self.status_bar.showMessage(f&#34;OSError: could not open file {filename.name}&#34;, 5000)
            return

        self.tree_view.setModel(h5_model)
        self.tree_view.expanded.connect(h5_model.update_model_data)

        self.properties.setModel(FilePropertiesModel(hdf_file))</code></pre>
</details>
</dd>
<dt id="egse.dpu.hdf5_viewer.MainWindow.on_cell_clicked"><code class="name flex">
<span>def <span class="ident">on_cell_clicked</span></span>(<span>self, index: PyQt5.QtCore.QModelIndex, *args, **kwargs)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def on_cell_clicked(self, index: QModelIndex, *args, **kwargs):
    self.proxy_model.sourceModel().toggleDisplayRole(index)</code></pre>
</details>
</dd>
<dt id="egse.dpu.hdf5_viewer.MainWindow.on_clicked"><code class="name flex">
<span>def <span class="ident">on_clicked</span></span>(<span>self, index: PyQt5.QtCore.QModelIndex, *args, **kwargs)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def on_clicked(self, index: QModelIndex, *args, **kwargs):
    item: HDF5Item = index.internalPointer()
    hdf_item = item.get_item()

    self.packet_header.setModel(None)

    if len(hdf_item.attrs):
        self.attributes.setModel(AttributesModel(hdf_item))
    else:
        self.attributes.setModel(None)

    if isinstance(hdf_item, h5py.Group):
        self.properties.setModel(GroupPropertiesModel(hdf_item))
    elif isinstance(hdf_item, h5py.Dataset):
        self.properties.setModel(DatasetPropertiesModel(hdf_item))
    else:
        self.properties.setModel(PropertiesModel())

    if isinstance(hdf_item, h5py.Dataset):
        if &#34;register&#34; in hdf_item.name:
            reg_map = RegisterMap(&#34;N-FEE&#34;, memory_map=hdf_item[()])
            self.reg_model.setRegisterMap(reg_map)
            self.proxy_model.setSourceModel(self.reg_model)
            self.data_view.setCurrentWidget(self.table_box)
            self.table_view.resizeColumnsToContents()
            self.proxy_model.layoutChanged.emit()
        elif &#34;hk&#34; in hdf_item.name:
            packet = HousekeepingPacket(hdf_item[()])
            self.display_hk_packet_view(packet)
        elif &#34;timecode&#34; in hdf_item.name:
            data = hdf_item[()]
            self.text_box.setText(str(data))
            self.data_view.setCurrentWidget(self.text_box)
        else:
            data = hdf_item[()]
            if DataPacket.is_data_packet(data):
                self.packet_header.setModel(DataPacketHeaderModel(DataPacket(data)))
                self.packet_header.resizeColumnsToContents()
            self.text_box.setText(ndarray_to_str(data))
            self.data_view.setCurrentWidget(self.text_box)
    elif isinstance(hdf_item, h5py.Group):
        if &#34;data&#34; in hdf_item:
            self.handle_image_data(hdf_item)</code></pre>
</details>
</dd>
<dt id="egse.dpu.hdf5_viewer.MainWindow.on_open_doc_clicked"><code class="name flex">
<span>def <span class="ident">on_open_doc_clicked</span></span>(<span>self, *args, **kwargs)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def on_open_doc_clicked(self, *args, **kwargs):

    filename = QFileDialog.getOpenFileName(
        self, &#34;Open a HDF5 file&#34;, filter=&#34;HDF5 Files (*.hdf5 *.h5)&#34;)
    filename = Path(filename[0])

    self.load_hdf5_file(filename)</code></pre>
</details>
</dd>
<dt id="egse.dpu.hdf5_viewer.MainWindow.recurring_timer"><code class="name flex">
<span>def <span class="ident">recurring_timer</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def recurring_timer(self):
    self.counter += 1
    self.timer_label.setText(f&#34;{self.counter}s&#34;)</code></pre>
</details>
</dd>
<dt id="egse.dpu.hdf5_viewer.MainWindow.show_image_data"><code class="name flex">
<span>def <span class="ident">show_image_data</span></span>(<span>self, data: Tuple[])</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def show_image_data(self, data: Tuple):
    ccd_nr, image_e, image_f = data
    # MODULE_LOGGER.info(f&#34;{ccd_nr=}, {image_e.shape=}, {image_f.shape}&#34;)
    self.graph_box.ccd_number = ccd_nr
    if image_e is not None and sum(image_e.shape) &gt; 0:
        self.graph_box.show_image_data(n_fee_side.E_SIDE, image_e)
        self.data_view.setCurrentWidget(self.graph_box)
    if image_f is not None and sum(image_f.shape) &gt; 0:
        self.graph_box.show_image_data(n_fee_side.F_SIDE, image_f)
        self.data_view.setCurrentWidget(self.graph_box)</code></pre>
</details>
</dd>
<dt id="egse.dpu.hdf5_viewer.MainWindow.update_progress"><code class="name flex">
<span>def <span class="ident">update_progress</span></span>(<span>self, progress)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def update_progress(self, progress):
    self.progress.setValue(progress)</code></pre>
</details>
</dd>
<dt id="egse.dpu.hdf5_viewer.MainWindow.worker_finished"><code class="name flex">
<span>def <span class="ident">worker_finished</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def worker_finished(self):
    self.status_bar.removeWidget(self.progress)
    self.status_bar.removeWidget(self.progress_label)
    self.status_bar.removeWidget(self.timer_label)
    self.status_bar.show()
    self.timer.stop()
    self.counter = 0</code></pre>
</details>
</dd>
</dl>
<h3>Inherited members</h3>
<ul class="hlist">
<li><code><b><a title="egse.dpu.hdf5_ui.MainWindowGUI" href="hdf5_ui.html#egse.dpu.hdf5_ui.MainWindowGUI">MainWindowGUI</a></b></code>:
<ul class="hlist">
<li><code><a title="egse.dpu.hdf5_ui.MainWindowGUI.setup_gui" href="hdf5_ui.html#egse.dpu.hdf5_ui.MainWindowGUI.setup_gui">setup_gui</a></code></li>
</ul>
</li>
</ul>
</dd>
<dt id="egse.dpu.hdf5_viewer.Worker"><code class="flex name class">
<span>class <span class="ident">Worker</span></span>
<span>(</span><span>func, *args, **kwargs)</span>
</code></dt>
<dd>
<div class="desc"><p>Worker thread</p>
<p>Inherits from QRunnable to handle worker thread setup, signals
and wrap-up.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class Worker(QRunnable):
    &#34;&#34;&#34;
    Worker thread

    Inherits from QRunnable to handle worker thread setup, signals
    and wrap-up.
    &#34;&#34;&#34;

    def __init__(self, func, *args, **kwargs):
        super().__init__()
        self.func = func
        self.args = args
        self.kwargs = kwargs
        self.signals = WorkerSignals()

        # Add the callback for signals to the kwargs, that way the function
        # has access to the signals of the worker. The signature of the
        # function needs to take args and kwargs into account.

        kwargs[&#34;signals&#34;] = self.signals

    @QSlot()
    def run(self):
        try:
            result = self.func(*self.args, **self.kwargs)
        except (Exception, ) as exc:
            exc_type, value, tb = sys.exc_info()
            self.signals.error.emit((exc_type, value, tb))
        else:
            self.signals.result.emit(result)
        finally:
            self.signals.finished.emit()</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>PyQt5.QtCore.QRunnable</li>
<li>sip.wrapper</li>
<li>sip.simplewrapper</li>
</ul>
<h3>Methods</h3>
<dl>
<dt id="egse.dpu.hdf5_viewer.Worker.run"><code class="name flex">
<span>def <span class="ident">run</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>run(self)</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@QSlot()
def run(self):
    try:
        result = self.func(*self.args, **self.kwargs)
    except (Exception, ) as exc:
        exc_type, value, tb = sys.exc_info()
        self.signals.error.emit((exc_type, value, tb))
    else:
        self.signals.result.emit(result)
    finally:
        self.signals.finished.emit()</code></pre>
</details>
</dd>
</dl>
</dd>
<dt id="egse.dpu.hdf5_viewer.WorkerSignals"><code class="flex name class">
<span>class <span class="ident">WorkerSignals</span></span>
<span>(</span><span>*args, **kwargs)</span>
</code></dt>
<dd>
<div class="desc"><p>Defines the signals available from a running worker thread.</p>
<ul>
<li>progress (int): progress complete,from 0-100</li>
<li>finished (no data): the worker is finished</li>
<li>result (object): the result from the Worker run() method, e.g.<ul>
<li>a 2D Numpy array with the image data</li>
</ul>
</li>
<li>error (tuple): exception type, value, traceback.format_exc()</li>
</ul></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class WorkerSignals(QObject):
    &#34;&#34;&#34;
    Defines the signals available from a running worker thread.

    * progress (int): progress complete,from 0-100
    * finished (no data): the worker is finished
    * result (object): the result from the Worker run() method, e.g.
        * a 2D Numpy array with the image data
    * error (tuple): exception type, value, traceback.format_exc()
    &#34;&#34;&#34;

    progress = QSignal(int)
    result = QSignal(tuple)
    finished = QSignal()
    error = QSignal(tuple)</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>PyQt5.QtCore.QObject</li>
<li>sip.wrapper</li>
<li>sip.simplewrapper</li>
</ul>
<h3>Methods</h3>
<dl>
<dt id="egse.dpu.hdf5_viewer.WorkerSignals.error"><code class="name flex">
<span>def <span class="ident">error</span></span>(<span>...)</span>
</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="egse.dpu.hdf5_viewer.WorkerSignals.finished"><code class="name flex">
<span>def <span class="ident">finished</span></span>(<span>...)</span>
</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="egse.dpu.hdf5_viewer.WorkerSignals.progress"><code class="name flex">
<span>def <span class="ident">progress</span></span>(<span>...)</span>
</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="egse.dpu.hdf5_viewer.WorkerSignals.result"><code class="name flex">
<span>def <span class="ident">result</span></span>(<span>...)</span>
</code></dt>
<dd>
<div class="desc"></div>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="egse.dpu" href="index.html">egse.dpu</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="egse.dpu.hdf5_viewer.create_image" href="#egse.dpu.hdf5_viewer.create_image">create_image</a></code></li>
<li><code><a title="egse.dpu.hdf5_viewer.find_current_register_map" href="#egse.dpu.hdf5_viewer.find_current_register_map">find_current_register_map</a></code></li>
<li><code><a title="egse.dpu.hdf5_viewer.main" href="#egse.dpu.hdf5_viewer.main">main</a></code></li>
<li><code><a title="egse.dpu.hdf5_viewer.ndarray_to_str" href="#egse.dpu.hdf5_viewer.ndarray_to_str">ndarray_to_str</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="egse.dpu.hdf5_viewer.MainWindow" href="#egse.dpu.hdf5_viewer.MainWindow">MainWindow</a></code></h4>
<ul class="">
<li><code><a title="egse.dpu.hdf5_viewer.MainWindow.display_hk_packet_text" href="#egse.dpu.hdf5_viewer.MainWindow.display_hk_packet_text">display_hk_packet_text</a></code></li>
<li><code><a title="egse.dpu.hdf5_viewer.MainWindow.display_hk_packet_view" href="#egse.dpu.hdf5_viewer.MainWindow.display_hk_packet_view">display_hk_packet_view</a></code></li>
<li><code><a title="egse.dpu.hdf5_viewer.MainWindow.handle_image_data" href="#egse.dpu.hdf5_viewer.MainWindow.handle_image_data">handle_image_data</a></code></li>
<li><code><a title="egse.dpu.hdf5_viewer.MainWindow.load_hdf5_file" href="#egse.dpu.hdf5_viewer.MainWindow.load_hdf5_file">load_hdf5_file</a></code></li>
<li><code><a title="egse.dpu.hdf5_viewer.MainWindow.on_cell_clicked" href="#egse.dpu.hdf5_viewer.MainWindow.on_cell_clicked">on_cell_clicked</a></code></li>
<li><code><a title="egse.dpu.hdf5_viewer.MainWindow.on_clicked" href="#egse.dpu.hdf5_viewer.MainWindow.on_clicked">on_clicked</a></code></li>
<li><code><a title="egse.dpu.hdf5_viewer.MainWindow.on_open_doc_clicked" href="#egse.dpu.hdf5_viewer.MainWindow.on_open_doc_clicked">on_open_doc_clicked</a></code></li>
<li><code><a title="egse.dpu.hdf5_viewer.MainWindow.recurring_timer" href="#egse.dpu.hdf5_viewer.MainWindow.recurring_timer">recurring_timer</a></code></li>
<li><code><a title="egse.dpu.hdf5_viewer.MainWindow.show_image_data" href="#egse.dpu.hdf5_viewer.MainWindow.show_image_data">show_image_data</a></code></li>
<li><code><a title="egse.dpu.hdf5_viewer.MainWindow.update_progress" href="#egse.dpu.hdf5_viewer.MainWindow.update_progress">update_progress</a></code></li>
<li><code><a title="egse.dpu.hdf5_viewer.MainWindow.worker_finished" href="#egse.dpu.hdf5_viewer.MainWindow.worker_finished">worker_finished</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="egse.dpu.hdf5_viewer.Worker" href="#egse.dpu.hdf5_viewer.Worker">Worker</a></code></h4>
<ul class="">
<li><code><a title="egse.dpu.hdf5_viewer.Worker.run" href="#egse.dpu.hdf5_viewer.Worker.run">run</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="egse.dpu.hdf5_viewer.WorkerSignals" href="#egse.dpu.hdf5_viewer.WorkerSignals">WorkerSignals</a></code></h4>
<ul class="">
<li><code><a title="egse.dpu.hdf5_viewer.WorkerSignals.error" href="#egse.dpu.hdf5_viewer.WorkerSignals.error">error</a></code></li>
<li><code><a title="egse.dpu.hdf5_viewer.WorkerSignals.finished" href="#egse.dpu.hdf5_viewer.WorkerSignals.finished">finished</a></code></li>
<li><code><a title="egse.dpu.hdf5_viewer.WorkerSignals.progress" href="#egse.dpu.hdf5_viewer.WorkerSignals.progress">progress</a></code></li>
<li><code><a title="egse.dpu.hdf5_viewer.WorkerSignals.result" href="#egse.dpu.hdf5_viewer.WorkerSignals.result">result</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>